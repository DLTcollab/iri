package com.iota.iri;

import com.iota.iri.conf.MainnetConfig;
import com.iota.iri.crypto.Curl;
import com.iota.iri.crypto.ISS;
import com.iota.iri.crypto.SpongeFactory;
import com.iota.iri.model.Hash;
import com.iota.iri.model.TransactionHash;
import com.iota.iri.service.snapshot.SnapshotProvider;
import com.iota.iri.service.snapshot.impl.SnapshotProviderImpl;
import com.iota.iri.storage.Tangle;
import com.iota.iri.storage.rocksDB.RocksDBPersistenceProvider;
import com.iota.iri.utils.Converter;
import com.iota.iri.controllers.TransactionViewModel;
import org.junit.*;
import org.junit.rules.TemporaryFolder;

import java.util.*;
import java.util.stream.Collectors;

import static org.junit.Assert.*;

public class BundleValidatorTest {
    private static Tangle tangle = new Tangle();
    private static SnapshotProvider snapshotProvider;
    private static BundleValidator bundleValidator = new BundleValidator();

    @Before
    public void setUp() throws Exception {
        TemporaryFolder dbFolder = new TemporaryFolder();
        TemporaryFolder logFolder = new TemporaryFolder();
        dbFolder.create();
        logFolder.create();
        tangle.addPersistenceProvider(
                new RocksDBPersistenceProvider(dbFolder.getRoot().getAbsolutePath(),
                        logFolder.getRoot().getAbsolutePath(), 1000, Tangle.COLUMN_FAMILIES,
                        Tangle.METADATA_COLUMN_FAMILY));
        tangle.init();
        snapshotProvider = new SnapshotProviderImpl().init(new MainnetConfig());
    }

    @After
    public void tearDown() throws Exception {
        tangle.shutdown();
        snapshotProvider.shutdown();
    }

    private List<TransactionViewModel> persistAndMapTxs(String[] trytes) {
        return Arrays.stream(trytes)
                .map(Converter::allocatingTritsFromTrytes)
                .map(t -> new TransactionViewModel(t, TransactionHash.calculate(SpongeFactory.Mode.CURLP81, t)))
                .peek(t -> {
                    try {
                        t.store(tangle, snapshotProvider.getInitialSnapshot());
                    } catch (Exception e) {
                        e.printStackTrace();
                    }
                }).collect(Collectors.toList());
    }

    @Test
    public void checkInconsistencyOfInconsistentBundle() {
        // input transaction value changed to 123
        String[] trytes = {
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999GNXKWQPHMFCEZZCKUCCD9PROQVPCTBVVAPHCLVOPYYQLQRMPGTQXBVZLKGGT9NXHUAASFIAVEOZTBSM9DA99999999999999999999999999RENGLE9BEAT9999999999999999FDKW9AD99999999999B99999999RJPQGE9AXNBBLPQ9IFJXFJTXJAIGDDXAWXGAVU9PJQNYFADJDIDBTJKSAEBBX9NWJGZVAVXYWXPCEFFH9DKZYSMJAQRLXZHCNPTJPJLOONNDZHGNTBIINGYKZQAAWF9LWQTHUQSAXMLQN9DKCQWHIJXNGLGQVA9999XIFVJWCABR9XQKOWCXJAZDZWMWWBVHROBOPISAWDIJTSFPVAUZNJUMNUCOFIBIAAVIOWDTCNIPRVA9999TANGLE9BEAT9999999999999999SVIDBWNOF999999999K99999999POWSRVIO9VMIJ99UGNETMNPNNNE",
                "YU9WINMHSBIJ9HRBKDEHZYOCDGOZ9HZSSVXAYYOD9AMAFBCROMLSFDFIAQKEXAVFDLJYVABRSONSTTXLCQJTSDRFDEXZIORLRSQDZQODNCHAAFUPGBCEVYNRSJQGUZRAQIIEZPFQGWPQIBMDVNZGQAKCU9VLHGYSNDPHCMOCTRYQOYHFPRQSGHSDEF9MSHGXYGUTHSBSF9SOSJQFOZXMQGCUXAYWLBJHXOHTOM9ITZPISEXLAYAZBHTZDDCOIHKDBL9AAXZEDFHDYCPXLDGR9JTVXDXBC9DRDVREEEVGVPWVEZHJBYQYTGDEWQHVEDTAVLWW9WBXOIGDGUAAAVKFMPVKSYBVOIWPYGCMACEAAHGUIQVFLFMSCPKTYQWJDGMDNLMDIUUYI9SZOFQPLKKACESSWIXPFYZWDHETYUGEVASPHBGQPJPWVESSUUEVUYDYNQUQURSMCEPKIHYXNFHZSHIIDTMEZQ9IPSHTBDK9UHRSIIEJRILBCMVUMGAGBMHKEMUUKQDCYAVIAN9MBWJCAUSSJRSAUEUBGEFFCFSOBVGLXBAIDOH9NXWQUSIFUINEVZUWELLVIOSSQRVHMTDBCATBWFSDJJDLURAUKEQEIRICSCXAOJNPWHQKYVTRLCRKHLFHHHPYSMUEAPMQPMPS9CHCIYXEYRNIOOGRWKVHUGIWJZIGPWGZGBGYTVC9UVEJ9JBIYMDHYXLWIDXHZVFCCPLYXDPQPJGMKNZMMONGNXSNNPCGEGRJTMCPTJONGPAEDMSHMGAPGBDWVCSCTJAECSHTEGBMVCDZMQYZ9IHERWGCKAIMFOJRAEDRDSWJASV9XYS9CTOEETPQHRKJZ9FPWTVCGLEJQJXVVDTYZ9DNSHQAINKROQQIPTFGTABEELYPBQHGNNB9NCL9BVTG9MH99BPIRNNGC9MQQRH9YUDYSUJIDSZKCIGEKFSJ9PXUYKVPUZYFIREUAMUZE9EIMJK9YGAZXZBPRXIRDCEVDHWOCFIJTVRCRZRRJGFLILKVNMJAX9MUMTXCWTUTP9NXBZUMAYYY9DNVZTCROBCMMHVKSQRXMGROCMMCDENWQWBV9LEIJONWTQXOUQZOTGEJHJELYZOPICLDWPHVCMBFSYHPIJYZQDEGYITVPYNQMXPRTPKADLUKW9AEMSMGIWCUMOQMUDN9HZGYKTNVVNLOQAFVETEDJMJVKYCE9RE9AJP9RMYFKGDEC9GIGAFXEXIYXPFBOMRPULVJMYTQEPDMMIABDHJGRNNCKADZAUFV9WCWFYFHXLCED9E9SKKYHVKDTGNCHEKFJL9YJHTSRUVKEPHPCQSFNBXKOJNGBSEOZLVVGNUQTRACVGEKDSORUHVSDSQNUZASWXRADGAUDYDPODDEDNDDT9OAEARSBLPVSYAOEYYZJIZIZDENQOKMXATCTD9NEFVQWNCET9N9IXWCCWHYUBDTDJUZFXWMATRYSGJUQAFKAPIQIIXVFFEFNLGDPAIGKONUWLUTQTKZJYDEGPASTOMM9QTGOMYHFUKMNEVWPCMTLPDSOEEWDBRHZPZJIFMBUTY9QPRLPSVURIRMCWLH9YIZBOTJQMMF9ZP9VCCEGWVKSSQNANP9ZXVCAFGAVBXDJHUMKTKUBZRNKUGJTVUPDZMUK9KZI9EKY9DQDUNA9ZVPCROKYYPISSTDOJZJXMXZWSGZBEPKAUYPBPUTDVQKUYXWYTZXLYTCLLKLJUUJGFFCMZFKDTJET9KEDRMWZSAEFCSXLMRHRLG9EKLRZJ9NZQEONGFQSKSQMWRZXWVEGHCF9ZKGQITDLGFTZLCQMXVGVYIPKSUPPAOIKVWARJHAEJUZOOJFCFJTGQZWROSCEQSITQWZTQDFKECATBWSIRDFVWH9TXXUVEBRRKOTFSGBMGCMZDK9BJRVEUYOVNSLZNNSTWOB9CFNDJHJENDWSTIMMSWD9HSA9LDGTJDJFRGQCWOHYJNMFFLLDMVQEMCMNVQWMOGCEZUTK9MPULTDMKTIVFNVWXDNTRHNREHEDWIZCCRFVM9TXCTLBLYEKTRVVWHKZDOSYOBNLEKPNXMDZGLSVBBNBJIBZYBXZCENKVIXMNGUJUYFGFYFBKELSBZROQWKMESZTWDEEUCSXOWFSNJUGGJANMJFCBJV9GMDDJCAJHWKYQFJLFWZESTSIRBZQWYHGQDFUUWF9F9HXSBZRKBDLRWXSMKW99KPWJOQYPMHB9KWALSVLFNANYSMNWSJLUOCBKAWAJHNWMLPLXHVEPTKBPWLWHMDOE9999999999999999999999999999999999999999999999999999FDKW9AD99A99999999B99999999RJPQGE9AXNBBLPQ9IFJXFJTXJAIGDDXAWXGAVU9PJQNYFADJDIDBTJKSAEBBX9NWJGZVAVXYWXPCEFFH99XJLIVAZYJGPKEHANESX9DORLEIOIFL9WVQBBNUDRZDGJMVSRTSFKOJPIMEXPBCPGKUUEKRGAXOB99999XIFVJWCABR9XQKOWCXJAZDZWMWWBVHROBOPISAWDIJTSFPVAUZNJUMNUCOFIBIAAVIOWDTCNIPRVA9999999999999999999999999999999RSIDBWNOF999999999K99999999POWSRVIO9VMIJ99FKKNKGPNNNNP",
                "COSNPEACSPESTKTUS9CSMOCWVUBLERQJQGLLA9AYRRXMOVOBULQZZZJPLNELEX9EVZDAFOHBB9FBAYOTDB9YGJAVTDWNPJVVGEPFJ9QBYLXAYZEETY9GMYQRIRAIPWMJUFMFRSQRCEIOWISMBJKGCIGIIYNMXAYLXZIBNKANT9DSQXPBUPWGUJTOMD9JKSNFZJJFBZYBWRWQIZFOZXQWNJTRZTUPHVEGTAOLMBEPXOB9TCEBNIWXQUHNQJZHAOWGVOOOTSCTEUEMXJUODZP9CDLCMEXAW9YJGVNREENETEYXOAKZVRJVUSCRUSRCNZUGUOLCNHQITWYPJVJGPVULASTONDZRDVCNGJSN9DMMUORCOIBTITSPBXSAVTOHSAXHMGH99APRTQIVCEI9NWYKDOZCCWBNZGGCUCISSMGJHJ9OVSFBZVFMBODKRKSLIDESGFDQITCYFARWYTLFKSPLNVQ9LTYFODCHBAJKCWVZNBLOJH9ABFGDFOXHDNHZILINMYMVZYWTFJJOLADPTZRPJEMGPFQNYTFDGOKMDTDSKPTHIDWLMRSSACZMTHUCWVZHCYSPJRATABZ9JHWEBGTTQORGFOYDWUIYFYGOGGTYGYYI9RPKPMCTYNYKHHNWQKJTDQDHTRUYQPMCDDLVUUHUBPWGPMNQYPKHDHGIUSXJGNUXIYGZRGVYPTTV9KXJDLGVVXRIWIGKZJVCQ9DUWAYNDRKYCGKZDEOKZQCXELSQXLGLAPBDIWRTKGSIRNAZ9XFEGMWOWLPUA9TSGYRDOU9GKY9JJDKCJKKGJCRARGSNECJ9SEVAGPPJMBTMGNWSLNSFBOEYMIQBKOVSCTDIWCOQTHBVTZOFNNIYKKJLAROKIRFFPCLSOWO9BVNNJSXEYLJASPUEFKCEI9SGWADNGS9MZAKFTCAYNRVKGDIGYDTPGJXWFAEFGG9BX9XCNBZGQULH9IPPIQ9VFVAXGELUMCTE9TOFOGCTFYBYEBFOKKAESIIHEWLYLQKWDHPYNELJKMZHDSDSK9ZWFP99FQFLUXGTSVDMGHIFZFUCYTYPVEFEDM9TOHCQVIBXARYWZEKTWEOVSBYZTJZRUFZJCLRBTOWPTKY99CYQTGPMAKFYALIWPEQLUB9RGANTKDDMSDSJOTNPFZCXKJUGTJWWPK9FAJGPJOEBRHL9ZU9XRBDJBVMFIZIZFGKETH9RJUSDIOWDZIXFOJLT9DSIAWSCEYBNOGOAZQPZKVZTBXGACCBVQGFNGXNQFTVPUGUOHNBKTUERLSTDXGRKZSATIRHDBSXARYATBHOLUHCQGPRMQGSJUAXUCWKDXAUGORHFVVVDZQEYYGSV9IUM9VTMHJCIKBQD9TQLLYTZHAKDHPFGYMRGJOEDJKQTBBNFCKDEPYTPWUJEOPRJWHAILMVW9AXS9HAT9GCGRXZEHWNDOVGKGPWFXFC9IKLVZJCTGZUJFRHGL9FZWZYP9TPOWGOUTQ9INYBVTD9N9OV9AM9GYRJ99MRWRWLOAKJXMDTFNS9NZQAYGVZRJ9WVSIDRRQLGKH9VPUVKFWZMSRVVLKXUGJAZESC9LEYDNNDWS9WTWNFPCR9YKPOMIJAVHCRCJVBDFWSTDN9BPJRDMGZFXWTY9GUX9WEPJQMXSECFPREXAJ9DU9OLMNQFTF99QYZOGDUTMBHMNMCNUQTU9FTNEUNBT9NQO9YADGY9C9LQR9DYVJZE9GMMYAOUSWUIVJ9EAR9EEFCO9SZTQ9JQHPIJGXIOQZHOSUSVMHBOLTYSEONVLRISNAN9KJHHFFISTYIHYVAMXLPNALDELETXVSWGUWOIVKNAKZKNNRVNJKE9WMNQBXFGXSYZQQSIODAKINA9CPBOGAYKJ9V9GS9HERXSVYPEILYXC9GURBREBCXRZJVXHUOPGYFLPIFBCOTMHFTAAUQUZVEKOWYFFGSCXDFDBTSGZRMPQR9EYSZYGQETCWFDRXVOXXCUBOQTBQGVLAONSTSLURFYSDPAVNCXNWVPQOUORMVSLYISQUQKXFYYMJSGHQP9VAAZABEAGJMCPIEBZQSYCPS9CNKFBDRDTDA9C9MVKGUISRX9ODVUJNPDWMZ9ESYXJ99ETDGSTJZMZYJEGRUWTORMCLNHLDQ9YIJWPMDYGGJQHMFPJ9VKINJUESTCBJQXFTCJFNUXPZONVKXJRAYGKIWHXSBZRKBDLRWXSMKW99KPWJOQYPMHB9KWALSVLFNANYSMNWSJLUOCBKAWAJHNWMLPLXHVEPTKBPWLWHMD999999999999999999999999999999999999999999999999999999FDKW9AD99B99999999B99999999RJPQGE9AXNBBLPQ9IFJXFJTXJAIGDDXAWXGAVU9PJQNYFADJDIDBTJKSAEBBX9NWJGZVAVXYWXPCEFFH9XIFVJWCABR9XQKOWCXJAZDZWMWWBVHROBOPISAWDIJTSFPVAUZNJUMNUCOFIBIAAVIOWDTCNIPRVA9999FTXZAEQIKGFJABOGCCQGOMKNASGWCQWMNIMRDTHKPJMTKDGMEQNZOAYARIYEWFZYJALRKFODOITTZ9999999999999999999999999999999LLHDBWNOF999999999K99999999POWSRVIO9VMIJ99UMGMTTTPNNNV",
        };
        List<TransactionViewModel> transactions = persistAndMapTxs(trytes);
        assertTrue("should be true as bundle is inconsistent", BundleValidator.isInconsistent(transactions));
    }

    @Test
    public void checkInconsistencyOfConsistentBundle() {
        String[] trytes = {
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999GNXKWQPHMFCEZZCKUCCD9PROQVPCTBVVAPHCLVOPYYQLQRMPGTQXBVZLKGGT9NXHUAASFIAVEOZTBSM9DA99999999999999999999999999RENGLE9BEAT9999999999999999FDKW9AD99999999999B99999999RJPQGE9AXNBBLPQ9IFJXFJTXJAIGDDXAWXGAVU9PJQNYFADJDIDBTJKSAEBBX9NWJGZVAVXYWXPCEFFH9DKZYSMJAQRLXZHCNPTJPJLOONNDZHGNTBIINGYKZQAAWF9LWQTHUQSAXMLQN9DKCQWHIJXNGLGQVA9999XIFVJWCABR9XQKOWCXJAZDZWMWWBVHROBOPISAWDIJTSFPVAUZNJUMNUCOFIBIAAVIOWDTCNIPRVA9999TANGLE9BEAT9999999999999999SVIDBWNOF999999999K99999999POWSRVIO9VMIJ99UGNETMNPNNNE",
                "YU9WINMHSBIJ9HRBKDEHZYOCDGOZ9HZSSVXAYYOD9AMAFBCROMLSFDFIAQKEXAVFDLJYVABRSONSTTXLCQJTSDRFDEXZIORLRSQDZQODNCHAAFUPGBCEVYNRSJQGUZRAQIIEZPFQGWPQIBMDVNZGQAKCU9VLHGYSNDPHCMOCTRYQOYHFPRQSGHSDEF9MSHGXYGUTHSBSF9SOSJQFOZXMQGCUXAYWLBJHXOHTOM9ITZPISEXLAYAZBHTZDDCOIHKDBL9AAXZEDFHDYCPXLDGR9JTVXDXBC9DRDVREEEVGVPWVEZHJBYQYTGDEWQHVEDTAVLWW9WBXOIGDGUAAAVKFMPVKSYBVOIWPYGCMACEAAHGUIQVFLFMSCPKTYQWJDGMDNLMDIUUYI9SZOFQPLKKACESSWIXPFYZWDHETYUGEVASPHBGQPJPWVESSUUEVUYDYNQUQURSMCEPKIHYXNFHZSHIIDTMEZQ9IPSHTBDK9UHRSIIEJRILBCMVUMGAGBMHKEMUUKQDCYAVIAN9MBWJCAUSSJRSAUEUBGEFFCFSOBVGLXBAIDOH9NXWQUSIFUINEVZUWELLVIOSSQRVHMTDBCATBWFSDJJDLURAUKEQEIRICSCXAOJNPWHQKYVTRLCRKHLFHHHPYSMUEAPMQPMPS9CHCIYXEYRNIOOGRWKVHUGIWJZIGPWGZGBGYTVC9UVEJ9JBIYMDHYXLWIDXHZVFCCPLYXDPQPJGMKNZMMONGNXSNNPCGEGRJTMCPTJONGPAEDMSHMGAPGBDWVCSCTJAECSHTEGBMVCDZMQYZ9IHERWGCKAIMFOJRAEDRDSWJASV9XYS9CTOEETPQHRKJZ9FPWTVCGLEJQJXVVDTYZ9DNSHQAINKROQQIPTFGTABEELYPBQHGNNB9NCL9BVTG9MH99BPIRNNGC9MQQRH9YUDYSUJIDSZKCIGEKFSJ9PXUYKVPUZYFIREUAMUZE9EIMJK9YGAZXZBPRXIRDCEVDHWOCFIJTVRCRZRRJGFLILKVNMJAX9MUMTXCWTUTP9NXBZUMAYYY9DNVZTCROBCMMHVKSQRXMGROCMMCDENWQWBV9LEIJONWTQXOUQZOTGEJHJELYZOPICLDWPHVCMBFSYHPIJYZQDEGYITVPYNQMXPRTPKADLUKW9AEMSMGIWCUMOQMUDN9HZGYKTNVVNLOQAFVETEDJMJVKYCE9RE9AJP9RMYFKGDEC9GIGAFXEXIYXPFBOMRPULVJMYTQEPDMMIABDHJGRNNCKADZAUFV9WCWFYFHXLCED9E9SKKYHVKDTGNCHEKFJL9YJHTSRUVKEPHPCQSFNBXKOJNGBSEOZLVVGNUQTRACVGEKDSORUHVSDSQNUZASWXRADGAUDYDPODDEDNDDT9OAEARSBLPVSYAOEYYZJIZIZDENQOKMXATCTD9NEFVQWNCET9N9IXWCCWHYUBDTDJUZFXWMATRYSGJUQAFKAPIQIIXVFFEFNLGDPAIGKONUWLUTQTKZJYDEGPASTOMM9QTGOMYHFUKMNEVWPCMTLPDSOEEWDBRHZPZJIFMBUTY9QPRLPSVURIRMCWLH9YIZBOTJQMMF9ZP9VCCEGWVKSSQNANP9ZXVCAFGAVBXDJHUMKTKUBZRNKUGJTVUPDZMUK9KZI9EKY9DQDUNA9ZVPCROKYYPISSTDOJZJXMXZWSGZBEPKAUYPBPUTDVQKUYXWYTZXLYTCLLKLJUUJGFFCMZFKDTJET9KEDRMWZSAEFCSXLMRHRLG9EKLRZJ9NZQEONGFQSKSQMWRZXWVEGHCF9ZKGQITDLGFTZLCQMXVGVYIPKSUPPAOIKVWARJHAEJUZOOJFCFJTGQZWROSCEQSITQWZTQDFKECATBWSIRDFVWH9TXXUVEBRRKOTFSGBMGCMZDK9BJRVEUYOVNSLZNNSTWOB9CFNDJHJENDWSTIMMSWD9HSA9LDGTJDJFRGQCWOHYJNMFFLLDMVQEMCMNVQWMOGCEZUTK9MPULTDMKTIVFNVWXDNTRHNREHEDWIZCCRFVM9TXCTLBLYEKTRVVWHKZDOSYOBNLEKPNXMDZGLSVBBNBJIBZYBXZCENKVIXMNGUJUYFGFYFBKELSBZROQWKMESZTWDEEUCSXOWFSNJUGGJANMJFCBJV9GMDDJCAJHWKYQFJLFWZESTSIRBZQWYHGQDFUUWF9F9HXSBZRKBDLRWXSMKW99KPWJOQYPMHB9KWALSVLFNANYSMNWSJLUOCBKAWAJHNWMLPLXHVEPTKBPWLWHMDZ99999999999999999999999999999999999999999999999999999FDKW9AD99A99999999B99999999RJPQGE9AXNBBLPQ9IFJXFJTXJAIGDDXAWXGAVU9PJQNYFADJDIDBTJKSAEBBX9NWJGZVAVXYWXPCEFFH99XJLIVAZYJGPKEHANESX9DORLEIOIFL9WVQBBNUDRZDGJMVSRTSFKOJPIMEXPBCPGKUUEKRGAXOB99999XIFVJWCABR9XQKOWCXJAZDZWMWWBVHROBOPISAWDIJTSFPVAUZNJUMNUCOFIBIAAVIOWDTCNIPRVA9999999999999999999999999999999RSIDBWNOF999999999K99999999POWSRVIO9VMIJ99FKKNKGPNNNNP",
                "COSNPEACSPESTKTUS9CSMOCWVUBLERQJQGLLA9AYRRXMOVOBULQZZZJPLNELEX9EVZDAFOHBB9FBAYOTDB9YGJAVTDWNPJVVGEPFJ9QBYLXAYZEETY9GMYQRIRAIPWMJUFMFRSQRCEIOWISMBJKGCIGIIYNMXAYLXZIBNKANT9DSQXPBUPWGUJTOMD9JKSNFZJJFBZYBWRWQIZFOZXQWNJTRZTUPHVEGTAOLMBEPXOB9TCEBNIWXQUHNQJZHAOWGVOOOTSCTEUEMXJUODZP9CDLCMEXAW9YJGVNREENETEYXOAKZVRJVUSCRUSRCNZUGUOLCNHQITWYPJVJGPVULASTONDZRDVCNGJSN9DMMUORCOIBTITSPBXSAVTOHSAXHMGH99APRTQIVCEI9NWYKDOZCCWBNZGGCUCISSMGJHJ9OVSFBZVFMBODKRKSLIDESGFDQITCYFARWYTLFKSPLNVQ9LTYFODCHBAJKCWVZNBLOJH9ABFGDFOXHDNHZILINMYMVZYWTFJJOLADPTZRPJEMGPFQNYTFDGOKMDTDSKPTHIDWLMRSSACZMTHUCWVZHCYSPJRATABZ9JHWEBGTTQORGFOYDWUIYFYGOGGTYGYYI9RPKPMCTYNYKHHNWQKJTDQDHTRUYQPMCDDLVUUHUBPWGPMNQYPKHDHGIUSXJGNUXIYGZRGVYPTTV9KXJDLGVVXRIWIGKZJVCQ9DUWAYNDRKYCGKZDEOKZQCXELSQXLGLAPBDIWRTKGSIRNAZ9XFEGMWOWLPUA9TSGYRDOU9GKY9JJDKCJKKGJCRARGSNECJ9SEVAGPPJMBTMGNWSLNSFBOEYMIQBKOVSCTDIWCOQTHBVTZOFNNIYKKJLAROKIRFFPCLSOWO9BVNNJSXEYLJASPUEFKCEI9SGWADNGS9MZAKFTCAYNRVKGDIGYDTPGJXWFAEFGG9BX9XCNBZGQULH9IPPIQ9VFVAXGELUMCTE9TOFOGCTFYBYEBFOKKAESIIHEWLYLQKWDHPYNELJKMZHDSDSK9ZWFP99FQFLUXGTSVDMGHIFZFUCYTYPVEFEDM9TOHCQVIBXARYWZEKTWEOVSBYZTJZRUFZJCLRBTOWPTKY99CYQTGPMAKFYALIWPEQLUB9RGANTKDDMSDSJOTNPFZCXKJUGTJWWPK9FAJGPJOEBRHL9ZU9XRBDJBVMFIZIZFGKETH9RJUSDIOWDZIXFOJLT9DSIAWSCEYBNOGOAZQPZKVZTBXGACCBVQGFNGXNQFTVPUGUOHNBKTUERLSTDXGRKZSATIRHDBSXARYATBHOLUHCQGPRMQGSJUAXUCWKDXAUGORHFVVVDZQEYYGSV9IUM9VTMHJCIKBQD9TQLLYTZHAKDHPFGYMRGJOEDJKQTBBNFCKDEPYTPWUJEOPRJWHAILMVW9AXS9HAT9GCGRXZEHWNDOVGKGPWFXFC9IKLVZJCTGZUJFRHGL9FZWZYP9TPOWGOUTQ9INYBVTD9N9OV9AM9GYRJ99MRWRWLOAKJXMDTFNS9NZQAYGVZRJ9WVSIDRRQLGKH9VPUVKFWZMSRVVLKXUGJAZESC9LEYDNNDWS9WTWNFPCR9YKPOMIJAVHCRCJVBDFWSTDN9BPJRDMGZFXWTY9GUX9WEPJQMXSECFPREXAJ9DU9OLMNQFTF99QYZOGDUTMBHMNMCNUQTU9FTNEUNBT9NQO9YADGY9C9LQR9DYVJZE9GMMYAOUSWUIVJ9EAR9EEFCO9SZTQ9JQHPIJGXIOQZHOSUSVMHBOLTYSEONVLRISNAN9KJHHFFISTYIHYVAMXLPNALDELETXVSWGUWOIVKNAKZKNNRVNJKE9WMNQBXFGXSYZQQSIODAKINA9CPBOGAYKJ9V9GS9HERXSVYPEILYXC9GURBREBCXRZJVXHUOPGYFLPIFBCOTMHFTAAUQUZVEKOWYFFGSCXDFDBTSGZRMPQR9EYSZYGQETCWFDRXVOXXCUBOQTBQGVLAONSTSLURFYSDPAVNCXNWVPQOUORMVSLYISQUQKXFYYMJSGHQP9VAAZABEAGJMCPIEBZQSYCPS9CNKFBDRDTDA9C9MVKGUISRX9ODVUJNPDWMZ9ESYXJ99ETDGSTJZMZYJEGRUWTORMCLNHLDQ9YIJWPMDYGGJQHMFPJ9VKINJUESTCBJQXFTCJFNUXPZONVKXJRAYGKIWHXSBZRKBDLRWXSMKW99KPWJOQYPMHB9KWALSVLFNANYSMNWSJLUOCBKAWAJHNWMLPLXHVEPTKBPWLWHMD999999999999999999999999999999999999999999999999999999FDKW9AD99B99999999B99999999RJPQGE9AXNBBLPQ9IFJXFJTXJAIGDDXAWXGAVU9PJQNYFADJDIDBTJKSAEBBX9NWJGZVAVXYWXPCEFFH9XIFVJWCABR9XQKOWCXJAZDZWMWWBVHROBOPISAWDIJTSFPVAUZNJUMNUCOFIBIAAVIOWDTCNIPRVA9999FTXZAEQIKGFJABOGCCQGOMKNASGWCQWMNIMRDTHKPJMTKDGMEQNZOAYARIYEWFZYJALRKFODOITTZ9999999999999999999999999999999LLHDBWNOF999999999K99999999POWSRVIO9VMIJ99UMGMTTTPNNNV",
        };
        List<TransactionViewModel> transactions = persistAndMapTxs(trytes);
        assertFalse("should be false because bundle is consistent", BundleValidator.isInconsistent(transactions));
    }

    @Test
    public void validateValidBundle() throws Exception {
        String[] trytes = {
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999GNXKWQPHMFCEZZCKUCCD9PROQVPCTBVVAPHCLVOPYYQLQRMPGTQXBVZLKGGT9NXHUAASFIAVEOZTBSM9DA99999999999999999999999999RENGLE9BEAT9999999999999999FDKW9AD99999999999B99999999RJPQGE9AXNBBLPQ9IFJXFJTXJAIGDDXAWXGAVU9PJQNYFADJDIDBTJKSAEBBX9NWJGZVAVXYWXPCEFFH9DKZYSMJAQRLXZHCNPTJPJLOONNDZHGNTBIINGYKZQAAWF9LWQTHUQSAXMLQN9DKCQWHIJXNGLGQVA9999XIFVJWCABR9XQKOWCXJAZDZWMWWBVHROBOPISAWDIJTSFPVAUZNJUMNUCOFIBIAAVIOWDTCNIPRVA9999TANGLE9BEAT9999999999999999SVIDBWNOF999999999K99999999POWSRVIO9VMIJ99UGNETMNPNNNE",
                "YU9WINMHSBIJ9HRBKDEHZYOCDGOZ9HZSSVXAYYOD9AMAFBCROMLSFDFIAQKEXAVFDLJYVABRSONSTTXLCQJTSDRFDEXZIORLRSQDZQODNCHAAFUPGBCEVYNRSJQGUZRAQIIEZPFQGWPQIBMDVNZGQAKCU9VLHGYSNDPHCMOCTRYQOYHFPRQSGHSDEF9MSHGXYGUTHSBSF9SOSJQFOZXMQGCUXAYWLBJHXOHTOM9ITZPISEXLAYAZBHTZDDCOIHKDBL9AAXZEDFHDYCPXLDGR9JTVXDXBC9DRDVREEEVGVPWVEZHJBYQYTGDEWQHVEDTAVLWW9WBXOIGDGUAAAVKFMPVKSYBVOIWPYGCMACEAAHGUIQVFLFMSCPKTYQWJDGMDNLMDIUUYI9SZOFQPLKKACESSWIXPFYZWDHETYUGEVASPHBGQPJPWVESSUUEVUYDYNQUQURSMCEPKIHYXNFHZSHIIDTMEZQ9IPSHTBDK9UHRSIIEJRILBCMVUMGAGBMHKEMUUKQDCYAVIAN9MBWJCAUSSJRSAUEUBGEFFCFSOBVGLXBAIDOH9NXWQUSIFUINEVZUWELLVIOSSQRVHMTDBCATBWFSDJJDLURAUKEQEIRICSCXAOJNPWHQKYVTRLCRKHLFHHHPYSMUEAPMQPMPS9CHCIYXEYRNIOOGRWKVHUGIWJZIGPWGZGBGYTVC9UVEJ9JBIYMDHYXLWIDXHZVFCCPLYXDPQPJGMKNZMMONGNXSNNPCGEGRJTMCPTJONGPAEDMSHMGAPGBDWVCSCTJAECSHTEGBMVCDZMQYZ9IHERWGCKAIMFOJRAEDRDSWJASV9XYS9CTOEETPQHRKJZ9FPWTVCGLEJQJXVVDTYZ9DNSHQAINKROQQIPTFGTABEELYPBQHGNNB9NCL9BVTG9MH99BPIRNNGC9MQQRH9YUDYSUJIDSZKCIGEKFSJ9PXUYKVPUZYFIREUAMUZE9EIMJK9YGAZXZBPRXIRDCEVDHWOCFIJTVRCRZRRJGFLILKVNMJAX9MUMTXCWTUTP9NXBZUMAYYY9DNVZTCROBCMMHVKSQRXMGROCMMCDENWQWBV9LEIJONWTQXOUQZOTGEJHJELYZOPICLDWPHVCMBFSYHPIJYZQDEGYITVPYNQMXPRTPKADLUKW9AEMSMGIWCUMOQMUDN9HZGYKTNVVNLOQAFVETEDJMJVKYCE9RE9AJP9RMYFKGDEC9GIGAFXEXIYXPFBOMRPULVJMYTQEPDMMIABDHJGRNNCKADZAUFV9WCWFYFHXLCED9E9SKKYHVKDTGNCHEKFJL9YJHTSRUVKEPHPCQSFNBXKOJNGBSEOZLVVGNUQTRACVGEKDSORUHVSDSQNUZASWXRADGAUDYDPODDEDNDDT9OAEARSBLPVSYAOEYYZJIZIZDENQOKMXATCTD9NEFVQWNCET9N9IXWCCWHYUBDTDJUZFXWMATRYSGJUQAFKAPIQIIXVFFEFNLGDPAIGKONUWLUTQTKZJYDEGPASTOMM9QTGOMYHFUKMNEVWPCMTLPDSOEEWDBRHZPZJIFMBUTY9QPRLPSVURIRMCWLH9YIZBOTJQMMF9ZP9VCCEGWVKSSQNANP9ZXVCAFGAVBXDJHUMKTKUBZRNKUGJTVUPDZMUK9KZI9EKY9DQDUNA9ZVPCROKYYPISSTDOJZJXMXZWSGZBEPKAUYPBPUTDVQKUYXWYTZXLYTCLLKLJUUJGFFCMZFKDTJET9KEDRMWZSAEFCSXLMRHRLG9EKLRZJ9NZQEONGFQSKSQMWRZXWVEGHCF9ZKGQITDLGFTZLCQMXVGVYIPKSUPPAOIKVWARJHAEJUZOOJFCFJTGQZWROSCEQSITQWZTQDFKECATBWSIRDFVWH9TXXUVEBRRKOTFSGBMGCMZDK9BJRVEUYOVNSLZNNSTWOB9CFNDJHJENDWSTIMMSWD9HSA9LDGTJDJFRGQCWOHYJNMFFLLDMVQEMCMNVQWMOGCEZUTK9MPULTDMKTIVFNVWXDNTRHNREHEDWIZCCRFVM9TXCTLBLYEKTRVVWHKZDOSYOBNLEKPNXMDZGLSVBBNBJIBZYBXZCENKVIXMNGUJUYFGFYFBKELSBZROQWKMESZTWDEEUCSXOWFSNJUGGJANMJFCBJV9GMDDJCAJHWKYQFJLFWZESTSIRBZQWYHGQDFUUWF9F9HXSBZRKBDLRWXSMKW99KPWJOQYPMHB9KWALSVLFNANYSMNWSJLUOCBKAWAJHNWMLPLXHVEPTKBPWLWHMDZ99999999999999999999999999999999999999999999999999999FDKW9AD99A99999999B99999999RJPQGE9AXNBBLPQ9IFJXFJTXJAIGDDXAWXGAVU9PJQNYFADJDIDBTJKSAEBBX9NWJGZVAVXYWXPCEFFH99XJLIVAZYJGPKEHANESX9DORLEIOIFL9WVQBBNUDRZDGJMVSRTSFKOJPIMEXPBCPGKUUEKRGAXOB99999XIFVJWCABR9XQKOWCXJAZDZWMWWBVHROBOPISAWDIJTSFPVAUZNJUMNUCOFIBIAAVIOWDTCNIPRVA9999999999999999999999999999999RSIDBWNOF999999999K99999999POWSRVIO9VMIJ99FKKNKGPNNNNP",
                "COSNPEACSPESTKTUS9CSMOCWVUBLERQJQGLLA9AYRRXMOVOBULQZZZJPLNELEX9EVZDAFOHBB9FBAYOTDB9YGJAVTDWNPJVVGEPFJ9QBYLXAYZEETY9GMYQRIRAIPWMJUFMFRSQRCEIOWISMBJKGCIGIIYNMXAYLXZIBNKANT9DSQXPBUPWGUJTOMD9JKSNFZJJFBZYBWRWQIZFOZXQWNJTRZTUPHVEGTAOLMBEPXOB9TCEBNIWXQUHNQJZHAOWGVOOOTSCTEUEMXJUODZP9CDLCMEXAW9YJGVNREENETEYXOAKZVRJVUSCRUSRCNZUGUOLCNHQITWYPJVJGPVULASTONDZRDVCNGJSN9DMMUORCOIBTITSPBXSAVTOHSAXHMGH99APRTQIVCEI9NWYKDOZCCWBNZGGCUCISSMGJHJ9OVSFBZVFMBODKRKSLIDESGFDQITCYFARWYTLFKSPLNVQ9LTYFODCHBAJKCWVZNBLOJH9ABFGDFOXHDNHZILINMYMVZYWTFJJOLADPTZRPJEMGPFQNYTFDGOKMDTDSKPTHIDWLMRSSACZMTHUCWVZHCYSPJRATABZ9JHWEBGTTQORGFOYDWUIYFYGOGGTYGYYI9RPKPMCTYNYKHHNWQKJTDQDHTRUYQPMCDDLVUUHUBPWGPMNQYPKHDHGIUSXJGNUXIYGZRGVYPTTV9KXJDLGVVXRIWIGKZJVCQ9DUWAYNDRKYCGKZDEOKZQCXELSQXLGLAPBDIWRTKGSIRNAZ9XFEGMWOWLPUA9TSGYRDOU9GKY9JJDKCJKKGJCRARGSNECJ9SEVAGPPJMBTMGNWSLNSFBOEYMIQBKOVSCTDIWCOQTHBVTZOFNNIYKKJLAROKIRFFPCLSOWO9BVNNJSXEYLJASPUEFKCEI9SGWADNGS9MZAKFTCAYNRVKGDIGYDTPGJXWFAEFGG9BX9XCNBZGQULH9IPPIQ9VFVAXGELUMCTE9TOFOGCTFYBYEBFOKKAESIIHEWLYLQKWDHPYNELJKMZHDSDSK9ZWFP99FQFLUXGTSVDMGHIFZFUCYTYPVEFEDM9TOHCQVIBXARYWZEKTWEOVSBYZTJZRUFZJCLRBTOWPTKY99CYQTGPMAKFYALIWPEQLUB9RGANTKDDMSDSJOTNPFZCXKJUGTJWWPK9FAJGPJOEBRHL9ZU9XRBDJBVMFIZIZFGKETH9RJUSDIOWDZIXFOJLT9DSIAWSCEYBNOGOAZQPZKVZTBXGACCBVQGFNGXNQFTVPUGUOHNBKTUERLSTDXGRKZSATIRHDBSXARYATBHOLUHCQGPRMQGSJUAXUCWKDXAUGORHFVVVDZQEYYGSV9IUM9VTMHJCIKBQD9TQLLYTZHAKDHPFGYMRGJOEDJKQTBBNFCKDEPYTPWUJEOPRJWHAILMVW9AXS9HAT9GCGRXZEHWNDOVGKGPWFXFC9IKLVZJCTGZUJFRHGL9FZWZYP9TPOWGOUTQ9INYBVTD9N9OV9AM9GYRJ99MRWRWLOAKJXMDTFNS9NZQAYGVZRJ9WVSIDRRQLGKH9VPUVKFWZMSRVVLKXUGJAZESC9LEYDNNDWS9WTWNFPCR9YKPOMIJAVHCRCJVBDFWSTDN9BPJRDMGZFXWTY9GUX9WEPJQMXSECFPREXAJ9DU9OLMNQFTF99QYZOGDUTMBHMNMCNUQTU9FTNEUNBT9NQO9YADGY9C9LQR9DYVJZE9GMMYAOUSWUIVJ9EAR9EEFCO9SZTQ9JQHPIJGXIOQZHOSUSVMHBOLTYSEONVLRISNAN9KJHHFFISTYIHYVAMXLPNALDELETXVSWGUWOIVKNAKZKNNRVNJKE9WMNQBXFGXSYZQQSIODAKINA9CPBOGAYKJ9V9GS9HERXSVYPEILYXC9GURBREBCXRZJVXHUOPGYFLPIFBCOTMHFTAAUQUZVEKOWYFFGSCXDFDBTSGZRMPQR9EYSZYGQETCWFDRXVOXXCUBOQTBQGVLAONSTSLURFYSDPAVNCXNWVPQOUORMVSLYISQUQKXFYYMJSGHQP9VAAZABEAGJMCPIEBZQSYCPS9CNKFBDRDTDA9C9MVKGUISRX9ODVUJNPDWMZ9ESYXJ99ETDGSTJZMZYJEGRUWTORMCLNHLDQ9YIJWPMDYGGJQHMFPJ9VKINJUESTCBJQXFTCJFNUXPZONVKXJRAYGKIWHXSBZRKBDLRWXSMKW99KPWJOQYPMHB9KWALSVLFNANYSMNWSJLUOCBKAWAJHNWMLPLXHVEPTKBPWLWHMD999999999999999999999999999999999999999999999999999999FDKW9AD99B99999999B99999999RJPQGE9AXNBBLPQ9IFJXFJTXJAIGDDXAWXGAVU9PJQNYFADJDIDBTJKSAEBBX9NWJGZVAVXYWXPCEFFH9XIFVJWCABR9XQKOWCXJAZDZWMWWBVHROBOPISAWDIJTSFPVAUZNJUMNUCOFIBIAAVIOWDTCNIPRVA9999FTXZAEQIKGFJABOGCCQGOMKNASGWCQWMNIMRDTHKPJMTKDGMEQNZOAYARIYEWFZYJALRKFODOITTZ9999999999999999999999999999999LLHDBWNOF999999999K99999999POWSRVIO9VMIJ99UMGMTTTPNNNV",
        };
        List<TransactionViewModel> transactions = persistAndMapTxs(trytes);
        List<TransactionViewModel> bundleTxs = bundleValidator.validate(tangle, snapshotProvider.getInitialSnapshot(),
                transactions.get(0).getHash());
        assertFalse("all txs from the valid bundle should be returned", bundleTxs.isEmpty());
        assertEquals("should have changed the validity of the tail tx to valid", 1,
                bundleTxs.get(0).getValidity());
    }

    @Test
    public void validateBiggerValidBundle() throws Exception {
        String[] trytes = {
                "BYTES9IO9MILESTONE9FOUR9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999MGLOFJZHGVVJIWO9QPFUCVOVGUSZCVBGAXPBGJBBAUOMEAZYANMULKVRJ9D9LTXMZNZUPKOFLBOWCTMWDREIVAMPJ9999999999999999999QH99999999999999999999999999DULM9D99999999999H99999999BJVQHAHPDFGNEELCFLIEXWWKZXLPUZQMDXFGKKOGPDEGJDALESJZFVKIIRJSGKXDNWJOQBRIUEBTGACG9FUVNZIPUCUFYQTSCOBXOCVX9LPGZZYNGEIAPZKNLRIYLGR9AYZUJZXQMEEYDLMDJTRYQBEXZBTAHZ9999ABQONKFWTKFCSKMUPVGPRNYIZTWETHIUNG9MFYKXLZRJHDUVIDBAL9QVDU9B9DHTYPMMDBCEFTLRA9999QH9999999999999999999999999YQWARLVNF999999999MMMMMMMMMNCSTBBIYBOFDUIJYHSGAQYKIKSJ",
                "GREEN9IOTA9MILESTONE9ONE999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999IWDNLCKONBLEVIKAZNTWQJIKTVPTCJEPMTHJAFYSTGNTSRGWZRAVSFSSEMRJBLZXQQTHYDHTRGWHQAQXXFCRFSGVA99999999999999999999999999999999999999999999999DULM9D99A99999999H99999999BJVQHAHPDFGNEELCFLIEXWWKZXLPUZQMDXFGKKOGPDEGJDALESJZFVKIIRJSGKXDNWJOQBRIUEBTGACG99OVSHXGIGQILJBEXTGFPIHBFHZJBSHBQWDPTPLXXIERIOMKODEE9SLLPGPBCGRQFFPHGZU99DBTTA9999ABQONKFWTKFCSKMUPVGPRNYIZTWETHIUNG9MFYKXLZRJHDUVIDBAL9QVDU9B9DHTYPMMDBCEFTLRA9999999999999999999999999999999YVNARLVNF999999999MMMMMMMMMQOUCQLOLWFNBCAKXUJKWCKPHUNC",
                "CRYPTO9CORE9MILESTONE9FOUR9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999QNLVNDCDQJTXQIWLOWFOVRHFMAEX9XUS9PEQJTEONIVYCHXYU9ZPIPVZGBVARAPRNII9UIWKNNUCLH9JAHHCQLMPC99999999999999999999999999999999999999999999999DULM9D99B99999999H99999999BJVQHAHPDFGNEELCFLIEXWWKZXLPUZQMDXFGKKOGPDEGJDALESJZFVKIIRJSGKXDNWJOQBRIUEBTGACG9MVXJKYCRJMGPVBAGVUMTNPAFNTWHKQCFDDKAHZBCWA9JIQOS9TYQCXFVVQDERHQ9TSVUCTWUYDWZ99999ABQONKFWTKFCSKMUPVGPRNYIZTWETHIUNG9MFYKXLZRJHDUVIDBAL9QVDU9B9DHTYPMMDBCEFTLRA9999999999999999999999999999999UYC9RLVNF999999999MMMMMMMMMZURSVUBYKASKBNRVXEXBIYIYKYV",
                "UNIO9CYCLUX9MILESTONE9ONE99999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999XDGJPNYMWBG9OENADBPMTWLEHLAHMDSEABARKJDYGWAXQKFCLQRKBJJPKJNTBVK9TLGHF9NGWDDWDHCOZJIMAWDXF99999999999999999999999999999999999999999999999DULM9D99C99999999H99999999BJVQHAHPDFGNEELCFLIEXWWKZXLPUZQMDXFGKKOGPDEGJDALESJZFVKIIRJSGKXDNWJOQBRIUEBTGACG9LCVWYIOLVPTCTY9MF9NE99ALRHGDBJNNUJPBHUNQYJUCQCCKXGQCKRFFXTOXXJZHOCXRPUTFCSQS99999ABQONKFWTKFCSKMUPVGPRNYIZTWETHIUNG9MFYKXLZRJHDUVIDBAL9QVDU9B9DHTYPMMDBCEFTLRA9999999999999999999999999999999IBR9RLVNF999999999MMMMMMMMMQGLJPBWI9MMLVX9BFDFZLXNZWNT",
                "UNIO9MAXIMILIAN9MILESTONE9ONE9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999GNFKTFVHZIYKSIRCVHATQ9MCGTTMURKQCRIBUXGOC9GIA9IHJAXAGOCERUOEOADNQBEOIETPHOKEGNSABDIBQRKDD99999999999999999999999999999999999999999999999DULM9D99D99999999H99999999BJVQHAHPDFGNEELCFLIEXWWKZXLPUZQMDXFGKKOGPDEGJDALESJZFVKIIRJSGKXDNWJOQBRIUEBTGACG9SGXBOFBKLNEGCOUQPJCDPOSYEXO9LHJVDVOOIUKAQIVBGLZQIFFBSZNRCBTFHHXAGESVLTITTXHQZ9999ABQONKFWTKFCSKMUPVGPRNYIZTWETHIUNG9MFYKXLZRJHDUVIDBAL9QVDU9B9DHTYPMMDBCEFTLRA9999999999999999999999999999999TWJZRLVNF999999999MMMMMMMMMCNSKCRQQNFNIOUDOLKMOZAJJIV9",
                "UNIO9LUNFARDO9MILESTONE9ONE999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999QUBTWTFCOKKCFJPQWTAZKZU9ABNIJLHTLJOHWQVGQHBQPCZXMPRRXZHFUOPOQCIKDGEDKOTCUVOHAFZKZRUUEHNXC99999999999999999999999999999999999999999999999DULM9D99E99999999H99999999BJVQHAHPDFGNEELCFLIEXWWKZXLPUZQMDXFGKKOGPDEGJDALESJZFVKIIRJSGKXDNWJOQBRIUEBTGACG9OMOBATWEWNMOJEBNTBXCLBOCFZXPM9TYGXEXYSR9MWRULXGNYBVFSBQGMAKBJDZNAXUOZKWDNBGYZ9999ABQONKFWTKFCSKMUPVGPRNYIZTWETHIUNG9MFYKXLZRJHDUVIDBAL9QVDU9B9DHTYPMMDBCEFTLRA9999999999999999999999999999999NJAZRLVNF999999999MMMMMMMMMFYGYRTZXPAEEADAPXNRFOIAGWKI",
                "MMVKAE9FJGAGLHZNOPZMQ9AKUUFDPXPRURVTYDNE9WYBCJVBQUVWRFKWJXCNQTHHUYUTCXYMIKAVMPNTDCPPJESPVHSKBKIKT99YACLJXVBJOTKUDGJXSOYPNHNUOJSDPDALPCCJFSUGPKJD9SNNAMYZVJGCPBVQ9XKUZWGCPTFIGBTDBFCLGDJCJLB9ZHGFPQWRRPSFEOMTEPGGKXKDXDLMKXBERPDDLXKWLS9RBXMO9OZRNAACVOMQEMIUWOZBVZMTFYSSAOL9PAEHVYWXUBMCGQQZSONIQDVZMQWRKDDQO9H9VHCRVIMFYLKKCLYXDIYASCNVVHPZBXFTQZKIMQDUMTHTDWBOPNANCEKZ9UYIFFJXVCXSMJRCLEHVHKLWTGYQFV9MKUKZHUUGSI9ECIWZG9RVYXATOOLHBJEIELLBPGQTAWHVIFGOMCRMKZRAJL9OGPQVDUQZREFNKM9BVTKNWXGSWSMIXMIBJZFKLFJQXNDQK9WQS9BGXCZFMZRXEBRQPXDCOOCESUOZHIZGFOKJNNDJPSNVII9FPDJGJXXTPDVK9RBJKXBDWHPRURQHIYKTOOWJLURKDJEXJGEJCONMXKQTNDFH99IAHTHFREYACWLEBHIBRYOFUWCBNRSAEBKHSDK9PXIKQMIKGUYVTWETELKQOHLWTERSOXUHERPP9QPHWOKTQOIOOVQLEPCEXDDJJEOMBKYYGWSTXULOROJUWRV9IFSWXMWXJJNIPXPHT9HLCRFHQONWCXHRPTXZSJGKKOJUVEQGLUNL9IZMOOSVHDBFOVGXIRPQUVR9VBOSRJITRGOFGNXROUTCUSJVLIFWE9TWQISIIKWIFU9BTCIRPLOAVGRKDNKWTTOOWYWJSHIXQKHZHDHUYTZ9JYPEZKJJQNYE9MDRTDQWDOJAJIRETMQQBKQKZJHL9JHAMNSOHNLUNVCXYPWEXMMHYNDILYJPBVXLCH9WPCZEGGNNWFDJQIXWBKJMVVVEXZ9QYZECA9OJMJSCDBAZUCNSVZAQ9QAZPEKBSOPMBTZUQOFVVTDRHRQLWXAFYHUPNNEMAWBPTWAZRODRWMXNNSWJVFAOFKRYZWPZBIOLKCDQVCPOSXHJV9CFH99DMJEWSQZQCGDJSXJZCTRMGKSAUERLABMSYKYQCQMFUOGRFNMQYTB9MWFHCIREOOCEUYWFKULDLQUWWOK9KICTJTNRMRAZ9VBYFYUTNAJVHDJRTVUHTGAAOA9IMKMFGGQTPFPDTBJEMOLJFKBKXNTQYJRBZOTU9VYHWQBOMBFUNZQXSSLBHRQCTHDPPOUVXVRCEMUVHGSNILKCGGVPJEVBERMENLHDIMBVQJESVEUIMZUMWBQTSODWHGOTBXOAMFWG9EATCXFUFTMDYDSMSTGMYSNAKXSAKXS9ATMRXOQMCXKPYU9KAIWJHLUWRWPZGXODZUWUIVGOMPCYYEDQOXPQTFNOYHDYTB9EADTPVMLCZKNGIWGNETKZYWOPRPQ9VPWB9F9RHNIAKGMBUWEVVGZRPCAFLGSERIPZSIDLLHWMZNJPTLIII9RPZ9NWAYLZDOKIKGVGEY9QGZMQTNJWPQ9JHMYHZOJVDARAUSIJITOGEVYADWDUSQWXYDWNZXDQZIMBLQWYDTFTIKEZPBDL9FDYGZFQZBWPGTYQSX9FQQDWNUCPKBGDDEN9ZPPMTZBSVG9JTLOECBONJUGTXSWKKERCQFQLTQOWGXFRAMHZIVEQDPTVXXSPABYGPHQAMWAUEDVQEUOYINFUTYYCCMHUUWIWTWRKBEJSJXZQQJTZHFMHZHYQLX9YPSZHPZ99VZAAZY9BBVZSUKHDSSSPYGKNPVGUHWL9YIRLCVRUTIWODDDISRQMAHC9TUMRNAPZOUFEKRNUKZAMFMFEEMDFGAEDBUXQFGZSJ9IFWZJAWKJVMHRMFIEZI9ROANK9PSQXXGR9SYDFQ9IUJIBZSCXHTAEVXMRSVJJYWSG9YJWFCDTVWNONBDQPQRAGIGTIYOKXIXAOOFHNRUUMAOAFDU9WUHXOTVPRPVPUS9HJMPVWOIRMGOMINADOMABMAQ9LI9QKOJCHDURDPIPTOHRAPKDGCBZELDFFRUWIDCHWLUMHMCQXNNATKFNMTWXDJFVPUBQ9YUHPQDZJNRARG9KLWNIB9GXSOVLNTASCXODMESDOCVACOHGNEQXFXBTWBFGHTQJAWDORTBCJYE9G9LSFELUIILEESSERWLUAXNBLRGTXHZFHMMEGASWCECCODFBNNJC9WKG9BPKVABN9KX99999999999999999999999999999999999999999999ZEULM9D99F99999999H99999999BJVQHAHPDFGNEELCFLIEXWWKZXLPUZQMDXFGKKOGPDEGJDALESJZFVKIIRJSGKXDNWJOQBRIUEBTGACG9HPFGHSHBORRAORIIKVPLFHWHXYMZZPLYWFOSSDRDTOZGDUBDBMXTTAQAJ9BZRPURJUORJKDDUWOEZ9999ABQONKFWTKFCSKMUPVGPRNYIZTWETHIUNG9MFYKXLZRJHDUVIDBAL9QVDU9B9DHTYPMMDBCEFTLRA9999999999999999999999999999999QRAZRLVNF999999999MMMMMMMMMPRAQU9KOBJERWZHEWOFXMFORMRX",
                "QLLGAJRIPGQLYBXNEGCUCMXLKGIMSXETYTUSLIS9XYTWXCLKJMYFTHRXTUCZUSS9UNOJRVESVRNRTYUPZRQCLNLNTUHWYLRTCE9LMSWOERWCCWJMOQFJBDADQFZYOWGDDUINUVSOG9XFAHFWGRWMMFVKRIGPHKPZNCILRKLIDRQBZSXTLBXNBISEAZ9JB9UCARIYBPMYWZGGNDTWHQJUXXTBDBKVNYEVUNMOAEEOCWODCXDHVUXHNIYYAFOYVFOKGXLWNMXENKPOBYHRNOYMMBMYOOUYGNQAGXXCZPYYEYKE9RJTZCYKOSDJINCGVCVBTIUWLERVECPKGZGTEALJIQCIMOMGFTBAFRHNBHNATRIZJNCRMONNWGIK9QYTLFQOVCEDTNWPLIYPTEUQGACPXVYOWKEYANSAQOZOJS9NB9BPFJJ9HQJWWQISNDGXYDWOX9EXOOXTPEOET9FWBU9STXQWONCMDKJZSQY99XBAHOWXIBNAAGWGGXGX9OUJHIKZLDJNBVWUNIHSGQE9IDMZVHDRYKUWXRWNFKJLYMOPUIXAPYXDQBMVYDWGXDGLYANSQFEAKDCB9QWMPRC9URCIOJPYUBZFGTBJKUBLDF9TGEPQCPMU9U9MTKREH9INRLDAIDJYWTODIYHRYCXWNHKVOPTRSTVYQTSIECHXMRBXEKBTM9IHHTPOITDKZJKLBVMIKQENRYAKWYTJLDEGDTRNXUWPXZIFXWBFZ9KRDNQEXNWONISTBHUVLCFMYZVOSSXQPLLXOMIQDAB9BGNHICBNIJ9GMPVTGT9CMNQKUHLUVWRDQUUJSZKPT9HIITMUTWMIXGDPTUXSATCQMQCRFXLGMSIWRHGGHOERFHBGNZDJQBDHANEILGVCHWBQHOYBXPSSZ9GUTHELXUBBHWC9JPFWJQZJJXLQFIUMLKKPLFTJEPHCYGOECQDYVYKRHLQAEKIHCZTDQIIBLZ99MNDSXLKXMTLSMOGD9SKKYSDFTDMPTHIAKHTBJXQJJPFDABGBMD9JTXDNBQYPTDOE9RZ9WLD9WDDNWMYDZYWAQAM9PYXSQGCPKCIWLSGKISHGJ9TPAXJVOPFVLPVEQ9YYHLWWQXQUOHOFLXQNMJWWVAPFR9FIZEHTOBPZPSKYOWSREPH9CXLEEVFCPGMDYYOEJUFADPMCQGQNDSEBONQRQYXZKDYIXCXBUUYAHLYKANCARTUVSLWSGJBPROCAFBBZWHRIBVVNQMUCONOPPEVXNENSCWOYYXJYWWIDBLHDIBQSGH9XUFBKHZEOXYEAMKPWNRZ9ZASASRQQEEEUGVZBNJVEJLQJEDUMDYYPNNILLVJBYIHWKVJUOQVCBINPUMTOPONBXZGBSOTAK9GVATSSAQPZJFBNOYHWFVXCHEFHPIVQPWEWSIBYWBFNNDWTFKWJS9S9NXBA9IVYRWGGGCK9VRZLLXYSZTQKZMENOACLIUWFZDOHRMKWHS9WFMLMFCGJGZVXWEFZWSYKEYCNBCU9QTMTJOEJXTFDFSFOMKCFNPVSWHVGIPJVQPWAPHXVELPRJMOTVRJOPUNAPWBGIQEOWPXXOLJNBYICVVNMDFZAAXDUOOYJDNVJJMAKCGSYKJQB9SMUIOBXGMFTZTHAPISGEKRKROEENVROTJMTWVCWWNSV9B9WLCQASMSKCOMMXPBTFV9ZNSFIZUDVYHU9PKOJEBOSABQATXBYNJFLBDDKOSRYOEDMYROSAEVJJTZFPLI9LIBGTJQYXOMRVOXX99QQREYTN9LGTYI9GDI9DQRTCC9THBMJSJSPBGFYKNZBUGI99MEZLNVJRJRIHLDBMWQYFTXKDTETRPVQVHZUTYNQCLIJVWCGSK9VSMWPTIWUCACBZGHQLAXRQGMKAWDQATGHYDVHRWEGECJCBUZYTX9FV9SXVM9BEGUGNHTPCQUIRQYKMKDSNVEGJ9CDDDEYSJJSKBTMWYVUTMBWPGORZSQNHNYVHBGHQWDAXVILELXIFQWCDVAKUEQSPLCZFPUDBUCTTYXAHOMFWCZCEKTDDKTIDUUZSEDJKDVZRHGLLZCTLRFEE9TPSFPELRCSGAHIW9MTLLYJGDJSZHVWFAEETQHPEORKSXZVYPXZRAKLXFSOLSQMTVECTLVGE9MYWFSSUBPVJJBBEKACVPJNGUVQFT9PZSXBPBNPR9NAQUKWKPIFSPYFXBTWBFGHTQJAWDORTBCJYE9G9LSFELUIILEESSERWLUAXNBLRGTXHZFHMMEGASWCECCODFBNNJC9WKG9999999999999999999999999999999999999999999999999999999ZEULM9D99G99999999H99999999BJVQHAHPDFGNEELCFLIEXWWKZXLPUZQMDXFGKKOGPDEGJDALESJZFVKIIRJSGKXDNWJOQBRIUEBTGACG9ICQWKRZNLRACDFVCFHJPHRQ99XCSLOB9QSOPYRDZNKYZBXPQCNRDPYPMZWZLSJZPJWZFQABXS9YVZ9999ABQONKFWTKFCSKMUPVGPRNYIZTWETHIUNG9MFYKXLZRJHDUVIDBAL9QVDU9B9DHTYPMMDBCEFTLRA9999999999999999999999999999999RBQZRLVNF999999999MMMMMMMMMPVOGGTPWW9AQFIDNYXKYZRNPOUD",
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999G9EQ9IARCEMSKSMKYWKHUCGSXMGCT9LAAIHBWIWNIYWFTSGJRHSLXGXQNXKHJOXNMWQHPYMKOKSRL9TDDOJCQ9QNBOC999999999999999999999999999999999999999999999EULM9D99H99999999H99999999BJVQHAHPDFGNEELCFLIEXWWKZXLPUZQMDXFGKKOGPDEGJDALESJZFVKIIRJSGKXDNWJOQBRIUEBTGACG9ABQONKFWTKFCSKMUPVGPRNYIZTWETHIUNG9MFYKXLZRJHDUVIDBAL9QVDU9B9DHTYPMMDBCEFTLRA9999RNEQYL9XYIWHGTEQHZAPXZPWRRXOGXPJXHCV9OSTYLL9AVTMEXKG9HPIPKITPXQGEWIJIXVIEUNS99999999999999999999999999999999GBMYRLVNF999999999MMMMMMMMMAYSMPUWFG9OTFD9YMETBNVGMLRA",
        };
        List<TransactionViewModel> transactions = persistAndMapTxs(trytes);
        List<TransactionViewModel> bundleTxs = bundleValidator.validate(tangle, snapshotProvider.getInitialSnapshot(),
                transactions.get(0).getHash());
        assertFalse("all txs from the valid bundle should be returned", bundleTxs.isEmpty());
        assertEquals("should have changed the validity of the tail tx to valid", 1,
                bundleTxs.get(0).getValidity());
    }

    @Test
    public void validateBundleWithInvalidSignature() throws Exception {
        String[] trytes = {
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999GNXKWQPHMFCEZZCKUCCD9PROQVPCTBVVAPHCLVOPYYQLQRMPGTQXBVZLKGGT9NXHUAASFIAVEOZTBSM9DA99999999999999999999999999RENGLE9BEAT9999999999999999FDKW9AD99999999999B99999999RJPQGE9AXNBBLPQ9IFJXFJTXJAIGDDXAWXGAVU9PJQNYFADJDIDBTJKSAEBBX9NWJGZVAVXYWXPCEFFH9DKZYSMJAQRLXZHCNPTJPJLOONNDZHGNTBIINGYKZQAAWF9LWQTHUQSAXMLQN9DKCQWHIJXNGLGQVA9999XIFVJWCABR9XQKOWCXJAZDZWMWWBVHROBOPISAWDIJTSFPVAUZNJUMNUCOFIBIAAVIOWDTCNIPRVA9999TANGLE9BEAT9999999999999999SVIDBWNOF999999999K99999999POWSRVIO9VMIJ99UGNETMNPNNNE",
                "AAAAAAAABIJ9HRBKDEHZYOCDGOZ9HZSSVXAYYOD9AMAFBCROMLSFDFIAQKEXAVFDLJYVABRSONSTTXLCQJTSDRFDEXZIORLRSQDZQODNCHAAFUPGBCEVYNRSJQGUZRAQIIEZPFQGWPQIBMDVNZGQAKCU9VLHGYSNDPHCMOCTRYQOYHFPRQSGHSDEF9MSHGXYGUTHSBSF9SOSJQFOZXMQGCUXAYWLBJHXOHTOM9ITZPISEXLAYAZBHTZDDCOIHKDBL9AAXZEDFHDYCPXLDGR9JTVXDXBC9DRDVREEEVGVPWVEZHJBYQYTGDEWQHVEDTAVLWW9WBXOIGDGUAAAVKFMPVKSYBVOIWPYGCMACEAAHGUIQVFLFMSCPKTYQWJDGMDNLMDIUUYI9SZOFQPLKKACESSWIXPFYZWDHETYUGEVASPHBGQPJPWVESSUUEVUYDYNQUQURSMCEPKIHYXNFHZSHIIDTMEZQ9IPSHTBDK9UHRSIIEJRILBCMVUMGAGBMHKEMUUKQDCYAVIAN9MBWJCAUSSJRSAUEUBGEFFCFSOBVGLXBAIDOH9NXWQUSIFUINEVZUWELLVIOSSQRVHMTDBCATBWFSDJJDLURAUKEQEIRICSCXAOJNPWHQKYVTRLCRKHLFHHHPYSMUEAPMQPMPS9CHCIYXEYRNIOOGRWKVHUGIWJZIGPWGZGBGYTVC9UVEJ9JBIYMDHYXLWIDXHZVFCCPLYXDPQPJGMKNZMMONGNXSNNPCGEGRJTMCPTJONGPAEDMSHMGAPGBDWVCSCTJAECSHTEGBMVCDZMQYZ9IHERWGCKAIMFOJRAEDRDSWJASV9XYS9CTOEETPQHRKJZ9FPWTVCGLEJQJXVVDTYZ9DNSHQAINKROQQIPTFGTABEELYPBQHGNNB9NCL9BVTG9MH99BPIRNNGC9MQQRH9YUDYSUJIDSZKCIGEKFSJ9PXUYKVPUZYFIREUAMUZE9EIMJK9YGAZXZBPRXIRDCEVDHWOCFIJTVRCRZRRJGFLILKVNMJAX9MUMTXCWTUTP9NXBZUMAYYY9DNVZTCROBCMMHVKSQRXMGROCMMCDENWQWBV9LEIJONWTQXOUQZOTGEJHJELYZOPICLDWPHVCMBFSYHPIJYZQDEGYITVPYNQMXPRTPKADLUKW9AEMSMGIWCUMOQMUDN9HZGYKTNVVNLOQAFVETEDJMJVKYCE9RE9AJP9RMYFKGDEC9GIGAFXEXIYXPFBOMRPULVJMYTQEPDMMIABDHJGRNNCKADZAUFV9WCWFYFHXLCED9E9SKKYHVKDTGNCHEKFJL9YJHTSRUVKEPHPCQSFNBXKOJNGBSEOZLVVGNUQTRACVGEKDSORUHVSDSQNUZASWXRADGAUDYDPODDEDNDDT9OAEARSBLPVSYAOEYYZJIZIZDENQOKMXATCTD9NEFVQWNCET9N9IXWCCWHYUBDTDJUZFXWMATRYSGJUQAFKAPIQIIXVFFEFNLGDPAIGKONUWLUTQTKZJYDEGPASTOMM9QTGOMYHFUKMNEVWPCMTLPDSOEEWDBRHZPZJIFMBUTY9QPRLPSVURIRMCWLH9YIZBOTJQMMF9ZP9VCCEGWVKSSQNANP9ZXVCAFGAVBXDJHUMKTKUBZRNKUGJTVUPDZMUK9KZI9EKY9DQDUNA9ZVPCROKYYPISSTDOJZJXMXZWSGZBEPKAUYPBPUTDVQKUYXWYTZXLYTCLLKLJUUJGFFCMZFKDTJET9KEDRMWZSAEFCSXLMRHRLG9EKLRZJ9NZQEONGFQSKSQMWRZXWVEGHCF9ZKGQITDLGFTZLCQMXVGVYIPKSUPPAOIKVWARJHAEJUZOOJFCFJTGQZWROSCEQSITQWZTQDFKECATBWSIRDFVWH9TXXUVEBRRKOTFSGBMGCMZDK9BJRVEUYOVNSLZNNSTWOB9CFNDJHJENDWSTIMMSWD9HSA9LDGTJDJFRGQCWOHYJNMFFLLDMVQEMCMNVQWMOGCEZUTK9MPULTDMKTIVFNVWXDNTRHNREHEDWIZCCRFVM9TXCTLBLYEKTRVVWHKZDOSYOBNLEKPNXMDZGLSVBBNBJIBZYBXZCENKVIXMNGUJUYFGFYFBKELSBZROQWKMESZTWDEEUCSXOWFSNJUGGJANMJFCBJV9GMDDJCAJHWKYQFJLFWZESTSIRBZQWYHGQDFUUWF9F9HXSBZRKBDLRWXSMKW99KPWJOQYPMHB9KWALSVLFNANYSMNWSJLUOCBKAWAJHNWMLPLXHVEPTKBPWLWHMDZ99999999999999999999999999999999999999999999999999999FDKW9AD99A99999999B99999999RJPQGE9AXNBBLPQ9IFJXFJTXJAIGDDXAWXGAVU9PJQNYFADJDIDBTJKSAEBBX9NWJGZVAVXYWXPCEFFH99XJLIVAZYJGPKEHANESX9DORLEIOIFL9WVQBBNUDRZDGJMVSRTSFKOJPIMEXPBCPGKUUEKRGAXOB99999XIFVJWCABR9XQKOWCXJAZDZWMWWBVHROBOPISAWDIJTSFPVAUZNJUMNUCOFIBIAAVIOWDTCNIPRVA9999999999999999999999999999999RSIDBWNOF999999999K99999999POWSRVIO9VMIJ99FKKNKGPNNNNP",
                "COSNPEACSPESTKTUS9CSMOCWVUBLERQJQGLLA9AYRRXMOVOBULQZZZJPLNELEX9EVZDAFOHBB9FBAYOTDB9YGJAVTDWNPJVVGEPFJ9QBYLXAYZEETY9GMYQRIRAIPWMJUFMFRSQRCEIOWISMBJKGCIGIIYNMXAYLXZIBNKANT9DSQXPBUPWGUJTOMD9JKSNFZJJFBZYBWRWQIZFOZXQWNJTRZTUPHVEGTAOLMBEPXOB9TCEBNIWXQUHNQJZHAOWGVOOOTSCTEUEMXJUODZP9CDLCMEXAW9YJGVNREENETEYXOAKZVRJVUSCRUSRCNZUGUOLCNHQITWYPJVJGPVULASTONDZRDVCNGJSN9DMMUORCOIBTITSPBXSAVTOHSAXHMGH99APRTQIVCEI9NWYKDOZCCWBNZGGCUCISSMGJHJ9OVSFBZVFMBODKRKSLIDESGFDQITCYFARWYTLFKSPLNVQ9LTYFODCHBAJKCWVZNBLOJH9ABFGDFOXHDNHZILINMYMVZYWTFJJOLADPTZRPJEMGPFQNYTFDGOKMDTDSKPTHIDWLMRSSACZMTHUCWVZHCYSPJRATABZ9JHWEBGTTQORGFOYDWUIYFYGOGGTYGYYI9RPKPMCTYNYKHHNWQKJTDQDHTRUYQPMCDDLVUUHUBPWGPMNQYPKHDHGIUSXJGNUXIYGZRGVYPTTV9KXJDLGVVXRIWIGKZJVCQ9DUWAYNDRKYCGKZDEOKZQCXELSQXLGLAPBDIWRTKGSIRNAZ9XFEGMWOWLPUA9TSGYRDOU9GKY9JJDKCJKKGJCRARGSNECJ9SEVAGPPJMBTMGNWSLNSFBOEYMIQBKOVSCTDIWCOQTHBVTZOFNNIYKKJLAROKIRFFPCLSOWO9BVNNJSXEYLJASPUEFKCEI9SGWADNGS9MZAKFTCAYNRVKGDIGYDTPGJXWFAEFGG9BX9XCNBZGQULH9IPPIQ9VFVAXGELUMCTE9TOFOGCTFYBYEBFOKKAESIIHEWLYLQKWDHPYNELJKMZHDSDSK9ZWFP99FQFLUXGTSVDMGHIFZFUCYTYPVEFEDM9TOHCQVIBXARYWZEKTWEOVSBYZTJZRUFZJCLRBTOWPTKY99CYQTGPMAKFYALIWPEQLUB9RGANTKDDMSDSJOTNPFZCXKJUGTJWWPK9FAJGPJOEBRHL9ZU9XRBDJBVMFIZIZFGKETH9RJUSDIOWDZIXFOJLT9DSIAWSCEYBNOGOAZQPZKVZTBXGACCBVQGFNGXNQFTVPUGUOHNBKTUERLSTDXGRKZSATIRHDBSXARYATBHOLUHCQGPRMQGSJUAXUCWKDXAUGORHFVVVDZQEYYGSV9IUM9VTMHJCIKBQD9TQLLYTZHAKDHPFGYMRGJOEDJKQTBBNFCKDEPYTPWUJEOPRJWHAILMVW9AXS9HAT9GCGRXZEHWNDOVGKGPWFXFC9IKLVZJCTGZUJFRHGL9FZWZYP9TPOWGOUTQ9INYBVTD9N9OV9AM9GYRJ99MRWRWLOAKJXMDTFNS9NZQAYGVZRJ9WVSIDRRQLGKH9VPUVKFWZMSRVVLKXUGJAZESC9LEYDNNDWS9WTWNFPCR9YKPOMIJAVHCRCJVBDFWSTDN9BPJRDMGZFXWTY9GUX9WEPJQMXSECFPREXAJ9DU9OLMNQFTF99QYZOGDUTMBHMNMCNUQTU9FTNEUNBT9NQO9YADGY9C9LQR9DYVJZE9GMMYAOUSWUIVJ9EAR9EEFCO9SZTQ9JQHPIJGXIOQZHOSUSVMHBOLTYSEONVLRISNAN9KJHHFFISTYIHYVAMXLPNALDELETXVSWGUWOIVKNAKZKNNRVNJKE9WMNQBXFGXSYZQQSIODAKINA9CPBOGAYKJ9V9GS9HERXSVYPEILYXC9GURBREBCXRZJVXHUOPGYFLPIFBCOTMHFTAAUQUZVEKOWYFFGSCXDFDBTSGZRMPQR9EYSZYGQETCWFDRXVOXXCUBOQTBQGVLAONSTSLURFYSDPAVNCXNWVPQOUORMVSLYISQUQKXFYYMJSGHQP9VAAZABEAGJMCPIEBZQSYCPS9CNKFBDRDTDA9C9MVKGUISRX9ODVUJNPDWMZ9ESYXJ99ETDGSTJZMZYJEGRUWTORMCLNHLDQ9YIJWPMDYGGJQHMFPJ9VKINJUESTCBJQXFTCJFNUXPZONVKXJRAYGKIWHXSBZRKBDLRWXSMKW99KPWJOQYPMHB9KWALSVLFNANYSMNWSJLUOCBKAWAJHNWMLPLXHVEPTKBPWLWHMD999999999999999999999999999999999999999999999999999999FDKW9AD99B99999999B99999999RJPQGE9AXNBBLPQ9IFJXFJTXJAIGDDXAWXGAVU9PJQNYFADJDIDBTJKSAEBBX9NWJGZVAVXYWXPCEFFH9XIFVJWCABR9XQKOWCXJAZDZWMWWBVHROBOPISAWDIJTSFPVAUZNJUMNUCOFIBIAAVIOWDTCNIPRVA9999FTXZAEQIKGFJABOGCCQGOMKNASGWCQWMNIMRDTHKPJMTKDGMEQNZOAYARIYEWFZYJALRKFODOITTZ9999999999999999999999999999999LLHDBWNOF999999999K99999999POWSRVIO9VMIJ99UMGMTTTPNNNV",
        };
        List<TransactionViewModel> transactions = persistAndMapTxs(trytes);
        List<TransactionViewModel> bundleTxs = bundleValidator.validate(tangle, snapshotProvider.getInitialSnapshot(),
                transactions.get(0).getHash());
        assertTrue("no transactions should be returned", bundleTxs.isEmpty());
        assertEquals("should have changed the validity of the tail tx to invalid", -1,
                TransactionViewModel.fromHash(tangle, transactions.get(0).getHash()).getValidity());
    }

    @Test
    public void validateBundleWithMissingNonTailTransaction() throws Exception {
        String[] trytes = {
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999GNXKWQPHMFCEZZCKUCCD9PROQVPCTBVVAPHCLVOPYYQLQRMPGTQXBVZLKGGT9NXHUAASFIAVEOZTBSM9DA99999999999999999999999999RENGLE9BEAT9999999999999999FDKW9AD99999999999B99999999RJPQGE9AXNBBLPQ9IFJXFJTXJAIGDDXAWXGAVU9PJQNYFADJDIDBTJKSAEBBX9NWJGZVAVXYWXPCEFFH9DKZYSMJAQRLXZHCNPTJPJLOONNDZHGNTBIINGYKZQAAWF9LWQTHUQSAXMLQN9DKCQWHIJXNGLGQVA9999XIFVJWCABR9XQKOWCXJAZDZWMWWBVHROBOPISAWDIJTSFPVAUZNJUMNUCOFIBIAAVIOWDTCNIPRVA9999TANGLE9BEAT9999999999999999SVIDBWNOF999999999K99999999POWSRVIO9VMIJ99UGNETMNPNNNE",
                "YU9WINMHSBIJ9HRBKDEHZYOCDGOZ9HZSSVXAYYOD9AMAFBCROMLSFDFIAQKEXAVFDLJYVABRSONSTTXLCQJTSDRFDEXZIORLRSQDZQODNCHAAFUPGBCEVYNRSJQGUZRAQIIEZPFQGWPQIBMDVNZGQAKCU9VLHGYSNDPHCMOCTRYQOYHFPRQSGHSDEF9MSHGXYGUTHSBSF9SOSJQFOZXMQGCUXAYWLBJHXOHTOM9ITZPISEXLAYAZBHTZDDCOIHKDBL9AAXZEDFHDYCPXLDGR9JTVXDXBC9DRDVREEEVGVPWVEZHJBYQYTGDEWQHVEDTAVLWW9WBXOIGDGUAAAVKFMPVKSYBVOIWPYGCMACEAAHGUIQVFLFMSCPKTYQWJDGMDNLMDIUUYI9SZOFQPLKKACESSWIXPFYZWDHETYUGEVASPHBGQPJPWVESSUUEVUYDYNQUQURSMCEPKIHYXNFHZSHIIDTMEZQ9IPSHTBDK9UHRSIIEJRILBCMVUMGAGBMHKEMUUKQDCYAVIAN9MBWJCAUSSJRSAUEUBGEFFCFSOBVGLXBAIDOH9NXWQUSIFUINEVZUWELLVIOSSQRVHMTDBCATBWFSDJJDLURAUKEQEIRICSCXAOJNPWHQKYVTRLCRKHLFHHHPYSMUEAPMQPMPS9CHCIYXEYRNIOOGRWKVHUGIWJZIGPWGZGBGYTVC9UVEJ9JBIYMDHYXLWIDXHZVFCCPLYXDPQPJGMKNZMMONGNXSNNPCGEGRJTMCPTJONGPAEDMSHMGAPGBDWVCSCTJAECSHTEGBMVCDZMQYZ9IHERWGCKAIMFOJRAEDRDSWJASV9XYS9CTOEETPQHRKJZ9FPWTVCGLEJQJXVVDTYZ9DNSHQAINKROQQIPTFGTABEELYPBQHGNNB9NCL9BVTG9MH99BPIRNNGC9MQQRH9YUDYSUJIDSZKCIGEKFSJ9PXUYKVPUZYFIREUAMUZE9EIMJK9YGAZXZBPRXIRDCEVDHWOCFIJTVRCRZRRJGFLILKVNMJAX9MUMTXCWTUTP9NXBZUMAYYY9DNVZTCROBCMMHVKSQRXMGROCMMCDENWQWBV9LEIJONWTQXOUQZOTGEJHJELYZOPICLDWPHVCMBFSYHPIJYZQDEGYITVPYNQMXPRTPKADLUKW9AEMSMGIWCUMOQMUDN9HZGYKTNVVNLOQAFVETEDJMJVKYCE9RE9AJP9RMYFKGDEC9GIGAFXEXIYXPFBOMRPULVJMYTQEPDMMIABDHJGRNNCKADZAUFV9WCWFYFHXLCED9E9SKKYHVKDTGNCHEKFJL9YJHTSRUVKEPHPCQSFNBXKOJNGBSEOZLVVGNUQTRACVGEKDSORUHVSDSQNUZASWXRADGAUDYDPODDEDNDDT9OAEARSBLPVSYAOEYYZJIZIZDENQOKMXATCTD9NEFVQWNCET9N9IXWCCWHYUBDTDJUZFXWMATRYSGJUQAFKAPIQIIXVFFEFNLGDPAIGKONUWLUTQTKZJYDEGPASTOMM9QTGOMYHFUKMNEVWPCMTLPDSOEEWDBRHZPZJIFMBUTY9QPRLPSVURIRMCWLH9YIZBOTJQMMF9ZP9VCCEGWVKSSQNANP9ZXVCAFGAVBXDJHUMKTKUBZRNKUGJTVUPDZMUK9KZI9EKY9DQDUNA9ZVPCROKYYPISSTDOJZJXMXZWSGZBEPKAUYPBPUTDVQKUYXWYTZXLYTCLLKLJUUJGFFCMZFKDTJET9KEDRMWZSAEFCSXLMRHRLG9EKLRZJ9NZQEONGFQSKSQMWRZXWVEGHCF9ZKGQITDLGFTZLCQMXVGVYIPKSUPPAOIKVWARJHAEJUZOOJFCFJTGQZWROSCEQSITQWZTQDFKECATBWSIRDFVWH9TXXUVEBRRKOTFSGBMGCMZDK9BJRVEUYOVNSLZNNSTWOB9CFNDJHJENDWSTIMMSWD9HSA9LDGTJDJFRGQCWOHYJNMFFLLDMVQEMCMNVQWMOGCEZUTK9MPULTDMKTIVFNVWXDNTRHNREHEDWIZCCRFVM9TXCTLBLYEKTRVVWHKZDOSYOBNLEKPNXMDZGLSVBBNBJIBZYBXZCENKVIXMNGUJUYFGFYFBKELSBZROQWKMESZTWDEEUCSXOWFSNJUGGJANMJFCBJV9GMDDJCAJHWKYQFJLFWZESTSIRBZQWYHGQDFUUWF9F9HXSBZRKBDLRWXSMKW99KPWJOQYPMHB9KWALSVLFNANYSMNWSJLUOCBKAWAJHNWMLPLXHVEPTKBPWLWHMDZ99999999999999999999999999999999999999999999999999999FDKW9AD99A99999999B99999999RJPQGE9AXNBBLPQ9IFJXFJTXJAIGDDXAWXGAVU9PJQNYFADJDIDBTJKSAEBBX9NWJGZVAVXYWXPCEFFH99XJLIVAZYJGPKEHANESX9DORLEIOIFL9WVQBBNUDRZDGJMVSRTSFKOJPIMEXPBCPGKUUEKRGAXOB99999XIFVJWCABR9XQKOWCXJAZDZWMWWBVHROBOPISAWDIJTSFPVAUZNJUMNUCOFIBIAAVIOWDTCNIPRVA9999999999999999999999999999999RSIDBWNOF999999999K99999999POWSRVIO9VMIJ99FKKNKGPNNNNP",
        };
        List<TransactionViewModel> transactions = persistAndMapTxs(trytes);
        List<TransactionViewModel> bundleTxs = bundleValidator.validate(tangle, snapshotProvider.getInitialSnapshot(),
                transactions.get(0).getHash());
        assertTrue("no transactions should be returned", bundleTxs.isEmpty());
        assertEquals("should have changed the validity of the tail tx to invalid", -1,
                TransactionViewModel.fromHash(tangle, transactions.get(0).getHash()).getValidity());
    }

    @Test
    public void validateBundleWithMissingTailTransaction() throws Exception {
        String[] trytes = {
                "YU9WINMHSBIJ9HRBKDEHZYOCDGOZ9HZSSVXAYYOD9AMAFBCROMLSFDFIAQKEXAVFDLJYVABRSONSTTXLCQJTSDRFDEXZIORLRSQDZQODNCHAAFUPGBCEVYNRSJQGUZRAQIIEZPFQGWPQIBMDVNZGQAKCU9VLHGYSNDPHCMOCTRYQOYHFPRQSGHSDEF9MSHGXYGUTHSBSF9SOSJQFOZXMQGCUXAYWLBJHXOHTOM9ITZPISEXLAYAZBHTZDDCOIHKDBL9AAXZEDFHDYCPXLDGR9JTVXDXBC9DRDVREEEVGVPWVEZHJBYQYTGDEWQHVEDTAVLWW9WBXOIGDGUAAAVKFMPVKSYBVOIWPYGCMACEAAHGUIQVFLFMSCPKTYQWJDGMDNLMDIUUYI9SZOFQPLKKACESSWIXPFYZWDHETYUGEVASPHBGQPJPWVESSUUEVUYDYNQUQURSMCEPKIHYXNFHZSHIIDTMEZQ9IPSHTBDK9UHRSIIEJRILBCMVUMGAGBMHKEMUUKQDCYAVIAN9MBWJCAUSSJRSAUEUBGEFFCFSOBVGLXBAIDOH9NXWQUSIFUINEVZUWELLVIOSSQRVHMTDBCATBWFSDJJDLURAUKEQEIRICSCXAOJNPWHQKYVTRLCRKHLFHHHPYSMUEAPMQPMPS9CHCIYXEYRNIOOGRWKVHUGIWJZIGPWGZGBGYTVC9UVEJ9JBIYMDHYXLWIDXHZVFCCPLYXDPQPJGMKNZMMONGNXSNNPCGEGRJTMCPTJONGPAEDMSHMGAPGBDWVCSCTJAECSHTEGBMVCDZMQYZ9IHERWGCKAIMFOJRAEDRDSWJASV9XYS9CTOEETPQHRKJZ9FPWTVCGLEJQJXVVDTYZ9DNSHQAINKROQQIPTFGTABEELYPBQHGNNB9NCL9BVTG9MH99BPIRNNGC9MQQRH9YUDYSUJIDSZKCIGEKFSJ9PXUYKVPUZYFIREUAMUZE9EIMJK9YGAZXZBPRXIRDCEVDHWOCFIJTVRCRZRRJGFLILKVNMJAX9MUMTXCWTUTP9NXBZUMAYYY9DNVZTCROBCMMHVKSQRXMGROCMMCDENWQWBV9LEIJONWTQXOUQZOTGEJHJELYZOPICLDWPHVCMBFSYHPIJYZQDEGYITVPYNQMXPRTPKADLUKW9AEMSMGIWCUMOQMUDN9HZGYKTNVVNLOQAFVETEDJMJVKYCE9RE9AJP9RMYFKGDEC9GIGAFXEXIYXPFBOMRPULVJMYTQEPDMMIABDHJGRNNCKADZAUFV9WCWFYFHXLCED9E9SKKYHVKDTGNCHEKFJL9YJHTSRUVKEPHPCQSFNBXKOJNGBSEOZLVVGNUQTRACVGEKDSORUHVSDSQNUZASWXRADGAUDYDPODDEDNDDT9OAEARSBLPVSYAOEYYZJIZIZDENQOKMXATCTD9NEFVQWNCET9N9IXWCCWHYUBDTDJUZFXWMATRYSGJUQAFKAPIQIIXVFFEFNLGDPAIGKONUWLUTQTKZJYDEGPASTOMM9QTGOMYHFUKMNEVWPCMTLPDSOEEWDBRHZPZJIFMBUTY9QPRLPSVURIRMCWLH9YIZBOTJQMMF9ZP9VCCEGWVKSSQNANP9ZXVCAFGAVBXDJHUMKTKUBZRNKUGJTVUPDZMUK9KZI9EKY9DQDUNA9ZVPCROKYYPISSTDOJZJXMXZWSGZBEPKAUYPBPUTDVQKUYXWYTZXLYTCLLKLJUUJGFFCMZFKDTJET9KEDRMWZSAEFCSXLMRHRLG9EKLRZJ9NZQEONGFQSKSQMWRZXWVEGHCF9ZKGQITDLGFTZLCQMXVGVYIPKSUPPAOIKVWARJHAEJUZOOJFCFJTGQZWROSCEQSITQWZTQDFKECATBWSIRDFVWH9TXXUVEBRRKOTFSGBMGCMZDK9BJRVEUYOVNSLZNNSTWOB9CFNDJHJENDWSTIMMSWD9HSA9LDGTJDJFRGQCWOHYJNMFFLLDMVQEMCMNVQWMOGCEZUTK9MPULTDMKTIVFNVWXDNTRHNREHEDWIZCCRFVM9TXCTLBLYEKTRVVWHKZDOSYOBNLEKPNXMDZGLSVBBNBJIBZYBXZCENKVIXMNGUJUYFGFYFBKELSBZROQWKMESZTWDEEUCSXOWFSNJUGGJANMJFCBJV9GMDDJCAJHWKYQFJLFWZESTSIRBZQWYHGQDFUUWF9F9HXSBZRKBDLRWXSMKW99KPWJOQYPMHB9KWALSVLFNANYSMNWSJLUOCBKAWAJHNWMLPLXHVEPTKBPWLWHMDZ99999999999999999999999999999999999999999999999999999FDKW9AD99A99999999B99999999RJPQGE9AXNBBLPQ9IFJXFJTXJAIGDDXAWXGAVU9PJQNYFADJDIDBTJKSAEBBX9NWJGZVAVXYWXPCEFFH99XJLIVAZYJGPKEHANESX9DORLEIOIFL9WVQBBNUDRZDGJMVSRTSFKOJPIMEXPBCPGKUUEKRGAXOB99999XIFVJWCABR9XQKOWCXJAZDZWMWWBVHROBOPISAWDIJTSFPVAUZNJUMNUCOFIBIAAVIOWDTCNIPRVA9999999999999999999999999999999RSIDBWNOF999999999K99999999POWSRVIO9VMIJ99FKKNKGPNNNNP",
                "COSNPEACSPESTKTUS9CSMOCWVUBLERQJQGLLA9AYRRXMOVOBULQZZZJPLNELEX9EVZDAFOHBB9FBAYOTDB9YGJAVTDWNPJVVGEPFJ9QBYLXAYZEETY9GMYQRIRAIPWMJUFMFRSQRCEIOWISMBJKGCIGIIYNMXAYLXZIBNKANT9DSQXPBUPWGUJTOMD9JKSNFZJJFBZYBWRWQIZFOZXQWNJTRZTUPHVEGTAOLMBEPXOB9TCEBNIWXQUHNQJZHAOWGVOOOTSCTEUEMXJUODZP9CDLCMEXAW9YJGVNREENETEYXOAKZVRJVUSCRUSRCNZUGUOLCNHQITWYPJVJGPVULASTONDZRDVCNGJSN9DMMUORCOIBTITSPBXSAVTOHSAXHMGH99APRTQIVCEI9NWYKDOZCCWBNZGGCUCISSMGJHJ9OVSFBZVFMBODKRKSLIDESGFDQITCYFARWYTLFKSPLNVQ9LTYFODCHBAJKCWVZNBLOJH9ABFGDFOXHDNHZILINMYMVZYWTFJJOLADPTZRPJEMGPFQNYTFDGOKMDTDSKPTHIDWLMRSSACZMTHUCWVZHCYSPJRATABZ9JHWEBGTTQORGFOYDWUIYFYGOGGTYGYYI9RPKPMCTYNYKHHNWQKJTDQDHTRUYQPMCDDLVUUHUBPWGPMNQYPKHDHGIUSXJGNUXIYGZRGVYPTTV9KXJDLGVVXRIWIGKZJVCQ9DUWAYNDRKYCGKZDEOKZQCXELSQXLGLAPBDIWRTKGSIRNAZ9XFEGMWOWLPUA9TSGYRDOU9GKY9JJDKCJKKGJCRARGSNECJ9SEVAGPPJMBTMGNWSLNSFBOEYMIQBKOVSCTDIWCOQTHBVTZOFNNIYKKJLAROKIRFFPCLSOWO9BVNNJSXEYLJASPUEFKCEI9SGWADNGS9MZAKFTCAYNRVKGDIGYDTPGJXWFAEFGG9BX9XCNBZGQULH9IPPIQ9VFVAXGELUMCTE9TOFOGCTFYBYEBFOKKAESIIHEWLYLQKWDHPYNELJKMZHDSDSK9ZWFP99FQFLUXGTSVDMGHIFZFUCYTYPVEFEDM9TOHCQVIBXARYWZEKTWEOVSBYZTJZRUFZJCLRBTOWPTKY99CYQTGPMAKFYALIWPEQLUB9RGANTKDDMSDSJOTNPFZCXKJUGTJWWPK9FAJGPJOEBRHL9ZU9XRBDJBVMFIZIZFGKETH9RJUSDIOWDZIXFOJLT9DSIAWSCEYBNOGOAZQPZKVZTBXGACCBVQGFNGXNQFTVPUGUOHNBKTUERLSTDXGRKZSATIRHDBSXARYATBHOLUHCQGPRMQGSJUAXUCWKDXAUGORHFVVVDZQEYYGSV9IUM9VTMHJCIKBQD9TQLLYTZHAKDHPFGYMRGJOEDJKQTBBNFCKDEPYTPWUJEOPRJWHAILMVW9AXS9HAT9GCGRXZEHWNDOVGKGPWFXFC9IKLVZJCTGZUJFRHGL9FZWZYP9TPOWGOUTQ9INYBVTD9N9OV9AM9GYRJ99MRWRWLOAKJXMDTFNS9NZQAYGVZRJ9WVSIDRRQLGKH9VPUVKFWZMSRVVLKXUGJAZESC9LEYDNNDWS9WTWNFPCR9YKPOMIJAVHCRCJVBDFWSTDN9BPJRDMGZFXWTY9GUX9WEPJQMXSECFPREXAJ9DU9OLMNQFTF99QYZOGDUTMBHMNMCNUQTU9FTNEUNBT9NQO9YADGY9C9LQR9DYVJZE9GMMYAOUSWUIVJ9EAR9EEFCO9SZTQ9JQHPIJGXIOQZHOSUSVMHBOLTYSEONVLRISNAN9KJHHFFISTYIHYVAMXLPNALDELETXVSWGUWOIVKNAKZKNNRVNJKE9WMNQBXFGXSYZQQSIODAKINA9CPBOGAYKJ9V9GS9HERXSVYPEILYXC9GURBREBCXRZJVXHUOPGYFLPIFBCOTMHFTAAUQUZVEKOWYFFGSCXDFDBTSGZRMPQR9EYSZYGQETCWFDRXVOXXCUBOQTBQGVLAONSTSLURFYSDPAVNCXNWVPQOUORMVSLYISQUQKXFYYMJSGHQP9VAAZABEAGJMCPIEBZQSYCPS9CNKFBDRDTDA9C9MVKGUISRX9ODVUJNPDWMZ9ESYXJ99ETDGSTJZMZYJEGRUWTORMCLNHLDQ9YIJWPMDYGGJQHMFPJ9VKINJUESTCBJQXFTCJFNUXPZONVKXJRAYGKIWHXSBZRKBDLRWXSMKW99KPWJOQYPMHB9KWALSVLFNANYSMNWSJLUOCBKAWAJHNWMLPLXHVEPTKBPWLWHMD999999999999999999999999999999999999999999999999999999FDKW9AD99B99999999B99999999RJPQGE9AXNBBLPQ9IFJXFJTXJAIGDDXAWXGAVU9PJQNYFADJDIDBTJKSAEBBX9NWJGZVAVXYWXPCEFFH9XIFVJWCABR9XQKOWCXJAZDZWMWWBVHROBOPISAWDIJTSFPVAUZNJUMNUCOFIBIAAVIOWDTCNIPRVA9999FTXZAEQIKGFJABOGCCQGOMKNASGWCQWMNIMRDTHKPJMTKDGMEQNZOAYARIYEWFZYJALRKFODOITTZ9999999999999999999999999999999LLHDBWNOF999999999K99999999POWSRVIO9VMIJ99UMGMTTTPNNNV",
        };
        List<TransactionViewModel> transactions = persistAndMapTxs(trytes);
        List<TransactionViewModel> bundleTxs = bundleValidator.validate(tangle, snapshotProvider.getInitialSnapshot(),
                transactions.get(0).getHash());
        assertTrue("no transactions should be returned", bundleTxs.isEmpty());
        // special case, since there's no tail, we don't actually update the validity in the database
        assertEquals("should not have changed the validity of the tail tx", 0,
                TransactionViewModel.fromHash(tangle, transactions.get(0).getHash()).getValidity());
    }

    @Test
    public void validateBundleWithInvalidIndices() throws Exception {
        // indices of second and third tx swapped
        String[] trytes = {
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999GNXKWQPHMFCEZZCKUCCD9PROQVPCTBVVAPHCLVOPYYQLQRMPGTQXBVZLKGGT9NXHUAASFIAVEOZTBSM9DA99999999999999999999999999RENGLE9BEAT9999999999999999FDKW9AD99999999999B99999999RJPQGE9AXNBBLPQ9IFJXFJTXJAIGDDXAWXGAVU9PJQNYFADJDIDBTJKSAEBBX9NWJGZVAVXYWXPCEFFH9DKZYSMJAQRLXZHCNPTJPJLOONNDZHGNTBIINGYKZQAAWF9LWQTHUQSAXMLQN9DKCQWHIJXNGLGQVA9999XIFVJWCABR9XQKOWCXJAZDZWMWWBVHROBOPISAWDIJTSFPVAUZNJUMNUCOFIBIAAVIOWDTCNIPRVA9999TANGLE9BEAT9999999999999999SVIDBWNOF999999999K99999999POWSRVIO9VMIJ99UGNETMNPNNNE",
                "YU9WINMHSBIJ9HRBKDEHZYOCDGOZ9HZSSVXAYYOD9AMAFBCROMLSFDFIAQKEXAVFDLJYVABRSONSTTXLCQJTSDRFDEXZIORLRSQDZQODNCHAAFUPGBCEVYNRSJQGUZRAQIIEZPFQGWPQIBMDVNZGQAKCU9VLHGYSNDPHCMOCTRYQOYHFPRQSGHSDEF9MSHGXYGUTHSBSF9SOSJQFOZXMQGCUXAYWLBJHXOHTOM9ITZPISEXLAYAZBHTZDDCOIHKDBL9AAXZEDFHDYCPXLDGR9JTVXDXBC9DRDVREEEVGVPWVEZHJBYQYTGDEWQHVEDTAVLWW9WBXOIGDGUAAAVKFMPVKSYBVOIWPYGCMACEAAHGUIQVFLFMSCPKTYQWJDGMDNLMDIUUYI9SZOFQPLKKACESSWIXPFYZWDHETYUGEVASPHBGQPJPWVESSUUEVUYDYNQUQURSMCEPKIHYXNFHZSHIIDTMEZQ9IPSHTBDK9UHRSIIEJRILBCMVUMGAGBMHKEMUUKQDCYAVIAN9MBWJCAUSSJRSAUEUBGEFFCFSOBVGLXBAIDOH9NXWQUSIFUINEVZUWELLVIOSSQRVHMTDBCATBWFSDJJDLURAUKEQEIRICSCXAOJNPWHQKYVTRLCRKHLFHHHPYSMUEAPMQPMPS9CHCIYXEYRNIOOGRWKVHUGIWJZIGPWGZGBGYTVC9UVEJ9JBIYMDHYXLWIDXHZVFCCPLYXDPQPJGMKNZMMONGNXSNNPCGEGRJTMCPTJONGPAEDMSHMGAPGBDWVCSCTJAECSHTEGBMVCDZMQYZ9IHERWGCKAIMFOJRAEDRDSWJASV9XYS9CTOEETPQHRKJZ9FPWTVCGLEJQJXVVDTYZ9DNSHQAINKROQQIPTFGTABEELYPBQHGNNB9NCL9BVTG9MH99BPIRNNGC9MQQRH9YUDYSUJIDSZKCIGEKFSJ9PXUYKVPUZYFIREUAMUZE9EIMJK9YGAZXZBPRXIRDCEVDHWOCFIJTVRCRZRRJGFLILKVNMJAX9MUMTXCWTUTP9NXBZUMAYYY9DNVZTCROBCMMHVKSQRXMGROCMMCDENWQWBV9LEIJONWTQXOUQZOTGEJHJELYZOPICLDWPHVCMBFSYHPIJYZQDEGYITVPYNQMXPRTPKADLUKW9AEMSMGIWCUMOQMUDN9HZGYKTNVVNLOQAFVETEDJMJVKYCE9RE9AJP9RMYFKGDEC9GIGAFXEXIYXPFBOMRPULVJMYTQEPDMMIABDHJGRNNCKADZAUFV9WCWFYFHXLCED9E9SKKYHVKDTGNCHEKFJL9YJHTSRUVKEPHPCQSFNBXKOJNGBSEOZLVVGNUQTRACVGEKDSORUHVSDSQNUZASWXRADGAUDYDPODDEDNDDT9OAEARSBLPVSYAOEYYZJIZIZDENQOKMXATCTD9NEFVQWNCET9N9IXWCCWHYUBDTDJUZFXWMATRYSGJUQAFKAPIQIIXVFFEFNLGDPAIGKONUWLUTQTKZJYDEGPASTOMM9QTGOMYHFUKMNEVWPCMTLPDSOEEWDBRHZPZJIFMBUTY9QPRLPSVURIRMCWLH9YIZBOTJQMMF9ZP9VCCEGWVKSSQNANP9ZXVCAFGAVBXDJHUMKTKUBZRNKUGJTVUPDZMUK9KZI9EKY9DQDUNA9ZVPCROKYYPISSTDOJZJXMXZWSGZBEPKAUYPBPUTDVQKUYXWYTZXLYTCLLKLJUUJGFFCMZFKDTJET9KEDRMWZSAEFCSXLMRHRLG9EKLRZJ9NZQEONGFQSKSQMWRZXWVEGHCF9ZKGQITDLGFTZLCQMXVGVYIPKSUPPAOIKVWARJHAEJUZOOJFCFJTGQZWROSCEQSITQWZTQDFKECATBWSIRDFVWH9TXXUVEBRRKOTFSGBMGCMZDK9BJRVEUYOVNSLZNNSTWOB9CFNDJHJENDWSTIMMSWD9HSA9LDGTJDJFRGQCWOHYJNMFFLLDMVQEMCMNVQWMOGCEZUTK9MPULTDMKTIVFNVWXDNTRHNREHEDWIZCCRFVM9TXCTLBLYEKTRVVWHKZDOSYOBNLEKPNXMDZGLSVBBNBJIBZYBXZCENKVIXMNGUJUYFGFYFBKELSBZROQWKMESZTWDEEUCSXOWFSNJUGGJANMJFCBJV9GMDDJCAJHWKYQFJLFWZESTSIRBZQWYHGQDFUUWF9F9HXSBZRKBDLRWXSMKW99KPWJOQYPMHB9KWALSVLFNANYSMNWSJLUOCBKAWAJHNWMLPLXHVEPTKBPWLWHMDZ99999999999999999999999999999999999999999999999999999FDKW9AD99B99999999B99999999RJPQGE9AXNBBLPQ9IFJXFJTXJAIGDDXAWXGAVU9PJQNYFADJDIDBTJKSAEBBX9NWJGZVAVXYWXPCEFFH99XJLIVAZYJGPKEHANESX9DORLEIOIFL9WVQBBNUDRZDGJMVSRTSFKOJPIMEXPBCPGKUUEKRGAXOB99999XIFVJWCABR9XQKOWCXJAZDZWMWWBVHROBOPISAWDIJTSFPVAUZNJUMNUCOFIBIAAVIOWDTCNIPRVA9999999999999999999999999999999RSIDBWNOF999999999K99999999POWSRVIO9VMIJ99FKKNKGPNNNNP",
                "COSNPEACSPESTKTUS9CSMOCWVUBLERQJQGLLA9AYRRXMOVOBULQZZZJPLNELEX9EVZDAFOHBB9FBAYOTDB9YGJAVTDWNPJVVGEPFJ9QBYLXAYZEETY9GMYQRIRAIPWMJUFMFRSQRCEIOWISMBJKGCIGIIYNMXAYLXZIBNKANT9DSQXPBUPWGUJTOMD9JKSNFZJJFBZYBWRWQIZFOZXQWNJTRZTUPHVEGTAOLMBEPXOB9TCEBNIWXQUHNQJZHAOWGVOOOTSCTEUEMXJUODZP9CDLCMEXAW9YJGVNREENETEYXOAKZVRJVUSCRUSRCNZUGUOLCNHQITWYPJVJGPVULASTONDZRDVCNGJSN9DMMUORCOIBTITSPBXSAVTOHSAXHMGH99APRTQIVCEI9NWYKDOZCCWBNZGGCUCISSMGJHJ9OVSFBZVFMBODKRKSLIDESGFDQITCYFARWYTLFKSPLNVQ9LTYFODCHBAJKCWVZNBLOJH9ABFGDFOXHDNHZILINMYMVZYWTFJJOLADPTZRPJEMGPFQNYTFDGOKMDTDSKPTHIDWLMRSSACZMTHUCWVZHCYSPJRATABZ9JHWEBGTTQORGFOYDWUIYFYGOGGTYGYYI9RPKPMCTYNYKHHNWQKJTDQDHTRUYQPMCDDLVUUHUBPWGPMNQYPKHDHGIUSXJGNUXIYGZRGVYPTTV9KXJDLGVVXRIWIGKZJVCQ9DUWAYNDRKYCGKZDEOKZQCXELSQXLGLAPBDIWRTKGSIRNAZ9XFEGMWOWLPUA9TSGYRDOU9GKY9JJDKCJKKGJCRARGSNECJ9SEVAGPPJMBTMGNWSLNSFBOEYMIQBKOVSCTDIWCOQTHBVTZOFNNIYKKJLAROKIRFFPCLSOWO9BVNNJSXEYLJASPUEFKCEI9SGWADNGS9MZAKFTCAYNRVKGDIGYDTPGJXWFAEFGG9BX9XCNBZGQULH9IPPIQ9VFVAXGELUMCTE9TOFOGCTFYBYEBFOKKAESIIHEWLYLQKWDHPYNELJKMZHDSDSK9ZWFP99FQFLUXGTSVDMGHIFZFUCYTYPVEFEDM9TOHCQVIBXARYWZEKTWEOVSBYZTJZRUFZJCLRBTOWPTKY99CYQTGPMAKFYALIWPEQLUB9RGANTKDDMSDSJOTNPFZCXKJUGTJWWPK9FAJGPJOEBRHL9ZU9XRBDJBVMFIZIZFGKETH9RJUSDIOWDZIXFOJLT9DSIAWSCEYBNOGOAZQPZKVZTBXGACCBVQGFNGXNQFTVPUGUOHNBKTUERLSTDXGRKZSATIRHDBSXARYATBHOLUHCQGPRMQGSJUAXUCWKDXAUGORHFVVVDZQEYYGSV9IUM9VTMHJCIKBQD9TQLLYTZHAKDHPFGYMRGJOEDJKQTBBNFCKDEPYTPWUJEOPRJWHAILMVW9AXS9HAT9GCGRXZEHWNDOVGKGPWFXFC9IKLVZJCTGZUJFRHGL9FZWZYP9TPOWGOUTQ9INYBVTD9N9OV9AM9GYRJ99MRWRWLOAKJXMDTFNS9NZQAYGVZRJ9WVSIDRRQLGKH9VPUVKFWZMSRVVLKXUGJAZESC9LEYDNNDWS9WTWNFPCR9YKPOMIJAVHCRCJVBDFWSTDN9BPJRDMGZFXWTY9GUX9WEPJQMXSECFPREXAJ9DU9OLMNQFTF99QYZOGDUTMBHMNMCNUQTU9FTNEUNBT9NQO9YADGY9C9LQR9DYVJZE9GMMYAOUSWUIVJ9EAR9EEFCO9SZTQ9JQHPIJGXIOQZHOSUSVMHBOLTYSEONVLRISNAN9KJHHFFISTYIHYVAMXLPNALDELETXVSWGUWOIVKNAKZKNNRVNJKE9WMNQBXFGXSYZQQSIODAKINA9CPBOGAYKJ9V9GS9HERXSVYPEILYXC9GURBREBCXRZJVXHUOPGYFLPIFBCOTMHFTAAUQUZVEKOWYFFGSCXDFDBTSGZRMPQR9EYSZYGQETCWFDRXVOXXCUBOQTBQGVLAONSTSLURFYSDPAVNCXNWVPQOUORMVSLYISQUQKXFYYMJSGHQP9VAAZABEAGJMCPIEBZQSYCPS9CNKFBDRDTDA9C9MVKGUISRX9ODVUJNPDWMZ9ESYXJ99ETDGSTJZMZYJEGRUWTORMCLNHLDQ9YIJWPMDYGGJQHMFPJ9VKINJUESTCBJQXFTCJFNUXPZONVKXJRAYGKIWHXSBZRKBDLRWXSMKW99KPWJOQYPMHB9KWALSVLFNANYSMNWSJLUOCBKAWAJHNWMLPLXHVEPTKBPWLWHMD999999999999999999999999999999999999999999999999999999FDKW9AD99A99999999B99999999RJPQGE9AXNBBLPQ9IFJXFJTXJAIGDDXAWXGAVU9PJQNYFADJDIDBTJKSAEBBX9NWJGZVAVXYWXPCEFFH9XIFVJWCABR9XQKOWCXJAZDZWMWWBVHROBOPISAWDIJTSFPVAUZNJUMNUCOFIBIAAVIOWDTCNIPRVA9999FTXZAEQIKGFJABOGCCQGOMKNASGWCQWMNIMRDTHKPJMTKDGMEQNZOAYARIYEWFZYJALRKFODOITTZ9999999999999999999999999999999LLHDBWNOF999999999K99999999POWSRVIO9VMIJ99UMGMTTTPNNNV",
        };
        List<TransactionViewModel> transactions = persistAndMapTxs(trytes);
        List<TransactionViewModel> bundleTxs = bundleValidator.validate(tangle, snapshotProvider.getInitialSnapshot(),
                transactions.get(0).getHash());
        assertTrue("no transactions should be returned", bundleTxs.isEmpty());
        assertEquals("should have changed the validity of the tail tx to invalid", -1,
                TransactionViewModel.fromHash(tangle, transactions.get(0).getHash()).getValidity());
    }

    @Test
    public void validateBundleWithInvalidBundleHashOnTailTransaction() throws Exception {
        // tail transaction's bundle hash is invalid
        String[] trytes = {
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999GNXKWQPHMFCEZZCKUCCD9PROQVPCTBVVAPHCLVOPYYQLQRMPGTQXBVZLKGGT9NXHUAASFIAVEOZTBSM9DA99999999999999999999999999RENGLE9BEAT9999999999999999FDKW9AD99999999999B99999999AAAAAAAAAAAAAPQ9IFJXFJTXJAIGDDXAWXGAVU9PJQNYFADJDIDBTJKSAEBBX9NWJGZVAVXYWXPCEFFH9DKZYSMJAQRLXZHCNPTJPJLOONNDZHGNTBIINGYKZQAAWF9LWQTHUQSAXMLQN9DKCQWHIJXNGLGQVA9999XIFVJWCABR9XQKOWCXJAZDZWMWWBVHROBOPISAWDIJTSFPVAUZNJUMNUCOFIBIAAVIOWDTCNIPRVA9999TANGLE9BEAT9999999999999999SVIDBWNOF999999999K99999999POWSRVIO9VMIJ99UGNETMNPNNNE",
                "YU9WINMHSBIJ9HRBKDEHZYOCDGOZ9HZSSVXAYYOD9AMAFBCROMLSFDFIAQKEXAVFDLJYVABRSONSTTXLCQJTSDRFDEXZIORLRSQDZQODNCHAAFUPGBCEVYNRSJQGUZRAQIIEZPFQGWPQIBMDVNZGQAKCU9VLHGYSNDPHCMOCTRYQOYHFPRQSGHSDEF9MSHGXYGUTHSBSF9SOSJQFOZXMQGCUXAYWLBJHXOHTOM9ITZPISEXLAYAZBHTZDDCOIHKDBL9AAXZEDFHDYCPXLDGR9JTVXDXBC9DRDVREEEVGVPWVEZHJBYQYTGDEWQHVEDTAVLWW9WBXOIGDGUAAAVKFMPVKSYBVOIWPYGCMACEAAHGUIQVFLFMSCPKTYQWJDGMDNLMDIUUYI9SZOFQPLKKACESSWIXPFYZWDHETYUGEVASPHBGQPJPWVESSUUEVUYDYNQUQURSMCEPKIHYXNFHZSHIIDTMEZQ9IPSHTBDK9UHRSIIEJRILBCMVUMGAGBMHKEMUUKQDCYAVIAN9MBWJCAUSSJRSAUEUBGEFFCFSOBVGLXBAIDOH9NXWQUSIFUINEVZUWELLVIOSSQRVHMTDBCATBWFSDJJDLURAUKEQEIRICSCXAOJNPWHQKYVTRLCRKHLFHHHPYSMUEAPMQPMPS9CHCIYXEYRNIOOGRWKVHUGIWJZIGPWGZGBGYTVC9UVEJ9JBIYMDHYXLWIDXHZVFCCPLYXDPQPJGMKNZMMONGNXSNNPCGEGRJTMCPTJONGPAEDMSHMGAPGBDWVCSCTJAECSHTEGBMVCDZMQYZ9IHERWGCKAIMFOJRAEDRDSWJASV9XYS9CTOEETPQHRKJZ9FPWTVCGLEJQJXVVDTYZ9DNSHQAINKROQQIPTFGTABEELYPBQHGNNB9NCL9BVTG9MH99BPIRNNGC9MQQRH9YUDYSUJIDSZKCIGEKFSJ9PXUYKVPUZYFIREUAMUZE9EIMJK9YGAZXZBPRXIRDCEVDHWOCFIJTVRCRZRRJGFLILKVNMJAX9MUMTXCWTUTP9NXBZUMAYYY9DNVZTCROBCMMHVKSQRXMGROCMMCDENWQWBV9LEIJONWTQXOUQZOTGEJHJELYZOPICLDWPHVCMBFSYHPIJYZQDEGYITVPYNQMXPRTPKADLUKW9AEMSMGIWCUMOQMUDN9HZGYKTNVVNLOQAFVETEDJMJVKYCE9RE9AJP9RMYFKGDEC9GIGAFXEXIYXPFBOMRPULVJMYTQEPDMMIABDHJGRNNCKADZAUFV9WCWFYFHXLCED9E9SKKYHVKDTGNCHEKFJL9YJHTSRUVKEPHPCQSFNBXKOJNGBSEOZLVVGNUQTRACVGEKDSORUHVSDSQNUZASWXRADGAUDYDPODDEDNDDT9OAEARSBLPVSYAOEYYZJIZIZDENQOKMXATCTD9NEFVQWNCET9N9IXWCCWHYUBDTDJUZFXWMATRYSGJUQAFKAPIQIIXVFFEFNLGDPAIGKONUWLUTQTKZJYDEGPASTOMM9QTGOMYHFUKMNEVWPCMTLPDSOEEWDBRHZPZJIFMBUTY9QPRLPSVURIRMCWLH9YIZBOTJQMMF9ZP9VCCEGWVKSSQNANP9ZXVCAFGAVBXDJHUMKTKUBZRNKUGJTVUPDZMUK9KZI9EKY9DQDUNA9ZVPCROKYYPISSTDOJZJXMXZWSGZBEPKAUYPBPUTDVQKUYXWYTZXLYTCLLKLJUUJGFFCMZFKDTJET9KEDRMWZSAEFCSXLMRHRLG9EKLRZJ9NZQEONGFQSKSQMWRZXWVEGHCF9ZKGQITDLGFTZLCQMXVGVYIPKSUPPAOIKVWARJHAEJUZOOJFCFJTGQZWROSCEQSITQWZTQDFKECATBWSIRDFVWH9TXXUVEBRRKOTFSGBMGCMZDK9BJRVEUYOVNSLZNNSTWOB9CFNDJHJENDWSTIMMSWD9HSA9LDGTJDJFRGQCWOHYJNMFFLLDMVQEMCMNVQWMOGCEZUTK9MPULTDMKTIVFNVWXDNTRHNREHEDWIZCCRFVM9TXCTLBLYEKTRVVWHKZDOSYOBNLEKPNXMDZGLSVBBNBJIBZYBXZCENKVIXMNGUJUYFGFYFBKELSBZROQWKMESZTWDEEUCSXOWFSNJUGGJANMJFCBJV9GMDDJCAJHWKYQFJLFWZESTSIRBZQWYHGQDFUUWF9F9HXSBZRKBDLRWXSMKW99KPWJOQYPMHB9KWALSVLFNANYSMNWSJLUOCBKAWAJHNWMLPLXHVEPTKBPWLWHMDZ99999999999999999999999999999999999999999999999999999FDKW9AD99A99999999B99999999RJPQGE9AXNBBLPQ9IFJXFJTXJAIGDDXAWXGAVU9PJQNYFADJDIDBTJKSAEBBX9NWJGZVAVXYWXPCEFFH99XJLIVAZYJGPKEHANESX9DORLEIOIFL9WVQBBNUDRZDGJMVSRTSFKOJPIMEXPBCPGKUUEKRGAXOB99999XIFVJWCABR9XQKOWCXJAZDZWMWWBVHROBOPISAWDIJTSFPVAUZNJUMNUCOFIBIAAVIOWDTCNIPRVA9999999999999999999999999999999RSIDBWNOF999999999K99999999POWSRVIO9VMIJ99FKKNKGPNNNNP",
                "COSNPEACSPESTKTUS9CSMOCWVUBLERQJQGLLA9AYRRXMOVOBULQZZZJPLNELEX9EVZDAFOHBB9FBAYOTDB9YGJAVTDWNPJVVGEPFJ9QBYLXAYZEETY9GMYQRIRAIPWMJUFMFRSQRCEIOWISMBJKGCIGIIYNMXAYLXZIBNKANT9DSQXPBUPWGUJTOMD9JKSNFZJJFBZYBWRWQIZFOZXQWNJTRZTUPHVEGTAOLMBEPXOB9TCEBNIWXQUHNQJZHAOWGVOOOTSCTEUEMXJUODZP9CDLCMEXAW9YJGVNREENETEYXOAKZVRJVUSCRUSRCNZUGUOLCNHQITWYPJVJGPVULASTONDZRDVCNGJSN9DMMUORCOIBTITSPBXSAVTOHSAXHMGH99APRTQIVCEI9NWYKDOZCCWBNZGGCUCISSMGJHJ9OVSFBZVFMBODKRKSLIDESGFDQITCYFARWYTLFKSPLNVQ9LTYFODCHBAJKCWVZNBLOJH9ABFGDFOXHDNHZILINMYMVZYWTFJJOLADPTZRPJEMGPFQNYTFDGOKMDTDSKPTHIDWLMRSSACZMTHUCWVZHCYSPJRATABZ9JHWEBGTTQORGFOYDWUIYFYGOGGTYGYYI9RPKPMCTYNYKHHNWQKJTDQDHTRUYQPMCDDLVUUHUBPWGPMNQYPKHDHGIUSXJGNUXIYGZRGVYPTTV9KXJDLGVVXRIWIGKZJVCQ9DUWAYNDRKYCGKZDEOKZQCXELSQXLGLAPBDIWRTKGSIRNAZ9XFEGMWOWLPUA9TSGYRDOU9GKY9JJDKCJKKGJCRARGSNECJ9SEVAGPPJMBTMGNWSLNSFBOEYMIQBKOVSCTDIWCOQTHBVTZOFNNIYKKJLAROKIRFFPCLSOWO9BVNNJSXEYLJASPUEFKCEI9SGWADNGS9MZAKFTCAYNRVKGDIGYDTPGJXWFAEFGG9BX9XCNBZGQULH9IPPIQ9VFVAXGELUMCTE9TOFOGCTFYBYEBFOKKAESIIHEWLYLQKWDHPYNELJKMZHDSDSK9ZWFP99FQFLUXGTSVDMGHIFZFUCYTYPVEFEDM9TOHCQVIBXARYWZEKTWEOVSBYZTJZRUFZJCLRBTOWPTKY99CYQTGPMAKFYALIWPEQLUB9RGANTKDDMSDSJOTNPFZCXKJUGTJWWPK9FAJGPJOEBRHL9ZU9XRBDJBVMFIZIZFGKETH9RJUSDIOWDZIXFOJLT9DSIAWSCEYBNOGOAZQPZKVZTBXGACCBVQGFNGXNQFTVPUGUOHNBKTUERLSTDXGRKZSATIRHDBSXARYATBHOLUHCQGPRMQGSJUAXUCWKDXAUGORHFVVVDZQEYYGSV9IUM9VTMHJCIKBQD9TQLLYTZHAKDHPFGYMRGJOEDJKQTBBNFCKDEPYTPWUJEOPRJWHAILMVW9AXS9HAT9GCGRXZEHWNDOVGKGPWFXFC9IKLVZJCTGZUJFRHGL9FZWZYP9TPOWGOUTQ9INYBVTD9N9OV9AM9GYRJ99MRWRWLOAKJXMDTFNS9NZQAYGVZRJ9WVSIDRRQLGKH9VPUVKFWZMSRVVLKXUGJAZESC9LEYDNNDWS9WTWNFPCR9YKPOMIJAVHCRCJVBDFWSTDN9BPJRDMGZFXWTY9GUX9WEPJQMXSECFPREXAJ9DU9OLMNQFTF99QYZOGDUTMBHMNMCNUQTU9FTNEUNBT9NQO9YADGY9C9LQR9DYVJZE9GMMYAOUSWUIVJ9EAR9EEFCO9SZTQ9JQHPIJGXIOQZHOSUSVMHBOLTYSEONVLRISNAN9KJHHFFISTYIHYVAMXLPNALDELETXVSWGUWOIVKNAKZKNNRVNJKE9WMNQBXFGXSYZQQSIODAKINA9CPBOGAYKJ9V9GS9HERXSVYPEILYXC9GURBREBCXRZJVXHUOPGYFLPIFBCOTMHFTAAUQUZVEKOWYFFGSCXDFDBTSGZRMPQR9EYSZYGQETCWFDRXVOXXCUBOQTBQGVLAONSTSLURFYSDPAVNCXNWVPQOUORMVSLYISQUQKXFYYMJSGHQP9VAAZABEAGJMCPIEBZQSYCPS9CNKFBDRDTDA9C9MVKGUISRX9ODVUJNPDWMZ9ESYXJ99ETDGSTJZMZYJEGRUWTORMCLNHLDQ9YIJWPMDYGGJQHMFPJ9VKINJUESTCBJQXFTCJFNUXPZONVKXJRAYGKIWHXSBZRKBDLRWXSMKW99KPWJOQYPMHB9KWALSVLFNANYSMNWSJLUOCBKAWAJHNWMLPLXHVEPTKBPWLWHMD999999999999999999999999999999999999999999999999999999FDKW9AD99B99999999B99999999RJPQGE9AXNBBLPQ9IFJXFJTXJAIGDDXAWXGAVU9PJQNYFADJDIDBTJKSAEBBX9NWJGZVAVXYWXPCEFFH9XIFVJWCABR9XQKOWCXJAZDZWMWWBVHROBOPISAWDIJTSFPVAUZNJUMNUCOFIBIAAVIOWDTCNIPRVA9999FTXZAEQIKGFJABOGCCQGOMKNASGWCQWMNIMRDTHKPJMTKDGMEQNZOAYARIYEWFZYJALRKFODOITTZ9999999999999999999999999999999LLHDBWNOF999999999K99999999POWSRVIO9VMIJ99UMGMTTTPNNNV",
        };
        List<TransactionViewModel> transactions = persistAndMapTxs(trytes);
        List<TransactionViewModel> bundleTxs = bundleValidator.validate(tangle, snapshotProvider.getInitialSnapshot(),
                transactions.get(0).getHash());
        assertTrue("no transactions should be returned", bundleTxs.isEmpty());
        assertEquals("should have changed the validity of the tail tx to invalid", -1,
                TransactionViewModel.fromHash(tangle, transactions.get(0).getHash()).getValidity());
    }

    @Test
    public void validateBundleWithInvalidBundleHashOnNonTailTransaction() throws Exception {
        // tail transaction's bundle hash is invalid
        String[] trytes = {
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999GNXKWQPHMFCEZZCKUCCD9PROQVPCTBVVAPHCLVOPYYQLQRMPGTQXBVZLKGGT9NXHUAASFIAVEOZTBSM9DA99999999999999999999999999RENGLE9BEAT9999999999999999FDKW9AD99999999999B99999999RJPQGE9AXNBBLPQ9IFJXFJTXJAIGDDXAWXGAVU9PJQNYFADJDIDBTJKSAEBBX9NWJGZVAVXYWXPCEFFH9DKZYSMJAQRLXZHCNPTJPJLOONNDZHGNTBIINGYKZQAAWF9LWQTHUQSAXMLQN9DKCQWHIJXNGLGQVA9999XIFVJWCABR9XQKOWCXJAZDZWMWWBVHROBOPISAWDIJTSFPVAUZNJUMNUCOFIBIAAVIOWDTCNIPRVA9999TANGLE9BEAT9999999999999999SVIDBWNOF999999999K99999999POWSRVIO9VMIJ99UGNETMNPNNNE",
                "YU9WINMHSBIJ9HRBKDEHZYOCDGOZ9HZSSVXAYYOD9AMAFBCROMLSFDFIAQKEXAVFDLJYVABRSONSTTXLCQJTSDRFDEXZIORLRSQDZQODNCHAAFUPGBCEVYNRSJQGUZRAQIIEZPFQGWPQIBMDVNZGQAKCU9VLHGYSNDPHCMOCTRYQOYHFPRQSGHSDEF9MSHGXYGUTHSBSF9SOSJQFOZXMQGCUXAYWLBJHXOHTOM9ITZPISEXLAYAZBHTZDDCOIHKDBL9AAXZEDFHDYCPXLDGR9JTVXDXBC9DRDVREEEVGVPWVEZHJBYQYTGDEWQHVEDTAVLWW9WBXOIGDGUAAAVKFMPVKSYBVOIWPYGCMACEAAHGUIQVFLFMSCPKTYQWJDGMDNLMDIUUYI9SZOFQPLKKACESSWIXPFYZWDHETYUGEVASPHBGQPJPWVESSUUEVUYDYNQUQURSMCEPKIHYXNFHZSHIIDTMEZQ9IPSHTBDK9UHRSIIEJRILBCMVUMGAGBMHKEMUUKQDCYAVIAN9MBWJCAUSSJRSAUEUBGEFFCFSOBVGLXBAIDOH9NXWQUSIFUINEVZUWELLVIOSSQRVHMTDBCATBWFSDJJDLURAUKEQEIRICSCXAOJNPWHQKYVTRLCRKHLFHHHPYSMUEAPMQPMPS9CHCIYXEYRNIOOGRWKVHUGIWJZIGPWGZGBGYTVC9UVEJ9JBIYMDHYXLWIDXHZVFCCPLYXDPQPJGMKNZMMONGNXSNNPCGEGRJTMCPTJONGPAEDMSHMGAPGBDWVCSCTJAECSHTEGBMVCDZMQYZ9IHERWGCKAIMFOJRAEDRDSWJASV9XYS9CTOEETPQHRKJZ9FPWTVCGLEJQJXVVDTYZ9DNSHQAINKROQQIPTFGTABEELYPBQHGNNB9NCL9BVTG9MH99BPIRNNGC9MQQRH9YUDYSUJIDSZKCIGEKFSJ9PXUYKVPUZYFIREUAMUZE9EIMJK9YGAZXZBPRXIRDCEVDHWOCFIJTVRCRZRRJGFLILKVNMJAX9MUMTXCWTUTP9NXBZUMAYYY9DNVZTCROBCMMHVKSQRXMGROCMMCDENWQWBV9LEIJONWTQXOUQZOTGEJHJELYZOPICLDWPHVCMBFSYHPIJYZQDEGYITVPYNQMXPRTPKADLUKW9AEMSMGIWCUMOQMUDN9HZGYKTNVVNLOQAFVETEDJMJVKYCE9RE9AJP9RMYFKGDEC9GIGAFXEXIYXPFBOMRPULVJMYTQEPDMMIABDHJGRNNCKADZAUFV9WCWFYFHXLCED9E9SKKYHVKDTGNCHEKFJL9YJHTSRUVKEPHPCQSFNBXKOJNGBSEOZLVVGNUQTRACVGEKDSORUHVSDSQNUZASWXRADGAUDYDPODDEDNDDT9OAEARSBLPVSYAOEYYZJIZIZDENQOKMXATCTD9NEFVQWNCET9N9IXWCCWHYUBDTDJUZFXWMATRYSGJUQAFKAPIQIIXVFFEFNLGDPAIGKONUWLUTQTKZJYDEGPASTOMM9QTGOMYHFUKMNEVWPCMTLPDSOEEWDBRHZPZJIFMBUTY9QPRLPSVURIRMCWLH9YIZBOTJQMMF9ZP9VCCEGWVKSSQNANP9ZXVCAFGAVBXDJHUMKTKUBZRNKUGJTVUPDZMUK9KZI9EKY9DQDUNA9ZVPCROKYYPISSTDOJZJXMXZWSGZBEPKAUYPBPUTDVQKUYXWYTZXLYTCLLKLJUUJGFFCMZFKDTJET9KEDRMWZSAEFCSXLMRHRLG9EKLRZJ9NZQEONGFQSKSQMWRZXWVEGHCF9ZKGQITDLGFTZLCQMXVGVYIPKSUPPAOIKVWARJHAEJUZOOJFCFJTGQZWROSCEQSITQWZTQDFKECATBWSIRDFVWH9TXXUVEBRRKOTFSGBMGCMZDK9BJRVEUYOVNSLZNNSTWOB9CFNDJHJENDWSTIMMSWD9HSA9LDGTJDJFRGQCWOHYJNMFFLLDMVQEMCMNVQWMOGCEZUTK9MPULTDMKTIVFNVWXDNTRHNREHEDWIZCCRFVM9TXCTLBLYEKTRVVWHKZDOSYOBNLEKPNXMDZGLSVBBNBJIBZYBXZCENKVIXMNGUJUYFGFYFBKELSBZROQWKMESZTWDEEUCSXOWFSNJUGGJANMJFCBJV9GMDDJCAJHWKYQFJLFWZESTSIRBZQWYHGQDFUUWF9F9HXSBZRKBDLRWXSMKW99KPWJOQYPMHB9KWALSVLFNANYSMNWSJLUOCBKAWAJHNWMLPLXHVEPTKBPWLWHMDZ99999999999999999999999999999999999999999999999999999FDKW9AD99A99999999B99999999AAAAAAAAAAAAAPQ9IFJXFJTXJAIGDDXAWXGAVU9PJQNYFADJDIDBTJKSAEBBX9NWJGZVAVXYWXPCEFFH99XJLIVAZYJGPKEHANESX9DORLEIOIFL9WVQBBNUDRZDGJMVSRTSFKOJPIMEXPBCPGKUUEKRGAXOB99999XIFVJWCABR9XQKOWCXJAZDZWMWWBVHROBOPISAWDIJTSFPVAUZNJUMNUCOFIBIAAVIOWDTCNIPRVA9999999999999999999999999999999RSIDBWNOF999999999K99999999POWSRVIO9VMIJ99FKKNKGPNNNNP",
                "COSNPEACSPESTKTUS9CSMOCWVUBLERQJQGLLA9AYRRXMOVOBULQZZZJPLNELEX9EVZDAFOHBB9FBAYOTDB9YGJAVTDWNPJVVGEPFJ9QBYLXAYZEETY9GMYQRIRAIPWMJUFMFRSQRCEIOWISMBJKGCIGIIYNMXAYLXZIBNKANT9DSQXPBUPWGUJTOMD9JKSNFZJJFBZYBWRWQIZFOZXQWNJTRZTUPHVEGTAOLMBEPXOB9TCEBNIWXQUHNQJZHAOWGVOOOTSCTEUEMXJUODZP9CDLCMEXAW9YJGVNREENETEYXOAKZVRJVUSCRUSRCNZUGUOLCNHQITWYPJVJGPVULASTONDZRDVCNGJSN9DMMUORCOIBTITSPBXSAVTOHSAXHMGH99APRTQIVCEI9NWYKDOZCCWBNZGGCUCISSMGJHJ9OVSFBZVFMBODKRKSLIDESGFDQITCYFARWYTLFKSPLNVQ9LTYFODCHBAJKCWVZNBLOJH9ABFGDFOXHDNHZILINMYMVZYWTFJJOLADPTZRPJEMGPFQNYTFDGOKMDTDSKPTHIDWLMRSSACZMTHUCWVZHCYSPJRATABZ9JHWEBGTTQORGFOYDWUIYFYGOGGTYGYYI9RPKPMCTYNYKHHNWQKJTDQDHTRUYQPMCDDLVUUHUBPWGPMNQYPKHDHGIUSXJGNUXIYGZRGVYPTTV9KXJDLGVVXRIWIGKZJVCQ9DUWAYNDRKYCGKZDEOKZQCXELSQXLGLAPBDIWRTKGSIRNAZ9XFEGMWOWLPUA9TSGYRDOU9GKY9JJDKCJKKGJCRARGSNECJ9SEVAGPPJMBTMGNWSLNSFBOEYMIQBKOVSCTDIWCOQTHBVTZOFNNIYKKJLAROKIRFFPCLSOWO9BVNNJSXEYLJASPUEFKCEI9SGWADNGS9MZAKFTCAYNRVKGDIGYDTPGJXWFAEFGG9BX9XCNBZGQULH9IPPIQ9VFVAXGELUMCTE9TOFOGCTFYBYEBFOKKAESIIHEWLYLQKWDHPYNELJKMZHDSDSK9ZWFP99FQFLUXGTSVDMGHIFZFUCYTYPVEFEDM9TOHCQVIBXARYWZEKTWEOVSBYZTJZRUFZJCLRBTOWPTKY99CYQTGPMAKFYALIWPEQLUB9RGANTKDDMSDSJOTNPFZCXKJUGTJWWPK9FAJGPJOEBRHL9ZU9XRBDJBVMFIZIZFGKETH9RJUSDIOWDZIXFOJLT9DSIAWSCEYBNOGOAZQPZKVZTBXGACCBVQGFNGXNQFTVPUGUOHNBKTUERLSTDXGRKZSATIRHDBSXARYATBHOLUHCQGPRMQGSJUAXUCWKDXAUGORHFVVVDZQEYYGSV9IUM9VTMHJCIKBQD9TQLLYTZHAKDHPFGYMRGJOEDJKQTBBNFCKDEPYTPWUJEOPRJWHAILMVW9AXS9HAT9GCGRXZEHWNDOVGKGPWFXFC9IKLVZJCTGZUJFRHGL9FZWZYP9TPOWGOUTQ9INYBVTD9N9OV9AM9GYRJ99MRWRWLOAKJXMDTFNS9NZQAYGVZRJ9WVSIDRRQLGKH9VPUVKFWZMSRVVLKXUGJAZESC9LEYDNNDWS9WTWNFPCR9YKPOMIJAVHCRCJVBDFWSTDN9BPJRDMGZFXWTY9GUX9WEPJQMXSECFPREXAJ9DU9OLMNQFTF99QYZOGDUTMBHMNMCNUQTU9FTNEUNBT9NQO9YADGY9C9LQR9DYVJZE9GMMYAOUSWUIVJ9EAR9EEFCO9SZTQ9JQHPIJGXIOQZHOSUSVMHBOLTYSEONVLRISNAN9KJHHFFISTYIHYVAMXLPNALDELETXVSWGUWOIVKNAKZKNNRVNJKE9WMNQBXFGXSYZQQSIODAKINA9CPBOGAYKJ9V9GS9HERXSVYPEILYXC9GURBREBCXRZJVXHUOPGYFLPIFBCOTMHFTAAUQUZVEKOWYFFGSCXDFDBTSGZRMPQR9EYSZYGQETCWFDRXVOXXCUBOQTBQGVLAONSTSLURFYSDPAVNCXNWVPQOUORMVSLYISQUQKXFYYMJSGHQP9VAAZABEAGJMCPIEBZQSYCPS9CNKFBDRDTDA9C9MVKGUISRX9ODVUJNPDWMZ9ESYXJ99ETDGSTJZMZYJEGRUWTORMCLNHLDQ9YIJWPMDYGGJQHMFPJ9VKINJUESTCBJQXFTCJFNUXPZONVKXJRAYGKIWHXSBZRKBDLRWXSMKW99KPWJOQYPMHB9KWALSVLFNANYSMNWSJLUOCBKAWAJHNWMLPLXHVEPTKBPWLWHMD999999999999999999999999999999999999999999999999999999FDKW9AD99B99999999B99999999RJPQGE9AXNBBLPQ9IFJXFJTXJAIGDDXAWXGAVU9PJQNYFADJDIDBTJKSAEBBX9NWJGZVAVXYWXPCEFFH9XIFVJWCABR9XQKOWCXJAZDZWMWWBVHROBOPISAWDIJTSFPVAUZNJUMNUCOFIBIAAVIOWDTCNIPRVA9999FTXZAEQIKGFJABOGCCQGOMKNASGWCQWMNIMRDTHKPJMTKDGMEQNZOAYARIYEWFZYJALRKFODOITTZ9999999999999999999999999999999LLHDBWNOF999999999K99999999POWSRVIO9VMIJ99UMGMTTTPNNNV",
        };
        List<TransactionViewModel> transactions = persistAndMapTxs(trytes);
        List<TransactionViewModel> bundleTxs = bundleValidator.validate(tangle, snapshotProvider.getInitialSnapshot(),
                transactions.get(0).getHash());
        assertTrue("no transactions should be returned", bundleTxs.isEmpty());
        assertEquals("should have changed the validity of the tail tx to invalid", -1,
                TransactionViewModel.fromHash(tangle, transactions.get(0).getHash()).getValidity());
    }


    @Test
    public void validateSemanticsOfValidBundle() {
        String[] trytes = {
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999GNXKWQPHMFCEZZCKUCCD9PROQVPCTBVVAPHCLVOPYYQLQRMPGTQXBVZLKGGT9NXHUAASFIAVEOZTBSM9DA99999999999999999999999999RENGLE9BEAT9999999999999999FDKW9AD99999999999B99999999RJPQGE9AXNBBLPQ9IFJXFJTXJAIGDDXAWXGAVU9PJQNYFADJDIDBTJKSAEBBX9NWJGZVAVXYWXPCEFFH9DKZYSMJAQRLXZHCNPTJPJLOONNDZHGNTBIINGYKZQAAWF9LWQTHUQSAXMLQN9DKCQWHIJXNGLGQVA9999XIFVJWCABR9XQKOWCXJAZDZWMWWBVHROBOPISAWDIJTSFPVAUZNJUMNUCOFIBIAAVIOWDTCNIPRVA9999TANGLE9BEAT9999999999999999SVIDBWNOF999999999K99999999POWSRVIO9VMIJ99UGNETMNPNNNE",
                "YU9WINMHSBIJ9HRBKDEHZYOCDGOZ9HZSSVXAYYOD9AMAFBCROMLSFDFIAQKEXAVFDLJYVABRSONSTTXLCQJTSDRFDEXZIORLRSQDZQODNCHAAFUPGBCEVYNRSJQGUZRAQIIEZPFQGWPQIBMDVNZGQAKCU9VLHGYSNDPHCMOCTRYQOYHFPRQSGHSDEF9MSHGXYGUTHSBSF9SOSJQFOZXMQGCUXAYWLBJHXOHTOM9ITZPISEXLAYAZBHTZDDCOIHKDBL9AAXZEDFHDYCPXLDGR9JTVXDXBC9DRDVREEEVGVPWVEZHJBYQYTGDEWQHVEDTAVLWW9WBXOIGDGUAAAVKFMPVKSYBVOIWPYGCMACEAAHGUIQVFLFMSCPKTYQWJDGMDNLMDIUUYI9SZOFQPLKKACESSWIXPFYZWDHETYUGEVASPHBGQPJPWVESSUUEVUYDYNQUQURSMCEPKIHYXNFHZSHIIDTMEZQ9IPSHTBDK9UHRSIIEJRILBCMVUMGAGBMHKEMUUKQDCYAVIAN9MBWJCAUSSJRSAUEUBGEFFCFSOBVGLXBAIDOH9NXWQUSIFUINEVZUWELLVIOSSQRVHMTDBCATBWFSDJJDLURAUKEQEIRICSCXAOJNPWHQKYVTRLCRKHLFHHHPYSMUEAPMQPMPS9CHCIYXEYRNIOOGRWKVHUGIWJZIGPWGZGBGYTVC9UVEJ9JBIYMDHYXLWIDXHZVFCCPLYXDPQPJGMKNZMMONGNXSNNPCGEGRJTMCPTJONGPAEDMSHMGAPGBDWVCSCTJAECSHTEGBMVCDZMQYZ9IHERWGCKAIMFOJRAEDRDSWJASV9XYS9CTOEETPQHRKJZ9FPWTVCGLEJQJXVVDTYZ9DNSHQAINKROQQIPTFGTABEELYPBQHGNNB9NCL9BVTG9MH99BPIRNNGC9MQQRH9YUDYSUJIDSZKCIGEKFSJ9PXUYKVPUZYFIREUAMUZE9EIMJK9YGAZXZBPRXIRDCEVDHWOCFIJTVRCRZRRJGFLILKVNMJAX9MUMTXCWTUTP9NXBZUMAYYY9DNVZTCROBCMMHVKSQRXMGROCMMCDENWQWBV9LEIJONWTQXOUQZOTGEJHJELYZOPICLDWPHVCMBFSYHPIJYZQDEGYITVPYNQMXPRTPKADLUKW9AEMSMGIWCUMOQMUDN9HZGYKTNVVNLOQAFVETEDJMJVKYCE9RE9AJP9RMYFKGDEC9GIGAFXEXIYXPFBOMRPULVJMYTQEPDMMIABDHJGRNNCKADZAUFV9WCWFYFHXLCED9E9SKKYHVKDTGNCHEKFJL9YJHTSRUVKEPHPCQSFNBXKOJNGBSEOZLVVGNUQTRACVGEKDSORUHVSDSQNUZASWXRADGAUDYDPODDEDNDDT9OAEARSBLPVSYAOEYYZJIZIZDENQOKMXATCTD9NEFVQWNCET9N9IXWCCWHYUBDTDJUZFXWMATRYSGJUQAFKAPIQIIXVFFEFNLGDPAIGKONUWLUTQTKZJYDEGPASTOMM9QTGOMYHFUKMNEVWPCMTLPDSOEEWDBRHZPZJIFMBUTY9QPRLPSVURIRMCWLH9YIZBOTJQMMF9ZP9VCCEGWVKSSQNANP9ZXVCAFGAVBXDJHUMKTKUBZRNKUGJTVUPDZMUK9KZI9EKY9DQDUNA9ZVPCROKYYPISSTDOJZJXMXZWSGZBEPKAUYPBPUTDVQKUYXWYTZXLYTCLLKLJUUJGFFCMZFKDTJET9KEDRMWZSAEFCSXLMRHRLG9EKLRZJ9NZQEONGFQSKSQMWRZXWVEGHCF9ZKGQITDLGFTZLCQMXVGVYIPKSUPPAOIKVWARJHAEJUZOOJFCFJTGQZWROSCEQSITQWZTQDFKECATBWSIRDFVWH9TXXUVEBRRKOTFSGBMGCMZDK9BJRVEUYOVNSLZNNSTWOB9CFNDJHJENDWSTIMMSWD9HSA9LDGTJDJFRGQCWOHYJNMFFLLDMVQEMCMNVQWMOGCEZUTK9MPULTDMKTIVFNVWXDNTRHNREHEDWIZCCRFVM9TXCTLBLYEKTRVVWHKZDOSYOBNLEKPNXMDZGLSVBBNBJIBZYBXZCENKVIXMNGUJUYFGFYFBKELSBZROQWKMESZTWDEEUCSXOWFSNJUGGJANMJFCBJV9GMDDJCAJHWKYQFJLFWZESTSIRBZQWYHGQDFUUWF9F9HXSBZRKBDLRWXSMKW99KPWJOQYPMHB9KWALSVLFNANYSMNWSJLUOCBKAWAJHNWMLPLXHVEPTKBPWLWHMDZ99999999999999999999999999999999999999999999999999999FDKW9AD99A99999999B99999999RJPQGE9AXNBBLPQ9IFJXFJTXJAIGDDXAWXGAVU9PJQNYFADJDIDBTJKSAEBBX9NWJGZVAVXYWXPCEFFH99XJLIVAZYJGPKEHANESX9DORLEIOIFL9WVQBBNUDRZDGJMVSRTSFKOJPIMEXPBCPGKUUEKRGAXOB99999XIFVJWCABR9XQKOWCXJAZDZWMWWBVHROBOPISAWDIJTSFPVAUZNJUMNUCOFIBIAAVIOWDTCNIPRVA9999999999999999999999999999999RSIDBWNOF999999999K99999999POWSRVIO9VMIJ99FKKNKGPNNNNP",
                "COSNPEACSPESTKTUS9CSMOCWVUBLERQJQGLLA9AYRRXMOVOBULQZZZJPLNELEX9EVZDAFOHBB9FBAYOTDB9YGJAVTDWNPJVVGEPFJ9QBYLXAYZEETY9GMYQRIRAIPWMJUFMFRSQRCEIOWISMBJKGCIGIIYNMXAYLXZIBNKANT9DSQXPBUPWGUJTOMD9JKSNFZJJFBZYBWRWQIZFOZXQWNJTRZTUPHVEGTAOLMBEPXOB9TCEBNIWXQUHNQJZHAOWGVOOOTSCTEUEMXJUODZP9CDLCMEXAW9YJGVNREENETEYXOAKZVRJVUSCRUSRCNZUGUOLCNHQITWYPJVJGPVULASTONDZRDVCNGJSN9DMMUORCOIBTITSPBXSAVTOHSAXHMGH99APRTQIVCEI9NWYKDOZCCWBNZGGCUCISSMGJHJ9OVSFBZVFMBODKRKSLIDESGFDQITCYFARWYTLFKSPLNVQ9LTYFODCHBAJKCWVZNBLOJH9ABFGDFOXHDNHZILINMYMVZYWTFJJOLADPTZRPJEMGPFQNYTFDGOKMDTDSKPTHIDWLMRSSACZMTHUCWVZHCYSPJRATABZ9JHWEBGTTQORGFOYDWUIYFYGOGGTYGYYI9RPKPMCTYNYKHHNWQKJTDQDHTRUYQPMCDDLVUUHUBPWGPMNQYPKHDHGIUSXJGNUXIYGZRGVYPTTV9KXJDLGVVXRIWIGKZJVCQ9DUWAYNDRKYCGKZDEOKZQCXELSQXLGLAPBDIWRTKGSIRNAZ9XFEGMWOWLPUA9TSGYRDOU9GKY9JJDKCJKKGJCRARGSNECJ9SEVAGPPJMBTMGNWSLNSFBOEYMIQBKOVSCTDIWCOQTHBVTZOFNNIYKKJLAROKIRFFPCLSOWO9BVNNJSXEYLJASPUEFKCEI9SGWADNGS9MZAKFTCAYNRVKGDIGYDTPGJXWFAEFGG9BX9XCNBZGQULH9IPPIQ9VFVAXGELUMCTE9TOFOGCTFYBYEBFOKKAESIIHEWLYLQKWDHPYNELJKMZHDSDSK9ZWFP99FQFLUXGTSVDMGHIFZFUCYTYPVEFEDM9TOHCQVIBXARYWZEKTWEOVSBYZTJZRUFZJCLRBTOWPTKY99CYQTGPMAKFYALIWPEQLUB9RGANTKDDMSDSJOTNPFZCXKJUGTJWWPK9FAJGPJOEBRHL9ZU9XRBDJBVMFIZIZFGKETH9RJUSDIOWDZIXFOJLT9DSIAWSCEYBNOGOAZQPZKVZTBXGACCBVQGFNGXNQFTVPUGUOHNBKTUERLSTDXGRKZSATIRHDBSXARYATBHOLUHCQGPRMQGSJUAXUCWKDXAUGORHFVVVDZQEYYGSV9IUM9VTMHJCIKBQD9TQLLYTZHAKDHPFGYMRGJOEDJKQTBBNFCKDEPYTPWUJEOPRJWHAILMVW9AXS9HAT9GCGRXZEHWNDOVGKGPWFXFC9IKLVZJCTGZUJFRHGL9FZWZYP9TPOWGOUTQ9INYBVTD9N9OV9AM9GYRJ99MRWRWLOAKJXMDTFNS9NZQAYGVZRJ9WVSIDRRQLGKH9VPUVKFWZMSRVVLKXUGJAZESC9LEYDNNDWS9WTWNFPCR9YKPOMIJAVHCRCJVBDFWSTDN9BPJRDMGZFXWTY9GUX9WEPJQMXSECFPREXAJ9DU9OLMNQFTF99QYZOGDUTMBHMNMCNUQTU9FTNEUNBT9NQO9YADGY9C9LQR9DYVJZE9GMMYAOUSWUIVJ9EAR9EEFCO9SZTQ9JQHPIJGXIOQZHOSUSVMHBOLTYSEONVLRISNAN9KJHHFFISTYIHYVAMXLPNALDELETXVSWGUWOIVKNAKZKNNRVNJKE9WMNQBXFGXSYZQQSIODAKINA9CPBOGAYKJ9V9GS9HERXSVYPEILYXC9GURBREBCXRZJVXHUOPGYFLPIFBCOTMHFTAAUQUZVEKOWYFFGSCXDFDBTSGZRMPQR9EYSZYGQETCWFDRXVOXXCUBOQTBQGVLAONSTSLURFYSDPAVNCXNWVPQOUORMVSLYISQUQKXFYYMJSGHQP9VAAZABEAGJMCPIEBZQSYCPS9CNKFBDRDTDA9C9MVKGUISRX9ODVUJNPDWMZ9ESYXJ99ETDGSTJZMZYJEGRUWTORMCLNHLDQ9YIJWPMDYGGJQHMFPJ9VKINJUESTCBJQXFTCJFNUXPZONVKXJRAYGKIWHXSBZRKBDLRWXSMKW99KPWJOQYPMHB9KWALSVLFNANYSMNWSJLUOCBKAWAJHNWMLPLXHVEPTKBPWLWHMD999999999999999999999999999999999999999999999999999999FDKW9AD99B99999999B99999999RJPQGE9AXNBBLPQ9IFJXFJTXJAIGDDXAWXGAVU9PJQNYFADJDIDBTJKSAEBBX9NWJGZVAVXYWXPCEFFH9XIFVJWCABR9XQKOWCXJAZDZWMWWBVHROBOPISAWDIJTSFPVAUZNJUMNUCOFIBIAAVIOWDTCNIPRVA9999FTXZAEQIKGFJABOGCCQGOMKNASGWCQWMNIMRDTHKPJMTKDGMEQNZOAYARIYEWFZYJALRKFODOITTZ9999999999999999999999999999999LLHDBWNOF999999999K99999999POWSRVIO9VMIJ99UMGMTTTPNNNV",
        };
        List<TransactionViewModel> transactions = persistAndMapTxs(trytes);
        Map<Hash, TransactionViewModel> bundleTxsMapping = new HashMap<>();
        for (TransactionViewModel tvm : transactions) {
            bundleTxsMapping.put(tvm.getHash(), tvm);
        }
        List<TransactionViewModel> bundleTxs = new LinkedList<>();
        boolean valid = BundleValidator.validateBundleSemantics(transactions.get(0), bundleTxsMapping, bundleTxs);
        assertTrue("the bundle semantics should be valid", valid);
        assertEquals("built up bundle txs list should be the same", transactions, bundleTxs);
    }

    @Test
    public void validateSemanticsOfBundleWithMissingTransaction() {
        String[] trytes = {
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999GNXKWQPHMFCEZZCKUCCD9PROQVPCTBVVAPHCLVOPYYQLQRMPGTQXBVZLKGGT9NXHUAASFIAVEOZTBSM9DA99999999999999999999999999RENGLE9BEAT9999999999999999FDKW9AD99999999999B99999999RJPQGE9AXNBBLPQ9IFJXFJTXJAIGDDXAWXGAVU9PJQNYFADJDIDBTJKSAEBBX9NWJGZVAVXYWXPCEFFH9DKZYSMJAQRLXZHCNPTJPJLOONNDZHGNTBIINGYKZQAAWF9LWQTHUQSAXMLQN9DKCQWHIJXNGLGQVA9999XIFVJWCABR9XQKOWCXJAZDZWMWWBVHROBOPISAWDIJTSFPVAUZNJUMNUCOFIBIAAVIOWDTCNIPRVA9999TANGLE9BEAT9999999999999999SVIDBWNOF999999999K99999999POWSRVIO9VMIJ99UGNETMNPNNNE",
                "YU9WINMHSBIJ9HRBKDEHZYOCDGOZ9HZSSVXAYYOD9AMAFBCROMLSFDFIAQKEXAVFDLJYVABRSONSTTXLCQJTSDRFDEXZIORLRSQDZQODNCHAAFUPGBCEVYNRSJQGUZRAQIIEZPFQGWPQIBMDVNZGQAKCU9VLHGYSNDPHCMOCTRYQOYHFPRQSGHSDEF9MSHGXYGUTHSBSF9SOSJQFOZXMQGCUXAYWLBJHXOHTOM9ITZPISEXLAYAZBHTZDDCOIHKDBL9AAXZEDFHDYCPXLDGR9JTVXDXBC9DRDVREEEVGVPWVEZHJBYQYTGDEWQHVEDTAVLWW9WBXOIGDGUAAAVKFMPVKSYBVOIWPYGCMACEAAHGUIQVFLFMSCPKTYQWJDGMDNLMDIUUYI9SZOFQPLKKACESSWIXPFYZWDHETYUGEVASPHBGQPJPWVESSUUEVUYDYNQUQURSMCEPKIHYXNFHZSHIIDTMEZQ9IPSHTBDK9UHRSIIEJRILBCMVUMGAGBMHKEMUUKQDCYAVIAN9MBWJCAUSSJRSAUEUBGEFFCFSOBVGLXBAIDOH9NXWQUSIFUINEVZUWELLVIOSSQRVHMTDBCATBWFSDJJDLURAUKEQEIRICSCXAOJNPWHQKYVTRLCRKHLFHHHPYSMUEAPMQPMPS9CHCIYXEYRNIOOGRWKVHUGIWJZIGPWGZGBGYTVC9UVEJ9JBIYMDHYXLWIDXHZVFCCPLYXDPQPJGMKNZMMONGNXSNNPCGEGRJTMCPTJONGPAEDMSHMGAPGBDWVCSCTJAECSHTEGBMVCDZMQYZ9IHERWGCKAIMFOJRAEDRDSWJASV9XYS9CTOEETPQHRKJZ9FPWTVCGLEJQJXVVDTYZ9DNSHQAINKROQQIPTFGTABEELYPBQHGNNB9NCL9BVTG9MH99BPIRNNGC9MQQRH9YUDYSUJIDSZKCIGEKFSJ9PXUYKVPUZYFIREUAMUZE9EIMJK9YGAZXZBPRXIRDCEVDHWOCFIJTVRCRZRRJGFLILKVNMJAX9MUMTXCWTUTP9NXBZUMAYYY9DNVZTCROBCMMHVKSQRXMGROCMMCDENWQWBV9LEIJONWTQXOUQZOTGEJHJELYZOPICLDWPHVCMBFSYHPIJYZQDEGYITVPYNQMXPRTPKADLUKW9AEMSMGIWCUMOQMUDN9HZGYKTNVVNLOQAFVETEDJMJVKYCE9RE9AJP9RMYFKGDEC9GIGAFXEXIYXPFBOMRPULVJMYTQEPDMMIABDHJGRNNCKADZAUFV9WCWFYFHXLCED9E9SKKYHVKDTGNCHEKFJL9YJHTSRUVKEPHPCQSFNBXKOJNGBSEOZLVVGNUQTRACVGEKDSORUHVSDSQNUZASWXRADGAUDYDPODDEDNDDT9OAEARSBLPVSYAOEYYZJIZIZDENQOKMXATCTD9NEFVQWNCET9N9IXWCCWHYUBDTDJUZFXWMATRYSGJUQAFKAPIQIIXVFFEFNLGDPAIGKONUWLUTQTKZJYDEGPASTOMM9QTGOMYHFUKMNEVWPCMTLPDSOEEWDBRHZPZJIFMBUTY9QPRLPSVURIRMCWLH9YIZBOTJQMMF9ZP9VCCEGWVKSSQNANP9ZXVCAFGAVBXDJHUMKTKUBZRNKUGJTVUPDZMUK9KZI9EKY9DQDUNA9ZVPCROKYYPISSTDOJZJXMXZWSGZBEPKAUYPBPUTDVQKUYXWYTZXLYTCLLKLJUUJGFFCMZFKDTJET9KEDRMWZSAEFCSXLMRHRLG9EKLRZJ9NZQEONGFQSKSQMWRZXWVEGHCF9ZKGQITDLGFTZLCQMXVGVYIPKSUPPAOIKVWARJHAEJUZOOJFCFJTGQZWROSCEQSITQWZTQDFKECATBWSIRDFVWH9TXXUVEBRRKOTFSGBMGCMZDK9BJRVEUYOVNSLZNNSTWOB9CFNDJHJENDWSTIMMSWD9HSA9LDGTJDJFRGQCWOHYJNMFFLLDMVQEMCMNVQWMOGCEZUTK9MPULTDMKTIVFNVWXDNTRHNREHEDWIZCCRFVM9TXCTLBLYEKTRVVWHKZDOSYOBNLEKPNXMDZGLSVBBNBJIBZYBXZCENKVIXMNGUJUYFGFYFBKELSBZROQWKMESZTWDEEUCSXOWFSNJUGGJANMJFCBJV9GMDDJCAJHWKYQFJLFWZESTSIRBZQWYHGQDFUUWF9F9HXSBZRKBDLRWXSMKW99KPWJOQYPMHB9KWALSVLFNANYSMNWSJLUOCBKAWAJHNWMLPLXHVEPTKBPWLWHMDZ99999999999999999999999999999999999999999999999999999FDKW9AD99A99999999B99999999RJPQGE9AXNBBLPQ9IFJXFJTXJAIGDDXAWXGAVU9PJQNYFADJDIDBTJKSAEBBX9NWJGZVAVXYWXPCEFFH99XJLIVAZYJGPKEHANESX9DORLEIOIFL9WVQBBNUDRZDGJMVSRTSFKOJPIMEXPBCPGKUUEKRGAXOB99999XIFVJWCABR9XQKOWCXJAZDZWMWWBVHROBOPISAWDIJTSFPVAUZNJUMNUCOFIBIAAVIOWDTCNIPRVA9999999999999999999999999999999RSIDBWNOF999999999K99999999POWSRVIO9VMIJ99FKKNKGPNNNNP",
        };
        List<TransactionViewModel> transactions = persistAndMapTxs(trytes);
        Map<Hash, TransactionViewModel> bundleTxsMapping = new HashMap<>();
        for (TransactionViewModel tvm : transactions) {
            bundleTxsMapping.put(tvm.getHash(), tvm);
        }
        List<TransactionViewModel> bundleTxs = new LinkedList<>();
        boolean valid = BundleValidator.validateBundleSemantics(transactions.get(0), bundleTxsMapping, bundleTxs);
        assertFalse("the bundle semantics should be invalid", valid);
    }

    @Test
    public void validateSemanticsOfBundleWithInvalidIndices() {
        // indices of second and third tx swapped
        String[] trytes = {
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999GNXKWQPHMFCEZZCKUCCD9PROQVPCTBVVAPHCLVOPYYQLQRMPGTQXBVZLKGGT9NXHUAASFIAVEOZTBSM9DA99999999999999999999999999RENGLE9BEAT9999999999999999FDKW9AD99999999999B99999999RJPQGE9AXNBBLPQ9IFJXFJTXJAIGDDXAWXGAVU9PJQNYFADJDIDBTJKSAEBBX9NWJGZVAVXYWXPCEFFH9DKZYSMJAQRLXZHCNPTJPJLOONNDZHGNTBIINGYKZQAAWF9LWQTHUQSAXMLQN9DKCQWHIJXNGLGQVA9999XIFVJWCABR9XQKOWCXJAZDZWMWWBVHROBOPISAWDIJTSFPVAUZNJUMNUCOFIBIAAVIOWDTCNIPRVA9999TANGLE9BEAT9999999999999999SVIDBWNOF999999999K99999999POWSRVIO9VMIJ99UGNETMNPNNNE",
                "YU9WINMHSBIJ9HRBKDEHZYOCDGOZ9HZSSVXAYYOD9AMAFBCROMLSFDFIAQKEXAVFDLJYVABRSONSTTXLCQJTSDRFDEXZIORLRSQDZQODNCHAAFUPGBCEVYNRSJQGUZRAQIIEZPFQGWPQIBMDVNZGQAKCU9VLHGYSNDPHCMOCTRYQOYHFPRQSGHSDEF9MSHGXYGUTHSBSF9SOSJQFOZXMQGCUXAYWLBJHXOHTOM9ITZPISEXLAYAZBHTZDDCOIHKDBL9AAXZEDFHDYCPXLDGR9JTVXDXBC9DRDVREEEVGVPWVEZHJBYQYTGDEWQHVEDTAVLWW9WBXOIGDGUAAAVKFMPVKSYBVOIWPYGCMACEAAHGUIQVFLFMSCPKTYQWJDGMDNLMDIUUYI9SZOFQPLKKACESSWIXPFYZWDHETYUGEVASPHBGQPJPWVESSUUEVUYDYNQUQURSMCEPKIHYXNFHZSHIIDTMEZQ9IPSHTBDK9UHRSIIEJRILBCMVUMGAGBMHKEMUUKQDCYAVIAN9MBWJCAUSSJRSAUEUBGEFFCFSOBVGLXBAIDOH9NXWQUSIFUINEVZUWELLVIOSSQRVHMTDBCATBWFSDJJDLURAUKEQEIRICSCXAOJNPWHQKYVTRLCRKHLFHHHPYSMUEAPMQPMPS9CHCIYXEYRNIOOGRWKVHUGIWJZIGPWGZGBGYTVC9UVEJ9JBIYMDHYXLWIDXHZVFCCPLYXDPQPJGMKNZMMONGNXSNNPCGEGRJTMCPTJONGPAEDMSHMGAPGBDWVCSCTJAECSHTEGBMVCDZMQYZ9IHERWGCKAIMFOJRAEDRDSWJASV9XYS9CTOEETPQHRKJZ9FPWTVCGLEJQJXVVDTYZ9DNSHQAINKROQQIPTFGTABEELYPBQHGNNB9NCL9BVTG9MH99BPIRNNGC9MQQRH9YUDYSUJIDSZKCIGEKFSJ9PXUYKVPUZYFIREUAMUZE9EIMJK9YGAZXZBPRXIRDCEVDHWOCFIJTVRCRZRRJGFLILKVNMJAX9MUMTXCWTUTP9NXBZUMAYYY9DNVZTCROBCMMHVKSQRXMGROCMMCDENWQWBV9LEIJONWTQXOUQZOTGEJHJELYZOPICLDWPHVCMBFSYHPIJYZQDEGYITVPYNQMXPRTPKADLUKW9AEMSMGIWCUMOQMUDN9HZGYKTNVVNLOQAFVETEDJMJVKYCE9RE9AJP9RMYFKGDEC9GIGAFXEXIYXPFBOMRPULVJMYTQEPDMMIABDHJGRNNCKADZAUFV9WCWFYFHXLCED9E9SKKYHVKDTGNCHEKFJL9YJHTSRUVKEPHPCQSFNBXKOJNGBSEOZLVVGNUQTRACVGEKDSORUHVSDSQNUZASWXRADGAUDYDPODDEDNDDT9OAEARSBLPVSYAOEYYZJIZIZDENQOKMXATCTD9NEFVQWNCET9N9IXWCCWHYUBDTDJUZFXWMATRYSGJUQAFKAPIQIIXVFFEFNLGDPAIGKONUWLUTQTKZJYDEGPASTOMM9QTGOMYHFUKMNEVWPCMTLPDSOEEWDBRHZPZJIFMBUTY9QPRLPSVURIRMCWLH9YIZBOTJQMMF9ZP9VCCEGWVKSSQNANP9ZXVCAFGAVBXDJHUMKTKUBZRNKUGJTVUPDZMUK9KZI9EKY9DQDUNA9ZVPCROKYYPISSTDOJZJXMXZWSGZBEPKAUYPBPUTDVQKUYXWYTZXLYTCLLKLJUUJGFFCMZFKDTJET9KEDRMWZSAEFCSXLMRHRLG9EKLRZJ9NZQEONGFQSKSQMWRZXWVEGHCF9ZKGQITDLGFTZLCQMXVGVYIPKSUPPAOIKVWARJHAEJUZOOJFCFJTGQZWROSCEQSITQWZTQDFKECATBWSIRDFVWH9TXXUVEBRRKOTFSGBMGCMZDK9BJRVEUYOVNSLZNNSTWOB9CFNDJHJENDWSTIMMSWD9HSA9LDGTJDJFRGQCWOHYJNMFFLLDMVQEMCMNVQWMOGCEZUTK9MPULTDMKTIVFNVWXDNTRHNREHEDWIZCCRFVM9TXCTLBLYEKTRVVWHKZDOSYOBNLEKPNXMDZGLSVBBNBJIBZYBXZCENKVIXMNGUJUYFGFYFBKELSBZROQWKMESZTWDEEUCSXOWFSNJUGGJANMJFCBJV9GMDDJCAJHWKYQFJLFWZESTSIRBZQWYHGQDFUUWF9F9HXSBZRKBDLRWXSMKW99KPWJOQYPMHB9KWALSVLFNANYSMNWSJLUOCBKAWAJHNWMLPLXHVEPTKBPWLWHMDZ99999999999999999999999999999999999999999999999999999FDKW9AD99B99999999B99999999RJPQGE9AXNBBLPQ9IFJXFJTXJAIGDDXAWXGAVU9PJQNYFADJDIDBTJKSAEBBX9NWJGZVAVXYWXPCEFFH99XJLIVAZYJGPKEHANESX9DORLEIOIFL9WVQBBNUDRZDGJMVSRTSFKOJPIMEXPBCPGKUUEKRGAXOB99999XIFVJWCABR9XQKOWCXJAZDZWMWWBVHROBOPISAWDIJTSFPVAUZNJUMNUCOFIBIAAVIOWDTCNIPRVA9999999999999999999999999999999RSIDBWNOF999999999K99999999POWSRVIO9VMIJ99FKKNKGPNNNNP",
                "COSNPEACSPESTKTUS9CSMOCWVUBLERQJQGLLA9AYRRXMOVOBULQZZZJPLNELEX9EVZDAFOHBB9FBAYOTDB9YGJAVTDWNPJVVGEPFJ9QBYLXAYZEETY9GMYQRIRAIPWMJUFMFRSQRCEIOWISMBJKGCIGIIYNMXAYLXZIBNKANT9DSQXPBUPWGUJTOMD9JKSNFZJJFBZYBWRWQIZFOZXQWNJTRZTUPHVEGTAOLMBEPXOB9TCEBNIWXQUHNQJZHAOWGVOOOTSCTEUEMXJUODZP9CDLCMEXAW9YJGVNREENETEYXOAKZVRJVUSCRUSRCNZUGUOLCNHQITWYPJVJGPVULASTONDZRDVCNGJSN9DMMUORCOIBTITSPBXSAVTOHSAXHMGH99APRTQIVCEI9NWYKDOZCCWBNZGGCUCISSMGJHJ9OVSFBZVFMBODKRKSLIDESGFDQITCYFARWYTLFKSPLNVQ9LTYFODCHBAJKCWVZNBLOJH9ABFGDFOXHDNHZILINMYMVZYWTFJJOLADPTZRPJEMGPFQNYTFDGOKMDTDSKPTHIDWLMRSSACZMTHUCWVZHCYSPJRATABZ9JHWEBGTTQORGFOYDWUIYFYGOGGTYGYYI9RPKPMCTYNYKHHNWQKJTDQDHTRUYQPMCDDLVUUHUBPWGPMNQYPKHDHGIUSXJGNUXIYGZRGVYPTTV9KXJDLGVVXRIWIGKZJVCQ9DUWAYNDRKYCGKZDEOKZQCXELSQXLGLAPBDIWRTKGSIRNAZ9XFEGMWOWLPUA9TSGYRDOU9GKY9JJDKCJKKGJCRARGSNECJ9SEVAGPPJMBTMGNWSLNSFBOEYMIQBKOVSCTDIWCOQTHBVTZOFNNIYKKJLAROKIRFFPCLSOWO9BVNNJSXEYLJASPUEFKCEI9SGWADNGS9MZAKFTCAYNRVKGDIGYDTPGJXWFAEFGG9BX9XCNBZGQULH9IPPIQ9VFVAXGELUMCTE9TOFOGCTFYBYEBFOKKAESIIHEWLYLQKWDHPYNELJKMZHDSDSK9ZWFP99FQFLUXGTSVDMGHIFZFUCYTYPVEFEDM9TOHCQVIBXARYWZEKTWEOVSBYZTJZRUFZJCLRBTOWPTKY99CYQTGPMAKFYALIWPEQLUB9RGANTKDDMSDSJOTNPFZCXKJUGTJWWPK9FAJGPJOEBRHL9ZU9XRBDJBVMFIZIZFGKETH9RJUSDIOWDZIXFOJLT9DSIAWSCEYBNOGOAZQPZKVZTBXGACCBVQGFNGXNQFTVPUGUOHNBKTUERLSTDXGRKZSATIRHDBSXARYATBHOLUHCQGPRMQGSJUAXUCWKDXAUGORHFVVVDZQEYYGSV9IUM9VTMHJCIKBQD9TQLLYTZHAKDHPFGYMRGJOEDJKQTBBNFCKDEPYTPWUJEOPRJWHAILMVW9AXS9HAT9GCGRXZEHWNDOVGKGPWFXFC9IKLVZJCTGZUJFRHGL9FZWZYP9TPOWGOUTQ9INYBVTD9N9OV9AM9GYRJ99MRWRWLOAKJXMDTFNS9NZQAYGVZRJ9WVSIDRRQLGKH9VPUVKFWZMSRVVLKXUGJAZESC9LEYDNNDWS9WTWNFPCR9YKPOMIJAVHCRCJVBDFWSTDN9BPJRDMGZFXWTY9GUX9WEPJQMXSECFPREXAJ9DU9OLMNQFTF99QYZOGDUTMBHMNMCNUQTU9FTNEUNBT9NQO9YADGY9C9LQR9DYVJZE9GMMYAOUSWUIVJ9EAR9EEFCO9SZTQ9JQHPIJGXIOQZHOSUSVMHBOLTYSEONVLRISNAN9KJHHFFISTYIHYVAMXLPNALDELETXVSWGUWOIVKNAKZKNNRVNJKE9WMNQBXFGXSYZQQSIODAKINA9CPBOGAYKJ9V9GS9HERXSVYPEILYXC9GURBREBCXRZJVXHUOPGYFLPIFBCOTMHFTAAUQUZVEKOWYFFGSCXDFDBTSGZRMPQR9EYSZYGQETCWFDRXVOXXCUBOQTBQGVLAONSTSLURFYSDPAVNCXNWVPQOUORMVSLYISQUQKXFYYMJSGHQP9VAAZABEAGJMCPIEBZQSYCPS9CNKFBDRDTDA9C9MVKGUISRX9ODVUJNPDWMZ9ESYXJ99ETDGSTJZMZYJEGRUWTORMCLNHLDQ9YIJWPMDYGGJQHMFPJ9VKINJUESTCBJQXFTCJFNUXPZONVKXJRAYGKIWHXSBZRKBDLRWXSMKW99KPWJOQYPMHB9KWALSVLFNANYSMNWSJLUOCBKAWAJHNWMLPLXHVEPTKBPWLWHMD999999999999999999999999999999999999999999999999999999FDKW9AD99A99999999B99999999RJPQGE9AXNBBLPQ9IFJXFJTXJAIGDDXAWXGAVU9PJQNYFADJDIDBTJKSAEBBX9NWJGZVAVXYWXPCEFFH9XIFVJWCABR9XQKOWCXJAZDZWMWWBVHROBOPISAWDIJTSFPVAUZNJUMNUCOFIBIAAVIOWDTCNIPRVA9999FTXZAEQIKGFJABOGCCQGOMKNASGWCQWMNIMRDTHKPJMTKDGMEQNZOAYARIYEWFZYJALRKFODOITTZ9999999999999999999999999999999LLHDBWNOF999999999K99999999POWSRVIO9VMIJ99UMGMTTTPNNNV",
        };
        List<TransactionViewModel> transactions = persistAndMapTxs(trytes);
        Map<Hash, TransactionViewModel> bundleTxsMapping = new HashMap<>();
        for (TransactionViewModel tvm : transactions) {
            bundleTxsMapping.put(tvm.getHash(), tvm);
        }
        List<TransactionViewModel> bundleTxs = new LinkedList<>();
        boolean valid = BundleValidator.validateBundleSemantics(transactions.get(0), bundleTxsMapping, bundleTxs);
        assertFalse("the bundle semantics should be invalid", valid);
    }

    @Test
    public void validateSemanticsOfBundleWhichSpendsMoreThanMaxSupply() {
        // input tx at index 1 spends -3779530283277761
        String[] trytes = {
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999GNXKWQPHMFCEZZCKUCCD9PROQVPCTBVVAPHCLVOPYYQLQRMPGTQXBVZLKGGT9NXHUAASFIAVEOZTBSM9DA99999999999999999999999999RENGLE9BEAT9999999999999999FDKW9AD99999999999B99999999RJPQGE9AXNBBLPQ9IFJXFJTXJAIGDDXAWXGAVU9PJQNYFADJDIDBTJKSAEBBX9NWJGZVAVXYWXPCEFFH9DKZYSMJAQRLXZHCNPTJPJLOONNDZHGNTBIINGYKZQAAWF9LWQTHUQSAXMLQN9DKCQWHIJXNGLGQVA9999XIFVJWCABR9XQKOWCXJAZDZWMWWBVHROBOPISAWDIJTSFPVAUZNJUMNUCOFIBIAAVIOWDTCNIPRVA9999TANGLE9BEAT9999999999999999SVIDBWNOF999999999K99999999POWSRVIO9VMIJ99UGNETMNPNNNE",
                "YU9WINMHSBIJ9HRBKDEHZYOCDGOZ9HZSSVXAYYOD9AMAFBCROMLSFDFIAQKEXAVFDLJYVABRSONSTTXLCQJTSDRFDEXZIORLRSQDZQODNCHAAFUPGBCEVYNRSJQGUZRAQIIEZPFQGWPQIBMDVNZGQAKCU9VLHGYSNDPHCMOCTRYQOYHFPRQSGHSDEF9MSHGXYGUTHSBSF9SOSJQFOZXMQGCUXAYWLBJHXOHTOM9ITZPISEXLAYAZBHTZDDCOIHKDBL9AAXZEDFHDYCPXLDGR9JTVXDXBC9DRDVREEEVGVPWVEZHJBYQYTGDEWQHVEDTAVLWW9WBXOIGDGUAAAVKFMPVKSYBVOIWPYGCMACEAAHGUIQVFLFMSCPKTYQWJDGMDNLMDIUUYI9SZOFQPLKKACESSWIXPFYZWDHETYUGEVASPHBGQPJPWVESSUUEVUYDYNQUQURSMCEPKIHYXNFHZSHIIDTMEZQ9IPSHTBDK9UHRSIIEJRILBCMVUMGAGBMHKEMUUKQDCYAVIAN9MBWJCAUSSJRSAUEUBGEFFCFSOBVGLXBAIDOH9NXWQUSIFUINEVZUWELLVIOSSQRVHMTDBCATBWFSDJJDLURAUKEQEIRICSCXAOJNPWHQKYVTRLCRKHLFHHHPYSMUEAPMQPMPS9CHCIYXEYRNIOOGRWKVHUGIWJZIGPWGZGBGYTVC9UVEJ9JBIYMDHYXLWIDXHZVFCCPLYXDPQPJGMKNZMMONGNXSNNPCGEGRJTMCPTJONGPAEDMSHMGAPGBDWVCSCTJAECSHTEGBMVCDZMQYZ9IHERWGCKAIMFOJRAEDRDSWJASV9XYS9CTOEETPQHRKJZ9FPWTVCGLEJQJXVVDTYZ9DNSHQAINKROQQIPTFGTABEELYPBQHGNNB9NCL9BVTG9MH99BPIRNNGC9MQQRH9YUDYSUJIDSZKCIGEKFSJ9PXUYKVPUZYFIREUAMUZE9EIMJK9YGAZXZBPRXIRDCEVDHWOCFIJTVRCRZRRJGFLILKVNMJAX9MUMTXCWTUTP9NXBZUMAYYY9DNVZTCROBCMMHVKSQRXMGROCMMCDENWQWBV9LEIJONWTQXOUQZOTGEJHJELYZOPICLDWPHVCMBFSYHPIJYZQDEGYITVPYNQMXPRTPKADLUKW9AEMSMGIWCUMOQMUDN9HZGYKTNVVNLOQAFVETEDJMJVKYCE9RE9AJP9RMYFKGDEC9GIGAFXEXIYXPFBOMRPULVJMYTQEPDMMIABDHJGRNNCKADZAUFV9WCWFYFHXLCED9E9SKKYHVKDTGNCHEKFJL9YJHTSRUVKEPHPCQSFNBXKOJNGBSEOZLVVGNUQTRACVGEKDSORUHVSDSQNUZASWXRADGAUDYDPODDEDNDDT9OAEARSBLPVSYAOEYYZJIZIZDENQOKMXATCTD9NEFVQWNCET9N9IXWCCWHYUBDTDJUZFXWMATRYSGJUQAFKAPIQIIXVFFEFNLGDPAIGKONUWLUTQTKZJYDEGPASTOMM9QTGOMYHFUKMNEVWPCMTLPDSOEEWDBRHZPZJIFMBUTY9QPRLPSVURIRMCWLH9YIZBOTJQMMF9ZP9VCCEGWVKSSQNANP9ZXVCAFGAVBXDJHUMKTKUBZRNKUGJTVUPDZMUK9KZI9EKY9DQDUNA9ZVPCROKYYPISSTDOJZJXMXZWSGZBEPKAUYPBPUTDVQKUYXWYTZXLYTCLLKLJUUJGFFCMZFKDTJET9KEDRMWZSAEFCSXLMRHRLG9EKLRZJ9NZQEONGFQSKSQMWRZXWVEGHCF9ZKGQITDLGFTZLCQMXVGVYIPKSUPPAOIKVWARJHAEJUZOOJFCFJTGQZWROSCEQSITQWZTQDFKECATBWSIRDFVWH9TXXUVEBRRKOTFSGBMGCMZDK9BJRVEUYOVNSLZNNSTWOB9CFNDJHJENDWSTIMMSWD9HSA9LDGTJDJFRGQCWOHYJNMFFLLDMVQEMCMNVQWMOGCEZUTK9MPULTDMKTIVFNVWXDNTRHNREHEDWIZCCRFVM9TXCTLBLYEKTRVVWHKZDOSYOBNLEKPNXMDZGLSVBBNBJIBZYBXZCENKVIXMNGUJUYFGFYFBKELSBZROQWKMESZTWDEEUCSXOWFSNJUGGJANMJFCBJV9GMDDJCAJHWKYQFJLFWZESTSIRBZQWYHGQDFUUWF9F9HXSBZRKBDLRWXSMKW99KPWJOQYPMHB9KWALSVLFNANYSMNWSJLUOCBKAWAJHNWMLPLXHVEPTKBPWLWHMDMQFICSLUJQIZ999999999999999999999999999999999999999999FDKW9AD99A99999999B99999999RJPQGE9AXNBBLPQ9IFJXFJTXJAIGDDXAWXGAVU9PJQNYFADJDIDBTJKSAEBBX9NWJGZVAVXYWXPCEFFH99XJLIVAZYJGPKEHANESX9DORLEIOIFL9WVQBBNUDRZDGJMVSRTSFKOJPIMEXPBCPGKUUEKRGAXOB99999XIFVJWCABR9XQKOWCXJAZDZWMWWBVHROBOPISAWDIJTSFPVAUZNJUMNUCOFIBIAAVIOWDTCNIPRVA9999999999999999999999999999999RSIDBWNOF999999999K99999999POWSRVIO9VMIJ99FKKNKGPNNNNP",
                "COSNPEACSPESTKTUS9CSMOCWVUBLERQJQGLLA9AYRRXMOVOBULQZZZJPLNELEX9EVZDAFOHBB9FBAYOTDB9YGJAVTDWNPJVVGEPFJ9QBYLXAYZEETY9GMYQRIRAIPWMJUFMFRSQRCEIOWISMBJKGCIGIIYNMXAYLXZIBNKANT9DSQXPBUPWGUJTOMD9JKSNFZJJFBZYBWRWQIZFOZXQWNJTRZTUPHVEGTAOLMBEPXOB9TCEBNIWXQUHNQJZHAOWGVOOOTSCTEUEMXJUODZP9CDLCMEXAW9YJGVNREENETEYXOAKZVRJVUSCRUSRCNZUGUOLCNHQITWYPJVJGPVULASTONDZRDVCNGJSN9DMMUORCOIBTITSPBXSAVTOHSAXHMGH99APRTQIVCEI9NWYKDOZCCWBNZGGCUCISSMGJHJ9OVSFBZVFMBODKRKSLIDESGFDQITCYFARWYTLFKSPLNVQ9LTYFODCHBAJKCWVZNBLOJH9ABFGDFOXHDNHZILINMYMVZYWTFJJOLADPTZRPJEMGPFQNYTFDGOKMDTDSKPTHIDWLMRSSACZMTHUCWVZHCYSPJRATABZ9JHWEBGTTQORGFOYDWUIYFYGOGGTYGYYI9RPKPMCTYNYKHHNWQKJTDQDHTRUYQPMCDDLVUUHUBPWGPMNQYPKHDHGIUSXJGNUXIYGZRGVYPTTV9KXJDLGVVXRIWIGKZJVCQ9DUWAYNDRKYCGKZDEOKZQCXELSQXLGLAPBDIWRTKGSIRNAZ9XFEGMWOWLPUA9TSGYRDOU9GKY9JJDKCJKKGJCRARGSNECJ9SEVAGPPJMBTMGNWSLNSFBOEYMIQBKOVSCTDIWCOQTHBVTZOFNNIYKKJLAROKIRFFPCLSOWO9BVNNJSXEYLJASPUEFKCEI9SGWADNGS9MZAKFTCAYNRVKGDIGYDTPGJXWFAEFGG9BX9XCNBZGQULH9IPPIQ9VFVAXGELUMCTE9TOFOGCTFYBYEBFOKKAESIIHEWLYLQKWDHPYNELJKMZHDSDSK9ZWFP99FQFLUXGTSVDMGHIFZFUCYTYPVEFEDM9TOHCQVIBXARYWZEKTWEOVSBYZTJZRUFZJCLRBTOWPTKY99CYQTGPMAKFYALIWPEQLUB9RGANTKDDMSDSJOTNPFZCXKJUGTJWWPK9FAJGPJOEBRHL9ZU9XRBDJBVMFIZIZFGKETH9RJUSDIOWDZIXFOJLT9DSIAWSCEYBNOGOAZQPZKVZTBXGACCBVQGFNGXNQFTVPUGUOHNBKTUERLSTDXGRKZSATIRHDBSXARYATBHOLUHCQGPRMQGSJUAXUCWKDXAUGORHFVVVDZQEYYGSV9IUM9VTMHJCIKBQD9TQLLYTZHAKDHPFGYMRGJOEDJKQTBBNFCKDEPYTPWUJEOPRJWHAILMVW9AXS9HAT9GCGRXZEHWNDOVGKGPWFXFC9IKLVZJCTGZUJFRHGL9FZWZYP9TPOWGOUTQ9INYBVTD9N9OV9AM9GYRJ99MRWRWLOAKJXMDTFNS9NZQAYGVZRJ9WVSIDRRQLGKH9VPUVKFWZMSRVVLKXUGJAZESC9LEYDNNDWS9WTWNFPCR9YKPOMIJAVHCRCJVBDFWSTDN9BPJRDMGZFXWTY9GUX9WEPJQMXSECFPREXAJ9DU9OLMNQFTF99QYZOGDUTMBHMNMCNUQTU9FTNEUNBT9NQO9YADGY9C9LQR9DYVJZE9GMMYAOUSWUIVJ9EAR9EEFCO9SZTQ9JQHPIJGXIOQZHOSUSVMHBOLTYSEONVLRISNAN9KJHHFFISTYIHYVAMXLPNALDELETXVSWGUWOIVKNAKZKNNRVNJKE9WMNQBXFGXSYZQQSIODAKINA9CPBOGAYKJ9V9GS9HERXSVYPEILYXC9GURBREBCXRZJVXHUOPGYFLPIFBCOTMHFTAAUQUZVEKOWYFFGSCXDFDBTSGZRMPQR9EYSZYGQETCWFDRXVOXXCUBOQTBQGVLAONSTSLURFYSDPAVNCXNWVPQOUORMVSLYISQUQKXFYYMJSGHQP9VAAZABEAGJMCPIEBZQSYCPS9CNKFBDRDTDA9C9MVKGUISRX9ODVUJNPDWMZ9ESYXJ99ETDGSTJZMZYJEGRUWTORMCLNHLDQ9YIJWPMDYGGJQHMFPJ9VKINJUESTCBJQXFTCJFNUXPZONVKXJRAYGKIWHXSBZRKBDLRWXSMKW99KPWJOQYPMHB9KWALSVLFNANYSMNWSJLUOCBKAWAJHNWMLPLXHVEPTKBPWLWHMD999999999999999999999999999999999999999999999999999999FDKW9AD99B99999999B99999999RJPQGE9AXNBBLPQ9IFJXFJTXJAIGDDXAWXGAVU9PJQNYFADJDIDBTJKSAEBBX9NWJGZVAVXYWXPCEFFH9XIFVJWCABR9XQKOWCXJAZDZWMWWBVHROBOPISAWDIJTSFPVAUZNJUMNUCOFIBIAAVIOWDTCNIPRVA9999FTXZAEQIKGFJABOGCCQGOMKNASGWCQWMNIMRDTHKPJMTKDGMEQNZOAYARIYEWFZYJALRKFODOITTZ9999999999999999999999999999999LLHDBWNOF999999999K99999999POWSRVIO9VMIJ99UMGMTTTPNNNV",
        };
        List<TransactionViewModel> transactions = persistAndMapTxs(trytes);
        Map<Hash, TransactionViewModel> bundleTxsMapping = new HashMap<>();
        for (TransactionViewModel tvm : transactions) {
            bundleTxsMapping.put(tvm.getHash(), tvm);
        }
        List<TransactionViewModel> bundleTxs = new LinkedList<>();
        boolean valid = BundleValidator.validateBundleSemantics(transactions.get(0), bundleTxsMapping, bundleTxs);
        assertFalse("the bundle semantics should be invalid", valid);
    }

    @Test
    public void validateBundleHashOfValidBundle() {
        String[] trytes = {
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999GNXKWQPHMFCEZZCKUCCD9PROQVPCTBVVAPHCLVOPYYQLQRMPGTQXBVZLKGGT9NXHUAASFIAVEOZTBSM9DA99999999999999999999999999RENGLE9BEAT9999999999999999FDKW9AD99999999999B99999999RJPQGE9AXNBBLPQ9IFJXFJTXJAIGDDXAWXGAVU9PJQNYFADJDIDBTJKSAEBBX9NWJGZVAVXYWXPCEFFH9DKZYSMJAQRLXZHCNPTJPJLOONNDZHGNTBIINGYKZQAAWF9LWQTHUQSAXMLQN9DKCQWHIJXNGLGQVA9999XIFVJWCABR9XQKOWCXJAZDZWMWWBVHROBOPISAWDIJTSFPVAUZNJUMNUCOFIBIAAVIOWDTCNIPRVA9999TANGLE9BEAT9999999999999999SVIDBWNOF999999999K99999999POWSRVIO9VMIJ99UGNETMNPNNNE",
                "YU9WINMHSBIJ9HRBKDEHZYOCDGOZ9HZSSVXAYYOD9AMAFBCROMLSFDFIAQKEXAVFDLJYVABRSONSTTXLCQJTSDRFDEXZIORLRSQDZQODNCHAAFUPGBCEVYNRSJQGUZRAQIIEZPFQGWPQIBMDVNZGQAKCU9VLHGYSNDPHCMOCTRYQOYHFPRQSGHSDEF9MSHGXYGUTHSBSF9SOSJQFOZXMQGCUXAYWLBJHXOHTOM9ITZPISEXLAYAZBHTZDDCOIHKDBL9AAXZEDFHDYCPXLDGR9JTVXDXBC9DRDVREEEVGVPWVEZHJBYQYTGDEWQHVEDTAVLWW9WBXOIGDGUAAAVKFMPVKSYBVOIWPYGCMACEAAHGUIQVFLFMSCPKTYQWJDGMDNLMDIUUYI9SZOFQPLKKACESSWIXPFYZWDHETYUGEVASPHBGQPJPWVESSUUEVUYDYNQUQURSMCEPKIHYXNFHZSHIIDTMEZQ9IPSHTBDK9UHRSIIEJRILBCMVUMGAGBMHKEMUUKQDCYAVIAN9MBWJCAUSSJRSAUEUBGEFFCFSOBVGLXBAIDOH9NXWQUSIFUINEVZUWELLVIOSSQRVHMTDBCATBWFSDJJDLURAUKEQEIRICSCXAOJNPWHQKYVTRLCRKHLFHHHPYSMUEAPMQPMPS9CHCIYXEYRNIOOGRWKVHUGIWJZIGPWGZGBGYTVC9UVEJ9JBIYMDHYXLWIDXHZVFCCPLYXDPQPJGMKNZMMONGNXSNNPCGEGRJTMCPTJONGPAEDMSHMGAPGBDWVCSCTJAECSHTEGBMVCDZMQYZ9IHERWGCKAIMFOJRAEDRDSWJASV9XYS9CTOEETPQHRKJZ9FPWTVCGLEJQJXVVDTYZ9DNSHQAINKROQQIPTFGTABEELYPBQHGNNB9NCL9BVTG9MH99BPIRNNGC9MQQRH9YUDYSUJIDSZKCIGEKFSJ9PXUYKVPUZYFIREUAMUZE9EIMJK9YGAZXZBPRXIRDCEVDHWOCFIJTVRCRZRRJGFLILKVNMJAX9MUMTXCWTUTP9NXBZUMAYYY9DNVZTCROBCMMHVKSQRXMGROCMMCDENWQWBV9LEIJONWTQXOUQZOTGEJHJELYZOPICLDWPHVCMBFSYHPIJYZQDEGYITVPYNQMXPRTPKADLUKW9AEMSMGIWCUMOQMUDN9HZGYKTNVVNLOQAFVETEDJMJVKYCE9RE9AJP9RMYFKGDEC9GIGAFXEXIYXPFBOMRPULVJMYTQEPDMMIABDHJGRNNCKADZAUFV9WCWFYFHXLCED9E9SKKYHVKDTGNCHEKFJL9YJHTSRUVKEPHPCQSFNBXKOJNGBSEOZLVVGNUQTRACVGEKDSORUHVSDSQNUZASWXRADGAUDYDPODDEDNDDT9OAEARSBLPVSYAOEYYZJIZIZDENQOKMXATCTD9NEFVQWNCET9N9IXWCCWHYUBDTDJUZFXWMATRYSGJUQAFKAPIQIIXVFFEFNLGDPAIGKONUWLUTQTKZJYDEGPASTOMM9QTGOMYHFUKMNEVWPCMTLPDSOEEWDBRHZPZJIFMBUTY9QPRLPSVURIRMCWLH9YIZBOTJQMMF9ZP9VCCEGWVKSSQNANP9ZXVCAFGAVBXDJHUMKTKUBZRNKUGJTVUPDZMUK9KZI9EKY9DQDUNA9ZVPCROKYYPISSTDOJZJXMXZWSGZBEPKAUYPBPUTDVQKUYXWYTZXLYTCLLKLJUUJGFFCMZFKDTJET9KEDRMWZSAEFCSXLMRHRLG9EKLRZJ9NZQEONGFQSKSQMWRZXWVEGHCF9ZKGQITDLGFTZLCQMXVGVYIPKSUPPAOIKVWARJHAEJUZOOJFCFJTGQZWROSCEQSITQWZTQDFKECATBWSIRDFVWH9TXXUVEBRRKOTFSGBMGCMZDK9BJRVEUYOVNSLZNNSTWOB9CFNDJHJENDWSTIMMSWD9HSA9LDGTJDJFRGQCWOHYJNMFFLLDMVQEMCMNVQWMOGCEZUTK9MPULTDMKTIVFNVWXDNTRHNREHEDWIZCCRFVM9TXCTLBLYEKTRVVWHKZDOSYOBNLEKPNXMDZGLSVBBNBJIBZYBXZCENKVIXMNGUJUYFGFYFBKELSBZROQWKMESZTWDEEUCSXOWFSNJUGGJANMJFCBJV9GMDDJCAJHWKYQFJLFWZESTSIRBZQWYHGQDFUUWF9F9HXSBZRKBDLRWXSMKW99KPWJOQYPMHB9KWALSVLFNANYSMNWSJLUOCBKAWAJHNWMLPLXHVEPTKBPWLWHMDZ99999999999999999999999999999999999999999999999999999FDKW9AD99A99999999B99999999RJPQGE9AXNBBLPQ9IFJXFJTXJAIGDDXAWXGAVU9PJQNYFADJDIDBTJKSAEBBX9NWJGZVAVXYWXPCEFFH99XJLIVAZYJGPKEHANESX9DORLEIOIFL9WVQBBNUDRZDGJMVSRTSFKOJPIMEXPBCPGKUUEKRGAXOB99999XIFVJWCABR9XQKOWCXJAZDZWMWWBVHROBOPISAWDIJTSFPVAUZNJUMNUCOFIBIAAVIOWDTCNIPRVA9999999999999999999999999999999RSIDBWNOF999999999K99999999POWSRVIO9VMIJ99FKKNKGPNNNNP",
                "COSNPEACSPESTKTUS9CSMOCWVUBLERQJQGLLA9AYRRXMOVOBULQZZZJPLNELEX9EVZDAFOHBB9FBAYOTDB9YGJAVTDWNPJVVGEPFJ9QBYLXAYZEETY9GMYQRIRAIPWMJUFMFRSQRCEIOWISMBJKGCIGIIYNMXAYLXZIBNKANT9DSQXPBUPWGUJTOMD9JKSNFZJJFBZYBWRWQIZFOZXQWNJTRZTUPHVEGTAOLMBEPXOB9TCEBNIWXQUHNQJZHAOWGVOOOTSCTEUEMXJUODZP9CDLCMEXAW9YJGVNREENETEYXOAKZVRJVUSCRUSRCNZUGUOLCNHQITWYPJVJGPVULASTONDZRDVCNGJSN9DMMUORCOIBTITSPBXSAVTOHSAXHMGH99APRTQIVCEI9NWYKDOZCCWBNZGGCUCISSMGJHJ9OVSFBZVFMBODKRKSLIDESGFDQITCYFARWYTLFKSPLNVQ9LTYFODCHBAJKCWVZNBLOJH9ABFGDFOXHDNHZILINMYMVZYWTFJJOLADPTZRPJEMGPFQNYTFDGOKMDTDSKPTHIDWLMRSSACZMTHUCWVZHCYSPJRATABZ9JHWEBGTTQORGFOYDWUIYFYGOGGTYGYYI9RPKPMCTYNYKHHNWQKJTDQDHTRUYQPMCDDLVUUHUBPWGPMNQYPKHDHGIUSXJGNUXIYGZRGVYPTTV9KXJDLGVVXRIWIGKZJVCQ9DUWAYNDRKYCGKZDEOKZQCXELSQXLGLAPBDIWRTKGSIRNAZ9XFEGMWOWLPUA9TSGYRDOU9GKY9JJDKCJKKGJCRARGSNECJ9SEVAGPPJMBTMGNWSLNSFBOEYMIQBKOVSCTDIWCOQTHBVTZOFNNIYKKJLAROKIRFFPCLSOWO9BVNNJSXEYLJASPUEFKCEI9SGWADNGS9MZAKFTCAYNRVKGDIGYDTPGJXWFAEFGG9BX9XCNBZGQULH9IPPIQ9VFVAXGELUMCTE9TOFOGCTFYBYEBFOKKAESIIHEWLYLQKWDHPYNELJKMZHDSDSK9ZWFP99FQFLUXGTSVDMGHIFZFUCYTYPVEFEDM9TOHCQVIBXARYWZEKTWEOVSBYZTJZRUFZJCLRBTOWPTKY99CYQTGPMAKFYALIWPEQLUB9RGANTKDDMSDSJOTNPFZCXKJUGTJWWPK9FAJGPJOEBRHL9ZU9XRBDJBVMFIZIZFGKETH9RJUSDIOWDZIXFOJLT9DSIAWSCEYBNOGOAZQPZKVZTBXGACCBVQGFNGXNQFTVPUGUOHNBKTUERLSTDXGRKZSATIRHDBSXARYATBHOLUHCQGPRMQGSJUAXUCWKDXAUGORHFVVVDZQEYYGSV9IUM9VTMHJCIKBQD9TQLLYTZHAKDHPFGYMRGJOEDJKQTBBNFCKDEPYTPWUJEOPRJWHAILMVW9AXS9HAT9GCGRXZEHWNDOVGKGPWFXFC9IKLVZJCTGZUJFRHGL9FZWZYP9TPOWGOUTQ9INYBVTD9N9OV9AM9GYRJ99MRWRWLOAKJXMDTFNS9NZQAYGVZRJ9WVSIDRRQLGKH9VPUVKFWZMSRVVLKXUGJAZESC9LEYDNNDWS9WTWNFPCR9YKPOMIJAVHCRCJVBDFWSTDN9BPJRDMGZFXWTY9GUX9WEPJQMXSECFPREXAJ9DU9OLMNQFTF99QYZOGDUTMBHMNMCNUQTU9FTNEUNBT9NQO9YADGY9C9LQR9DYVJZE9GMMYAOUSWUIVJ9EAR9EEFCO9SZTQ9JQHPIJGXIOQZHOSUSVMHBOLTYSEONVLRISNAN9KJHHFFISTYIHYVAMXLPNALDELETXVSWGUWOIVKNAKZKNNRVNJKE9WMNQBXFGXSYZQQSIODAKINA9CPBOGAYKJ9V9GS9HERXSVYPEILYXC9GURBREBCXRZJVXHUOPGYFLPIFBCOTMHFTAAUQUZVEKOWYFFGSCXDFDBTSGZRMPQR9EYSZYGQETCWFDRXVOXXCUBOQTBQGVLAONSTSLURFYSDPAVNCXNWVPQOUORMVSLYISQUQKXFYYMJSGHQP9VAAZABEAGJMCPIEBZQSYCPS9CNKFBDRDTDA9C9MVKGUISRX9ODVUJNPDWMZ9ESYXJ99ETDGSTJZMZYJEGRUWTORMCLNHLDQ9YIJWPMDYGGJQHMFPJ9VKINJUESTCBJQXFTCJFNUXPZONVKXJRAYGKIWHXSBZRKBDLRWXSMKW99KPWJOQYPMHB9KWALSVLFNANYSMNWSJLUOCBKAWAJHNWMLPLXHVEPTKBPWLWHMD999999999999999999999999999999999999999999999999999999FDKW9AD99B99999999B99999999RJPQGE9AXNBBLPQ9IFJXFJTXJAIGDDXAWXGAVU9PJQNYFADJDIDBTJKSAEBBX9NWJGZVAVXYWXPCEFFH9XIFVJWCABR9XQKOWCXJAZDZWMWWBVHROBOPISAWDIJTSFPVAUZNJUMNUCOFIBIAAVIOWDTCNIPRVA9999FTXZAEQIKGFJABOGCCQGOMKNASGWCQWMNIMRDTHKPJMTKDGMEQNZOAYARIYEWFZYJALRKFODOITTZ9999999999999999999999999999999LLHDBWNOF999999999K99999999POWSRVIO9VMIJ99UMGMTTTPNNNV",
        };
        List<TransactionViewModel> transactions = persistAndMapTxs(trytes);
        final byte[] normalizedBundle = new byte[Curl.HASH_LENGTH / ISS.TRYTE_WIDTH];
        boolean valid = BundleValidator.validateBundleHash(transactions, normalizedBundle);
        assertTrue("the bundle hash should be valid", valid);
    }

    @Test
    public void validateBundleHashOfBundleWithInvalidBundleHash() {
        // tail transaction's bundle hash is invalid
        String[] trytes = {
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999GNXKWQPHMFCEZZCKUCCD9PROQVPCTBVVAPHCLVOPYYQLQRMPGTQXBVZLKGGT9NXHUAASFIAVEOZTBSM9DA99999999999999999999999999RENGLE9BEAT9999999999999999FDKW9AD99999999999B99999999RJPQGE9AXNBBLPQ9IFJXFJTXJAIGDDXAWXGAVU9PJQNYFADJDIDBTJKSAEBBX9NWJGZVAVXYWXPCEFFH9DKZYSMJAQRLXZHCNPTJPJLOONNDZHGNTBIINGYKZQAAWF9LWQTHUQSAXMLQN9DKCQWHIJXNGLGQVA9999XIFVJWCABR9XQKOWCXJAZDZWMWWBVHROBOPISAWDIJTSFPVAUZNJUMNUCOFIBIAAVIOWDTCNIPRVA9999TANGLE9BEAT9999999999999999SVIDBWNOF999999999K99999999POWSRVIO9VMIJ99UGNETMNPNNNE",
                "YU9WINMHSBIJ9HRBKDEHZYOCDGOZ9HZSSVXAYYOD9AMAFBCROMLSFDFIAQKEXAVFDLJYVABRSONSTTXLCQJTSDRFDEXZIORLRSQDZQODNCHAAFUPGBCEVYNRSJQGUZRAQIIEZPFQGWPQIBMDVNZGQAKCU9VLHGYSNDPHCMOCTRYQOYHFPRQSGHSDEF9MSHGXYGUTHSBSF9SOSJQFOZXMQGCUXAYWLBJHXOHTOM9ITZPISEXLAYAZBHTZDDCOIHKDBL9AAXZEDFHDYCPXLDGR9JTVXDXBC9DRDVREEEVGVPWVEZHJBYQYTGDEWQHVEDTAVLWW9WBXOIGDGUAAAVKFMPVKSYBVOIWPYGCMACEAAHGUIQVFLFMSCPKTYQWJDGMDNLMDIUUYI9SZOFQPLKKACESSWIXPFYZWDHETYUGEVASPHBGQPJPWVESSUUEVUYDYNQUQURSMCEPKIHYXNFHZSHIIDTMEZQ9IPSHTBDK9UHRSIIEJRILBCMVUMGAGBMHKEMUUKQDCYAVIAN9MBWJCAUSSJRSAUEUBGEFFCFSOBVGLXBAIDOH9NXWQUSIFUINEVZUWELLVIOSSQRVHMTDBCATBWFSDJJDLURAUKEQEIRICSCXAOJNPWHQKYVTRLCRKHLFHHHPYSMUEAPMQPMPS9CHCIYXEYRNIOOGRWKVHUGIWJZIGPWGZGBGYTVC9UVEJ9JBIYMDHYXLWIDXHZVFCCPLYXDPQPJGMKNZMMONGNXSNNPCGEGRJTMCPTJONGPAEDMSHMGAPGBDWVCSCTJAECSHTEGBMVCDZMQYZ9IHERWGCKAIMFOJRAEDRDSWJASV9XYS9CTOEETPQHRKJZ9FPWTVCGLEJQJXVVDTYZ9DNSHQAINKROQQIPTFGTABEELYPBQHGNNB9NCL9BVTG9MH99BPIRNNGC9MQQRH9YUDYSUJIDSZKCIGEKFSJ9PXUYKVPUZYFIREUAMUZE9EIMJK9YGAZXZBPRXIRDCEVDHWOCFIJTVRCRZRRJGFLILKVNMJAX9MUMTXCWTUTP9NXBZUMAYYY9DNVZTCROBCMMHVKSQRXMGROCMMCDENWQWBV9LEIJONWTQXOUQZOTGEJHJELYZOPICLDWPHVCMBFSYHPIJYZQDEGYITVPYNQMXPRTPKADLUKW9AEMSMGIWCUMOQMUDN9HZGYKTNVVNLOQAFVETEDJMJVKYCE9RE9AJP9RMYFKGDEC9GIGAFXEXIYXPFBOMRPULVJMYTQEPDMMIABDHJGRNNCKADZAUFV9WCWFYFHXLCED9E9SKKYHVKDTGNCHEKFJL9YJHTSRUVKEPHPCQSFNBXKOJNGBSEOZLVVGNUQTRACVGEKDSORUHVSDSQNUZASWXRADGAUDYDPODDEDNDDT9OAEARSBLPVSYAOEYYZJIZIZDENQOKMXATCTD9NEFVQWNCET9N9IXWCCWHYUBDTDJUZFXWMATRYSGJUQAFKAPIQIIXVFFEFNLGDPAIGKONUWLUTQTKZJYDEGPASTOMM9QTGOMYHFUKMNEVWPCMTLPDSOEEWDBRHZPZJIFMBUTY9QPRLPSVURIRMCWLH9YIZBOTJQMMF9ZP9VCCEGWVKSSQNANP9ZXVCAFGAVBXDJHUMKTKUBZRNKUGJTVUPDZMUK9KZI9EKY9DQDUNA9ZVPCROKYYPISSTDOJZJXMXZWSGZBEPKAUYPBPUTDVQKUYXWYTZXLYTCLLKLJUUJGFFCMZFKDTJET9KEDRMWZSAEFCSXLMRHRLG9EKLRZJ9NZQEONGFQSKSQMWRZXWVEGHCF9ZKGQITDLGFTZLCQMXVGVYIPKSUPPAOIKVWARJHAEJUZOOJFCFJTGQZWROSCEQSITQWZTQDFKECATBWSIRDFVWH9TXXUVEBRRKOTFSGBMGCMZDK9BJRVEUYOVNSLZNNSTWOB9CFNDJHJENDWSTIMMSWD9HSA9LDGTJDJFRGQCWOHYJNMFFLLDMVQEMCMNVQWMOGCEZUTK9MPULTDMKTIVFNVWXDNTRHNREHEDWIZCCRFVM9TXCTLBLYEKTRVVWHKZDOSYOBNLEKPNXMDZGLSVBBNBJIBZYBXZCENKVIXMNGUJUYFGFYFBKELSBZROQWKMESZTWDEEUCSXOWFSNJUGGJANMJFCBJV9GMDDJCAJHWKYQFJLFWZESTSIRBZQWYHGQDFUUWF9F9HXSBZRKBDLRWXSMKW99KPWJOQYPMHB9KWALSVLFNANYSMNWSJLUOCBKAWAJHNWMLPLXHVEPTKBPWLWHMDZ99999999999999999999999999999999999999999999999999999FDKW9AD99A99999999B99999999AAAAAAAAAAAAAPQ9IFJXFJTXJAIGDDXAWXGAVU9PJQNYFADJDIDBTJKSAEBBX9NWJGZVAVXYWXPCEFFH99XJLIVAZYJGPKEHANESX9DORLEIOIFL9WVQBBNUDRZDGJMVSRTSFKOJPIMEXPBCPGKUUEKRGAXOB99999XIFVJWCABR9XQKOWCXJAZDZWMWWBVHROBOPISAWDIJTSFPVAUZNJUMNUCOFIBIAAVIOWDTCNIPRVA9999999999999999999999999999999RSIDBWNOF999999999K99999999POWSRVIO9VMIJ99FKKNKGPNNNNP",
                "COSNPEACSPESTKTUS9CSMOCWVUBLERQJQGLLA9AYRRXMOVOBULQZZZJPLNELEX9EVZDAFOHBB9FBAYOTDB9YGJAVTDWNPJVVGEPFJ9QBYLXAYZEETY9GMYQRIRAIPWMJUFMFRSQRCEIOWISMBJKGCIGIIYNMXAYLXZIBNKANT9DSQXPBUPWGUJTOMD9JKSNFZJJFBZYBWRWQIZFOZXQWNJTRZTUPHVEGTAOLMBEPXOB9TCEBNIWXQUHNQJZHAOWGVOOOTSCTEUEMXJUODZP9CDLCMEXAW9YJGVNREENETEYXOAKZVRJVUSCRUSRCNZUGUOLCNHQITWYPJVJGPVULASTONDZRDVCNGJSN9DMMUORCOIBTITSPBXSAVTOHSAXHMGH99APRTQIVCEI9NWYKDOZCCWBNZGGCUCISSMGJHJ9OVSFBZVFMBODKRKSLIDESGFDQITCYFARWYTLFKSPLNVQ9LTYFODCHBAJKCWVZNBLOJH9ABFGDFOXHDNHZILINMYMVZYWTFJJOLADPTZRPJEMGPFQNYTFDGOKMDTDSKPTHIDWLMRSSACZMTHUCWVZHCYSPJRATABZ9JHWEBGTTQORGFOYDWUIYFYGOGGTYGYYI9RPKPMCTYNYKHHNWQKJTDQDHTRUYQPMCDDLVUUHUBPWGPMNQYPKHDHGIUSXJGNUXIYGZRGVYPTTV9KXJDLGVVXRIWIGKZJVCQ9DUWAYNDRKYCGKZDEOKZQCXELSQXLGLAPBDIWRTKGSIRNAZ9XFEGMWOWLPUA9TSGYRDOU9GKY9JJDKCJKKGJCRARGSNECJ9SEVAGPPJMBTMGNWSLNSFBOEYMIQBKOVSCTDIWCOQTHBVTZOFNNIYKKJLAROKIRFFPCLSOWO9BVNNJSXEYLJASPUEFKCEI9SGWADNGS9MZAKFTCAYNRVKGDIGYDTPGJXWFAEFGG9BX9XCNBZGQULH9IPPIQ9VFVAXGELUMCTE9TOFOGCTFYBYEBFOKKAESIIHEWLYLQKWDHPYNELJKMZHDSDSK9ZWFP99FQFLUXGTSVDMGHIFZFUCYTYPVEFEDM9TOHCQVIBXARYWZEKTWEOVSBYZTJZRUFZJCLRBTOWPTKY99CYQTGPMAKFYALIWPEQLUB9RGANTKDDMSDSJOTNPFZCXKJUGTJWWPK9FAJGPJOEBRHL9ZU9XRBDJBVMFIZIZFGKETH9RJUSDIOWDZIXFOJLT9DSIAWSCEYBNOGOAZQPZKVZTBXGACCBVQGFNGXNQFTVPUGUOHNBKTUERLSTDXGRKZSATIRHDBSXARYATBHOLUHCQGPRMQGSJUAXUCWKDXAUGORHFVVVDZQEYYGSV9IUM9VTMHJCIKBQD9TQLLYTZHAKDHPFGYMRGJOEDJKQTBBNFCKDEPYTPWUJEOPRJWHAILMVW9AXS9HAT9GCGRXZEHWNDOVGKGPWFXFC9IKLVZJCTGZUJFRHGL9FZWZYP9TPOWGOUTQ9INYBVTD9N9OV9AM9GYRJ99MRWRWLOAKJXMDTFNS9NZQAYGVZRJ9WVSIDRRQLGKH9VPUVKFWZMSRVVLKXUGJAZESC9LEYDNNDWS9WTWNFPCR9YKPOMIJAVHCRCJVBDFWSTDN9BPJRDMGZFXWTY9GUX9WEPJQMXSECFPREXAJ9DU9OLMNQFTF99QYZOGDUTMBHMNMCNUQTU9FTNEUNBT9NQO9YADGY9C9LQR9DYVJZE9GMMYAOUSWUIVJ9EAR9EEFCO9SZTQ9JQHPIJGXIOQZHOSUSVMHBOLTYSEONVLRISNAN9KJHHFFISTYIHYVAMXLPNALDELETXVSWGUWOIVKNAKZKNNRVNJKE9WMNQBXFGXSYZQQSIODAKINA9CPBOGAYKJ9V9GS9HERXSVYPEILYXC9GURBREBCXRZJVXHUOPGYFLPIFBCOTMHFTAAUQUZVEKOWYFFGSCXDFDBTSGZRMPQR9EYSZYGQETCWFDRXVOXXCUBOQTBQGVLAONSTSLURFYSDPAVNCXNWVPQOUORMVSLYISQUQKXFYYMJSGHQP9VAAZABEAGJMCPIEBZQSYCPS9CNKFBDRDTDA9C9MVKGUISRX9ODVUJNPDWMZ9ESYXJ99ETDGSTJZMZYJEGRUWTORMCLNHLDQ9YIJWPMDYGGJQHMFPJ9VKINJUESTCBJQXFTCJFNUXPZONVKXJRAYGKIWHXSBZRKBDLRWXSMKW99KPWJOQYPMHB9KWALSVLFNANYSMNWSJLUOCBKAWAJHNWMLPLXHVEPTKBPWLWHMD999999999999999999999999999999999999999999999999999999FDKW9AD99B99999999B99999999RJPQGE9AXNBBLPQ9IFJXFJTXJAIGDDXAWXGAVU9PJQNYFADJDIDBTJKSAEBBX9NWJGZVAVXYWXPCEFFH9XIFVJWCABR9XQKOWCXJAZDZWMWWBVHROBOPISAWDIJTSFPVAUZNJUMNUCOFIBIAAVIOWDTCNIPRVA9999FTXZAEQIKGFJABOGCCQGOMKNASGWCQWMNIMRDTHKPJMTKDGMEQNZOAYARIYEWFZYJALRKFODOITTZ9999999999999999999999999999999LLHDBWNOF999999999K99999999POWSRVIO9VMIJ99UMGMTTTPNNNV",
        };
        List<TransactionViewModel> transactions = persistAndMapTxs(trytes);
        final byte[] normalizedBundle = new byte[Curl.HASH_LENGTH / ISS.TRYTE_WIDTH];
        boolean valid = BundleValidator.validateBundleHash(transactions, normalizedBundle);
        assertFalse("the bundle hash should be invalid", valid);
    }

    @Test
    public void validateSignaturesOfValidBundle() {
        String[] trytes = {
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999GNXKWQPHMFCEZZCKUCCD9PROQVPCTBVVAPHCLVOPYYQLQRMPGTQXBVZLKGGT9NXHUAASFIAVEOZTBSM9DA99999999999999999999999999RENGLE9BEAT9999999999999999FDKW9AD99999999999B99999999RJPQGE9AXNBBLPQ9IFJXFJTXJAIGDDXAWXGAVU9PJQNYFADJDIDBTJKSAEBBX9NWJGZVAVXYWXPCEFFH9DKZYSMJAQRLXZHCNPTJPJLOONNDZHGNTBIINGYKZQAAWF9LWQTHUQSAXMLQN9DKCQWHIJXNGLGQVA9999XIFVJWCABR9XQKOWCXJAZDZWMWWBVHROBOPISAWDIJTSFPVAUZNJUMNUCOFIBIAAVIOWDTCNIPRVA9999TANGLE9BEAT9999999999999999SVIDBWNOF999999999K99999999POWSRVIO9VMIJ99UGNETMNPNNNE",
                "YU9WINMHSBIJ9HRBKDEHZYOCDGOZ9HZSSVXAYYOD9AMAFBCROMLSFDFIAQKEXAVFDLJYVABRSONSTTXLCQJTSDRFDEXZIORLRSQDZQODNCHAAFUPGBCEVYNRSJQGUZRAQIIEZPFQGWPQIBMDVNZGQAKCU9VLHGYSNDPHCMOCTRYQOYHFPRQSGHSDEF9MSHGXYGUTHSBSF9SOSJQFOZXMQGCUXAYWLBJHXOHTOM9ITZPISEXLAYAZBHTZDDCOIHKDBL9AAXZEDFHDYCPXLDGR9JTVXDXBC9DRDVREEEVGVPWVEZHJBYQYTGDEWQHVEDTAVLWW9WBXOIGDGUAAAVKFMPVKSYBVOIWPYGCMACEAAHGUIQVFLFMSCPKTYQWJDGMDNLMDIUUYI9SZOFQPLKKACESSWIXPFYZWDHETYUGEVASPHBGQPJPWVESSUUEVUYDYNQUQURSMCEPKIHYXNFHZSHIIDTMEZQ9IPSHTBDK9UHRSIIEJRILBCMVUMGAGBMHKEMUUKQDCYAVIAN9MBWJCAUSSJRSAUEUBGEFFCFSOBVGLXBAIDOH9NXWQUSIFUINEVZUWELLVIOSSQRVHMTDBCATBWFSDJJDLURAUKEQEIRICSCXAOJNPWHQKYVTRLCRKHLFHHHPYSMUEAPMQPMPS9CHCIYXEYRNIOOGRWKVHUGIWJZIGPWGZGBGYTVC9UVEJ9JBIYMDHYXLWIDXHZVFCCPLYXDPQPJGMKNZMMONGNXSNNPCGEGRJTMCPTJONGPAEDMSHMGAPGBDWVCSCTJAECSHTEGBMVCDZMQYZ9IHERWGCKAIMFOJRAEDRDSWJASV9XYS9CTOEETPQHRKJZ9FPWTVCGLEJQJXVVDTYZ9DNSHQAINKROQQIPTFGTABEELYPBQHGNNB9NCL9BVTG9MH99BPIRNNGC9MQQRH9YUDYSUJIDSZKCIGEKFSJ9PXUYKVPUZYFIREUAMUZE9EIMJK9YGAZXZBPRXIRDCEVDHWOCFIJTVRCRZRRJGFLILKVNMJAX9MUMTXCWTUTP9NXBZUMAYYY9DNVZTCROBCMMHVKSQRXMGROCMMCDENWQWBV9LEIJONWTQXOUQZOTGEJHJELYZOPICLDWPHVCMBFSYHPIJYZQDEGYITVPYNQMXPRTPKADLUKW9AEMSMGIWCUMOQMUDN9HZGYKTNVVNLOQAFVETEDJMJVKYCE9RE9AJP9RMYFKGDEC9GIGAFXEXIYXPFBOMRPULVJMYTQEPDMMIABDHJGRNNCKADZAUFV9WCWFYFHXLCED9E9SKKYHVKDTGNCHEKFJL9YJHTSRUVKEPHPCQSFNBXKOJNGBSEOZLVVGNUQTRACVGEKDSORUHVSDSQNUZASWXRADGAUDYDPODDEDNDDT9OAEARSBLPVSYAOEYYZJIZIZDENQOKMXATCTD9NEFVQWNCET9N9IXWCCWHYUBDTDJUZFXWMATRYSGJUQAFKAPIQIIXVFFEFNLGDPAIGKONUWLUTQTKZJYDEGPASTOMM9QTGOMYHFUKMNEVWPCMTLPDSOEEWDBRHZPZJIFMBUTY9QPRLPSVURIRMCWLH9YIZBOTJQMMF9ZP9VCCEGWVKSSQNANP9ZXVCAFGAVBXDJHUMKTKUBZRNKUGJTVUPDZMUK9KZI9EKY9DQDUNA9ZVPCROKYYPISSTDOJZJXMXZWSGZBEPKAUYPBPUTDVQKUYXWYTZXLYTCLLKLJUUJGFFCMZFKDTJET9KEDRMWZSAEFCSXLMRHRLG9EKLRZJ9NZQEONGFQSKSQMWRZXWVEGHCF9ZKGQITDLGFTZLCQMXVGVYIPKSUPPAOIKVWARJHAEJUZOOJFCFJTGQZWROSCEQSITQWZTQDFKECATBWSIRDFVWH9TXXUVEBRRKOTFSGBMGCMZDK9BJRVEUYOVNSLZNNSTWOB9CFNDJHJENDWSTIMMSWD9HSA9LDGTJDJFRGQCWOHYJNMFFLLDMVQEMCMNVQWMOGCEZUTK9MPULTDMKTIVFNVWXDNTRHNREHEDWIZCCRFVM9TXCTLBLYEKTRVVWHKZDOSYOBNLEKPNXMDZGLSVBBNBJIBZYBXZCENKVIXMNGUJUYFGFYFBKELSBZROQWKMESZTWDEEUCSXOWFSNJUGGJANMJFCBJV9GMDDJCAJHWKYQFJLFWZESTSIRBZQWYHGQDFUUWF9F9HXSBZRKBDLRWXSMKW99KPWJOQYPMHB9KWALSVLFNANYSMNWSJLUOCBKAWAJHNWMLPLXHVEPTKBPWLWHMDZ99999999999999999999999999999999999999999999999999999FDKW9AD99A99999999B99999999RJPQGE9AXNBBLPQ9IFJXFJTXJAIGDDXAWXGAVU9PJQNYFADJDIDBTJKSAEBBX9NWJGZVAVXYWXPCEFFH99XJLIVAZYJGPKEHANESX9DORLEIOIFL9WVQBBNUDRZDGJMVSRTSFKOJPIMEXPBCPGKUUEKRGAXOB99999XIFVJWCABR9XQKOWCXJAZDZWMWWBVHROBOPISAWDIJTSFPVAUZNJUMNUCOFIBIAAVIOWDTCNIPRVA9999999999999999999999999999999RSIDBWNOF999999999K99999999POWSRVIO9VMIJ99FKKNKGPNNNNP",
                "COSNPEACSPESTKTUS9CSMOCWVUBLERQJQGLLA9AYRRXMOVOBULQZZZJPLNELEX9EVZDAFOHBB9FBAYOTDB9YGJAVTDWNPJVVGEPFJ9QBYLXAYZEETY9GMYQRIRAIPWMJUFMFRSQRCEIOWISMBJKGCIGIIYNMXAYLXZIBNKANT9DSQXPBUPWGUJTOMD9JKSNFZJJFBZYBWRWQIZFOZXQWNJTRZTUPHVEGTAOLMBEPXOB9TCEBNIWXQUHNQJZHAOWGVOOOTSCTEUEMXJUODZP9CDLCMEXAW9YJGVNREENETEYXOAKZVRJVUSCRUSRCNZUGUOLCNHQITWYPJVJGPVULASTONDZRDVCNGJSN9DMMUORCOIBTITSPBXSAVTOHSAXHMGH99APRTQIVCEI9NWYKDOZCCWBNZGGCUCISSMGJHJ9OVSFBZVFMBODKRKSLIDESGFDQITCYFARWYTLFKSPLNVQ9LTYFODCHBAJKCWVZNBLOJH9ABFGDFOXHDNHZILINMYMVZYWTFJJOLADPTZRPJEMGPFQNYTFDGOKMDTDSKPTHIDWLMRSSACZMTHUCWVZHCYSPJRATABZ9JHWEBGTTQORGFOYDWUIYFYGOGGTYGYYI9RPKPMCTYNYKHHNWQKJTDQDHTRUYQPMCDDLVUUHUBPWGPMNQYPKHDHGIUSXJGNUXIYGZRGVYPTTV9KXJDLGVVXRIWIGKZJVCQ9DUWAYNDRKYCGKZDEOKZQCXELSQXLGLAPBDIWRTKGSIRNAZ9XFEGMWOWLPUA9TSGYRDOU9GKY9JJDKCJKKGJCRARGSNECJ9SEVAGPPJMBTMGNWSLNSFBOEYMIQBKOVSCTDIWCOQTHBVTZOFNNIYKKJLAROKIRFFPCLSOWO9BVNNJSXEYLJASPUEFKCEI9SGWADNGS9MZAKFTCAYNRVKGDIGYDTPGJXWFAEFGG9BX9XCNBZGQULH9IPPIQ9VFVAXGELUMCTE9TOFOGCTFYBYEBFOKKAESIIHEWLYLQKWDHPYNELJKMZHDSDSK9ZWFP99FQFLUXGTSVDMGHIFZFUCYTYPVEFEDM9TOHCQVIBXARYWZEKTWEOVSBYZTJZRUFZJCLRBTOWPTKY99CYQTGPMAKFYALIWPEQLUB9RGANTKDDMSDSJOTNPFZCXKJUGTJWWPK9FAJGPJOEBRHL9ZU9XRBDJBVMFIZIZFGKETH9RJUSDIOWDZIXFOJLT9DSIAWSCEYBNOGOAZQPZKVZTBXGACCBVQGFNGXNQFTVPUGUOHNBKTUERLSTDXGRKZSATIRHDBSXARYATBHOLUHCQGPRMQGSJUAXUCWKDXAUGORHFVVVDZQEYYGSV9IUM9VTMHJCIKBQD9TQLLYTZHAKDHPFGYMRGJOEDJKQTBBNFCKDEPYTPWUJEOPRJWHAILMVW9AXS9HAT9GCGRXZEHWNDOVGKGPWFXFC9IKLVZJCTGZUJFRHGL9FZWZYP9TPOWGOUTQ9INYBVTD9N9OV9AM9GYRJ99MRWRWLOAKJXMDTFNS9NZQAYGVZRJ9WVSIDRRQLGKH9VPUVKFWZMSRVVLKXUGJAZESC9LEYDNNDWS9WTWNFPCR9YKPOMIJAVHCRCJVBDFWSTDN9BPJRDMGZFXWTY9GUX9WEPJQMXSECFPREXAJ9DU9OLMNQFTF99QYZOGDUTMBHMNMCNUQTU9FTNEUNBT9NQO9YADGY9C9LQR9DYVJZE9GMMYAOUSWUIVJ9EAR9EEFCO9SZTQ9JQHPIJGXIOQZHOSUSVMHBOLTYSEONVLRISNAN9KJHHFFISTYIHYVAMXLPNALDELETXVSWGUWOIVKNAKZKNNRVNJKE9WMNQBXFGXSYZQQSIODAKINA9CPBOGAYKJ9V9GS9HERXSVYPEILYXC9GURBREBCXRZJVXHUOPGYFLPIFBCOTMHFTAAUQUZVEKOWYFFGSCXDFDBTSGZRMPQR9EYSZYGQETCWFDRXVOXXCUBOQTBQGVLAONSTSLURFYSDPAVNCXNWVPQOUORMVSLYISQUQKXFYYMJSGHQP9VAAZABEAGJMCPIEBZQSYCPS9CNKFBDRDTDA9C9MVKGUISRX9ODVUJNPDWMZ9ESYXJ99ETDGSTJZMZYJEGRUWTORMCLNHLDQ9YIJWPMDYGGJQHMFPJ9VKINJUESTCBJQXFTCJFNUXPZONVKXJRAYGKIWHXSBZRKBDLRWXSMKW99KPWJOQYPMHB9KWALSVLFNANYSMNWSJLUOCBKAWAJHNWMLPLXHVEPTKBPWLWHMD999999999999999999999999999999999999999999999999999999FDKW9AD99B99999999B99999999RJPQGE9AXNBBLPQ9IFJXFJTXJAIGDDXAWXGAVU9PJQNYFADJDIDBTJKSAEBBX9NWJGZVAVXYWXPCEFFH9XIFVJWCABR9XQKOWCXJAZDZWMWWBVHROBOPISAWDIJTSFPVAUZNJUMNUCOFIBIAAVIOWDTCNIPRVA9999FTXZAEQIKGFJABOGCCQGOMKNASGWCQWMNIMRDTHKPJMTKDGMEQNZOAYARIYEWFZYJALRKFODOITTZ9999999999999999999999999999999LLHDBWNOF999999999K99999999POWSRVIO9VMIJ99UMGMTTTPNNNV",
        };
        List<TransactionViewModel> transactions = persistAndMapTxs(trytes);
        final byte[] normalizedBundle = new byte[Curl.HASH_LENGTH / ISS.TRYTE_WIDTH];
        BundleValidator.validateBundleHash(transactions, normalizedBundle);
        boolean valid = BundleValidator.validateSignatures(transactions, normalizedBundle);
        assertTrue("the signatures should be valid", valid);
    }

    @Test
    public void validateSignaturesOfBundleWithInvalidSignatures() {
        String[] trytes = {
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999GNXKWQPHMFCEZZCKUCCD9PROQVPCTBVVAPHCLVOPYYQLQRMPGTQXBVZLKGGT9NXHUAASFIAVEOZTBSM9DA99999999999999999999999999RENGLE9BEAT9999999999999999FDKW9AD99999999999B99999999RJPQGE9AXNBBLPQ9IFJXFJTXJAIGDDXAWXGAVU9PJQNYFADJDIDBTJKSAEBBX9NWJGZVAVXYWXPCEFFH9DKZYSMJAQRLXZHCNPTJPJLOONNDZHGNTBIINGYKZQAAWF9LWQTHUQSAXMLQN9DKCQWHIJXNGLGQVA9999XIFVJWCABR9XQKOWCXJAZDZWMWWBVHROBOPISAWDIJTSFPVAUZNJUMNUCOFIBIAAVIOWDTCNIPRVA9999TANGLE9BEAT9999999999999999SVIDBWNOF999999999K99999999POWSRVIO9VMIJ99UGNETMNPNNNE",
                "AAAAAAAABIJ9HRBKDEHZYOCDGOZ9HZSSVXAYYOD9AMAFBCROMLSFDFIAQKEXAVFDLJYVABRSONSTTXLCQJTSDRFDEXZIORLRSQDZQODNCHAAFUPGBCEVYNRSJQGUZRAQIIEZPFQGWPQIBMDVNZGQAKCU9VLHGYSNDPHCMOCTRYQOYHFPRQSGHSDEF9MSHGXYGUTHSBSF9SOSJQFOZXMQGCUXAYWLBJHXOHTOM9ITZPISEXLAYAZBHTZDDCOIHKDBL9AAXZEDFHDYCPXLDGR9JTVXDXBC9DRDVREEEVGVPWVEZHJBYQYTGDEWQHVEDTAVLWW9WBXOIGDGUAAAVKFMPVKSYBVOIWPYGCMACEAAHGUIQVFLFMSCPKTYQWJDGMDNLMDIUUYI9SZOFQPLKKACESSWIXPFYZWDHETYUGEVASPHBGQPJPWVESSUUEVUYDYNQUQURSMCEPKIHYXNFHZSHIIDTMEZQ9IPSHTBDK9UHRSIIEJRILBCMVUMGAGBMHKEMUUKQDCYAVIAN9MBWJCAUSSJRSAUEUBGEFFCFSOBVGLXBAIDOH9NXWQUSIFUINEVZUWELLVIOSSQRVHMTDBCATBWFSDJJDLURAUKEQEIRICSCXAOJNPWHQKYVTRLCRKHLFHHHPYSMUEAPMQPMPS9CHCIYXEYRNIOOGRWKVHUGIWJZIGPWGZGBGYTVC9UVEJ9JBIYMDHYXLWIDXHZVFCCPLYXDPQPJGMKNZMMONGNXSNNPCGEGRJTMCPTJONGPAEDMSHMGAPGBDWVCSCTJAECSHTEGBMVCDZMQYZ9IHERWGCKAIMFOJRAEDRDSWJASV9XYS9CTOEETPQHRKJZ9FPWTVCGLEJQJXVVDTYZ9DNSHQAINKROQQIPTFGTABEELYPBQHGNNB9NCL9BVTG9MH99BPIRNNGC9MQQRH9YUDYSUJIDSZKCIGEKFSJ9PXUYKVPUZYFIREUAMUZE9EIMJK9YGAZXZBPRXIRDCEVDHWOCFIJTVRCRZRRJGFLILKVNMJAX9MUMTXCWTUTP9NXBZUMAYYY9DNVZTCROBCMMHVKSQRXMGROCMMCDENWQWBV9LEIJONWTQXOUQZOTGEJHJELYZOPICLDWPHVCMBFSYHPIJYZQDEGYITVPYNQMXPRTPKADLUKW9AEMSMGIWCUMOQMUDN9HZGYKTNVVNLOQAFVETEDJMJVKYCE9RE9AJP9RMYFKGDEC9GIGAFXEXIYXPFBOMRPULVJMYTQEPDMMIABDHJGRNNCKADZAUFV9WCWFYFHXLCED9E9SKKYHVKDTGNCHEKFJL9YJHTSRUVKEPHPCQSFNBXKOJNGBSEOZLVVGNUQTRACVGEKDSORUHVSDSQNUZASWXRADGAUDYDPODDEDNDDT9OAEARSBLPVSYAOEYYZJIZIZDENQOKMXATCTD9NEFVQWNCET9N9IXWCCWHYUBDTDJUZFXWMATRYSGJUQAFKAPIQIIXVFFEFNLGDPAIGKONUWLUTQTKZJYDEGPASTOMM9QTGOMYHFUKMNEVWPCMTLPDSOEEWDBRHZPZJIFMBUTY9QPRLPSVURIRMCWLH9YIZBOTJQMMF9ZP9VCCEGWVKSSQNANP9ZXVCAFGAVBXDJHUMKTKUBZRNKUGJTVUPDZMUK9KZI9EKY9DQDUNA9ZVPCROKYYPISSTDOJZJXMXZWSGZBEPKAUYPBPUTDVQKUYXWYTZXLYTCLLKLJUUJGFFCMZFKDTJET9KEDRMWZSAEFCSXLMRHRLG9EKLRZJ9NZQEONGFQSKSQMWRZXWVEGHCF9ZKGQITDLGFTZLCQMXVGVYIPKSUPPAOIKVWARJHAEJUZOOJFCFJTGQZWROSCEQSITQWZTQDFKECATBWSIRDFVWH9TXXUVEBRRKOTFSGBMGCMZDK9BJRVEUYOVNSLZNNSTWOB9CFNDJHJENDWSTIMMSWD9HSA9LDGTJDJFRGQCWOHYJNMFFLLDMVQEMCMNVQWMOGCEZUTK9MPULTDMKTIVFNVWXDNTRHNREHEDWIZCCRFVM9TXCTLBLYEKTRVVWHKZDOSYOBNLEKPNXMDZGLSVBBNBJIBZYBXZCENKVIXMNGUJUYFGFYFBKELSBZROQWKMESZTWDEEUCSXOWFSNJUGGJANMJFCBJV9GMDDJCAJHWKYQFJLFWZESTSIRBZQWYHGQDFUUWF9F9HXSBZRKBDLRWXSMKW99KPWJOQYPMHB9KWALSVLFNANYSMNWSJLUOCBKAWAJHNWMLPLXHVEPTKBPWLWHMDZ99999999999999999999999999999999999999999999999999999FDKW9AD99A99999999B99999999RJPQGE9AXNBBLPQ9IFJXFJTXJAIGDDXAWXGAVU9PJQNYFADJDIDBTJKSAEBBX9NWJGZVAVXYWXPCEFFH99XJLIVAZYJGPKEHANESX9DORLEIOIFL9WVQBBNUDRZDGJMVSRTSFKOJPIMEXPBCPGKUUEKRGAXOB99999XIFVJWCABR9XQKOWCXJAZDZWMWWBVHROBOPISAWDIJTSFPVAUZNJUMNUCOFIBIAAVIOWDTCNIPRVA9999999999999999999999999999999RSIDBWNOF999999999K99999999POWSRVIO9VMIJ99FKKNKGPNNNNP",
                "COSNPEACSPESTKTUS9CSMOCWVUBLERQJQGLLA9AYRRXMOVOBULQZZZJPLNELEX9EVZDAFOHBB9FBAYOTDB9YGJAVTDWNPJVVGEPFJ9QBYLXAYZEETY9GMYQRIRAIPWMJUFMFRSQRCEIOWISMBJKGCIGIIYNMXAYLXZIBNKANT9DSQXPBUPWGUJTOMD9JKSNFZJJFBZYBWRWQIZFOZXQWNJTRZTUPHVEGTAOLMBEPXOB9TCEBNIWXQUHNQJZHAOWGVOOOTSCTEUEMXJUODZP9CDLCMEXAW9YJGVNREENETEYXOAKZVRJVUSCRUSRCNZUGUOLCNHQITWYPJVJGPVULASTONDZRDVCNGJSN9DMMUORCOIBTITSPBXSAVTOHSAXHMGH99APRTQIVCEI9NWYKDOZCCWBNZGGCUCISSMGJHJ9OVSFBZVFMBODKRKSLIDESGFDQITCYFARWYTLFKSPLNVQ9LTYFODCHBAJKCWVZNBLOJH9ABFGDFOXHDNHZILINMYMVZYWTFJJOLADPTZRPJEMGPFQNYTFDGOKMDTDSKPTHIDWLMRSSACZMTHUCWVZHCYSPJRATABZ9JHWEBGTTQORGFOYDWUIYFYGOGGTYGYYI9RPKPMCTYNYKHHNWQKJTDQDHTRUYQPMCDDLVUUHUBPWGPMNQYPKHDHGIUSXJGNUXIYGZRGVYPTTV9KXJDLGVVXRIWIGKZJVCQ9DUWAYNDRKYCGKZDEOKZQCXELSQXLGLAPBDIWRTKGSIRNAZ9XFEGMWOWLPUA9TSGYRDOU9GKY9JJDKCJKKGJCRARGSNECJ9SEVAGPPJMBTMGNWSLNSFBOEYMIQBKOVSCTDIWCOQTHBVTZOFNNIYKKJLAROKIRFFPCLSOWO9BVNNJSXEYLJASPUEFKCEI9SGWADNGS9MZAKFTCAYNRVKGDIGYDTPGJXWFAEFGG9BX9XCNBZGQULH9IPPIQ9VFVAXGELUMCTE9TOFOGCTFYBYEBFOKKAESIIHEWLYLQKWDHPYNELJKMZHDSDSK9ZWFP99FQFLUXGTSVDMGHIFZFUCYTYPVEFEDM9TOHCQVIBXARYWZEKTWEOVSBYZTJZRUFZJCLRBTOWPTKY99CYQTGPMAKFYALIWPEQLUB9RGANTKDDMSDSJOTNPFZCXKJUGTJWWPK9FAJGPJOEBRHL9ZU9XRBDJBVMFIZIZFGKETH9RJUSDIOWDZIXFOJLT9DSIAWSCEYBNOGOAZQPZKVZTBXGACCBVQGFNGXNQFTVPUGUOHNBKTUERLSTDXGRKZSATIRHDBSXARYATBHOLUHCQGPRMQGSJUAXUCWKDXAUGORHFVVVDZQEYYGSV9IUM9VTMHJCIKBQD9TQLLYTZHAKDHPFGYMRGJOEDJKQTBBNFCKDEPYTPWUJEOPRJWHAILMVW9AXS9HAT9GCGRXZEHWNDOVGKGPWFXFC9IKLVZJCTGZUJFRHGL9FZWZYP9TPOWGOUTQ9INYBVTD9N9OV9AM9GYRJ99MRWRWLOAKJXMDTFNS9NZQAYGVZRJ9WVSIDRRQLGKH9VPUVKFWZMSRVVLKXUGJAZESC9LEYDNNDWS9WTWNFPCR9YKPOMIJAVHCRCJVBDFWSTDN9BPJRDMGZFXWTY9GUX9WEPJQMXSECFPREXAJ9DU9OLMNQFTF99QYZOGDUTMBHMNMCNUQTU9FTNEUNBT9NQO9YADGY9C9LQR9DYVJZE9GMMYAOUSWUIVJ9EAR9EEFCO9SZTQ9JQHPIJGXIOQZHOSUSVMHBOLTYSEONVLRISNAN9KJHHFFISTYIHYVAMXLPNALDELETXVSWGUWOIVKNAKZKNNRVNJKE9WMNQBXFGXSYZQQSIODAKINA9CPBOGAYKJ9V9GS9HERXSVYPEILYXC9GURBREBCXRZJVXHUOPGYFLPIFBCOTMHFTAAUQUZVEKOWYFFGSCXDFDBTSGZRMPQR9EYSZYGQETCWFDRXVOXXCUBOQTBQGVLAONSTSLURFYSDPAVNCXNWVPQOUORMVSLYISQUQKXFYYMJSGHQP9VAAZABEAGJMCPIEBZQSYCPS9CNKFBDRDTDA9C9MVKGUISRX9ODVUJNPDWMZ9ESYXJ99ETDGSTJZMZYJEGRUWTORMCLNHLDQ9YIJWPMDYGGJQHMFPJ9VKINJUESTCBJQXFTCJFNUXPZONVKXJRAYGKIWHXSBZRKBDLRWXSMKW99KPWJOQYPMHB9KWALSVLFNANYSMNWSJLUOCBKAWAJHNWMLPLXHVEPTKBPWLWHMD999999999999999999999999999999999999999999999999999999FDKW9AD99B99999999B99999999RJPQGE9AXNBBLPQ9IFJXFJTXJAIGDDXAWXGAVU9PJQNYFADJDIDBTJKSAEBBX9NWJGZVAVXYWXPCEFFH9XIFVJWCABR9XQKOWCXJAZDZWMWWBVHROBOPISAWDIJTSFPVAUZNJUMNUCOFIBIAAVIOWDTCNIPRVA9999FTXZAEQIKGFJABOGCCQGOMKNASGWCQWMNIMRDTHKPJMTKDGMEQNZOAYARIYEWFZYJALRKFODOITTZ9999999999999999999999999999999LLHDBWNOF999999999K99999999POWSRVIO9VMIJ99UMGMTTTPNNNV",
        };
        List<TransactionViewModel> transactions = persistAndMapTxs(trytes);
        final byte[] normalizedBundle = new byte[Curl.HASH_LENGTH / ISS.TRYTE_WIDTH];
        BundleValidator.validateBundleHash(transactions, normalizedBundle);
        boolean valid = BundleValidator.validateSignatures(transactions, normalizedBundle);
        assertTrue("the signatures should be invalid", valid);
    }

    @Test
    public void validationModeAll() {
        String[] trytes = {
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999GNXKWQPHMFCEZZCKUCCD9PROQVPCTBVVAPHCLVOPYYQLQRMPGTQXBVZLKGGT9NXHUAASFIAVEOZTBSM9DA99999999999999999999999999RENGLE9BEAT9999999999999999FDKW9AD99999999999B99999999RJPQGE9AXNBBLPQ9IFJXFJTXJAIGDDXAWXGAVU9PJQNYFADJDIDBTJKSAEBBX9NWJGZVAVXYWXPCEFFH9DKZYSMJAQRLXZHCNPTJPJLOONNDZHGNTBIINGYKZQAAWF9LWQTHUQSAXMLQN9DKCQWHIJXNGLGQVA9999XIFVJWCABR9XQKOWCXJAZDZWMWWBVHROBOPISAWDIJTSFPVAUZNJUMNUCOFIBIAAVIOWDTCNIPRVA9999TANGLE9BEAT9999999999999999SVIDBWNOF999999999K99999999POWSRVIO9VMIJ99UGNETMNPNNNE",
                "YU9WINMHSBIJ9HRBKDEHZYOCDGOZ9HZSSVXAYYOD9AMAFBCROMLSFDFIAQKEXAVFDLJYVABRSONSTTXLCQJTSDRFDEXZIORLRSQDZQODNCHAAFUPGBCEVYNRSJQGUZRAQIIEZPFQGWPQIBMDVNZGQAKCU9VLHGYSNDPHCMOCTRYQOYHFPRQSGHSDEF9MSHGXYGUTHSBSF9SOSJQFOZXMQGCUXAYWLBJHXOHTOM9ITZPISEXLAYAZBHTZDDCOIHKDBL9AAXZEDFHDYCPXLDGR9JTVXDXBC9DRDVREEEVGVPWVEZHJBYQYTGDEWQHVEDTAVLWW9WBXOIGDGUAAAVKFMPVKSYBVOIWPYGCMACEAAHGUIQVFLFMSCPKTYQWJDGMDNLMDIUUYI9SZOFQPLKKACESSWIXPFYZWDHETYUGEVASPHBGQPJPWVESSUUEVUYDYNQUQURSMCEPKIHYXNFHZSHIIDTMEZQ9IPSHTBDK9UHRSIIEJRILBCMVUMGAGBMHKEMUUKQDCYAVIAN9MBWJCAUSSJRSAUEUBGEFFCFSOBVGLXBAIDOH9NXWQUSIFUINEVZUWELLVIOSSQRVHMTDBCATBWFSDJJDLURAUKEQEIRICSCXAOJNPWHQKYVTRLCRKHLFHHHPYSMUEAPMQPMPS9CHCIYXEYRNIOOGRWKVHUGIWJZIGPWGZGBGYTVC9UVEJ9JBIYMDHYXLWIDXHZVFCCPLYXDPQPJGMKNZMMONGNXSNNPCGEGRJTMCPTJONGPAEDMSHMGAPGBDWVCSCTJAECSHTEGBMVCDZMQYZ9IHERWGCKAIMFOJRAEDRDSWJASV9XYS9CTOEETPQHRKJZ9FPWTVCGLEJQJXVVDTYZ9DNSHQAINKROQQIPTFGTABEELYPBQHGNNB9NCL9BVTG9MH99BPIRNNGC9MQQRH9YUDYSUJIDSZKCIGEKFSJ9PXUYKVPUZYFIREUAMUZE9EIMJK9YGAZXZBPRXIRDCEVDHWOCFIJTVRCRZRRJGFLILKVNMJAX9MUMTXCWTUTP9NXBZUMAYYY9DNVZTCROBCMMHVKSQRXMGROCMMCDENWQWBV9LEIJONWTQXOUQZOTGEJHJELYZOPICLDWPHVCMBFSYHPIJYZQDEGYITVPYNQMXPRTPKADLUKW9AEMSMGIWCUMOQMUDN9HZGYKTNVVNLOQAFVETEDJMJVKYCE9RE9AJP9RMYFKGDEC9GIGAFXEXIYXPFBOMRPULVJMYTQEPDMMIABDHJGRNNCKADZAUFV9WCWFYFHXLCED9E9SKKYHVKDTGNCHEKFJL9YJHTSRUVKEPHPCQSFNBXKOJNGBSEOZLVVGNUQTRACVGEKDSORUHVSDSQNUZASWXRADGAUDYDPODDEDNDDT9OAEARSBLPVSYAOEYYZJIZIZDENQOKMXATCTD9NEFVQWNCET9N9IXWCCWHYUBDTDJUZFXWMATRYSGJUQAFKAPIQIIXVFFEFNLGDPAIGKONUWLUTQTKZJYDEGPASTOMM9QTGOMYHFUKMNEVWPCMTLPDSOEEWDBRHZPZJIFMBUTY9QPRLPSVURIRMCWLH9YIZBOTJQMMF9ZP9VCCEGWVKSSQNANP9ZXVCAFGAVBXDJHUMKTKUBZRNKUGJTVUPDZMUK9KZI9EKY9DQDUNA9ZVPCROKYYPISSTDOJZJXMXZWSGZBEPKAUYPBPUTDVQKUYXWYTZXLYTCLLKLJUUJGFFCMZFKDTJET9KEDRMWZSAEFCSXLMRHRLG9EKLRZJ9NZQEONGFQSKSQMWRZXWVEGHCF9ZKGQITDLGFTZLCQMXVGVYIPKSUPPAOIKVWARJHAEJUZOOJFCFJTGQZWROSCEQSITQWZTQDFKECATBWSIRDFVWH9TXXUVEBRRKOTFSGBMGCMZDK9BJRVEUYOVNSLZNNSTWOB9CFNDJHJENDWSTIMMSWD9HSA9LDGTJDJFRGQCWOHYJNMFFLLDMVQEMCMNVQWMOGCEZUTK9MPULTDMKTIVFNVWXDNTRHNREHEDWIZCCRFVM9TXCTLBLYEKTRVVWHKZDOSYOBNLEKPNXMDZGLSVBBNBJIBZYBXZCENKVIXMNGUJUYFGFYFBKELSBZROQWKMESZTWDEEUCSXOWFSNJUGGJANMJFCBJV9GMDDJCAJHWKYQFJLFWZESTSIRBZQWYHGQDFUUWF9F9HXSBZRKBDLRWXSMKW99KPWJOQYPMHB9KWALSVLFNANYSMNWSJLUOCBKAWAJHNWMLPLXHVEPTKBPWLWHMDZ99999999999999999999999999999999999999999999999999999FDKW9AD99A99999999B99999999RJPQGE9AXNBBLPQ9IFJXFJTXJAIGDDXAWXGAVU9PJQNYFADJDIDBTJKSAEBBX9NWJGZVAVXYWXPCEFFH99XJLIVAZYJGPKEHANESX9DORLEIOIFL9WVQBBNUDRZDGJMVSRTSFKOJPIMEXPBCPGKUUEKRGAXOB99999XIFVJWCABR9XQKOWCXJAZDZWMWWBVHROBOPISAWDIJTSFPVAUZNJUMNUCOFIBIAAVIOWDTCNIPRVA9999999999999999999999999999999RSIDBWNOF999999999K99999999POWSRVIO9VMIJ99FKKNKGPNNNNP",
                "COSNPEACSPESTKTUS9CSMOCWVUBLERQJQGLLA9AYRRXMOVOBULQZZZJPLNELEX9EVZDAFOHBB9FBAYOTDB9YGJAVTDWNPJVVGEPFJ9QBYLXAYZEETY9GMYQRIRAIPWMJUFMFRSQRCEIOWISMBJKGCIGIIYNMXAYLXZIBNKANT9DSQXPBUPWGUJTOMD9JKSNFZJJFBZYBWRWQIZFOZXQWNJTRZTUPHVEGTAOLMBEPXOB9TCEBNIWXQUHNQJZHAOWGVOOOTSCTEUEMXJUODZP9CDLCMEXAW9YJGVNREENETEYXOAKZVRJVUSCRUSRCNZUGUOLCNHQITWYPJVJGPVULASTONDZRDVCNGJSN9DMMUORCOIBTITSPBXSAVTOHSAXHMGH99APRTQIVCEI9NWYKDOZCCWBNZGGCUCISSMGJHJ9OVSFBZVFMBODKRKSLIDESGFDQITCYFARWYTLFKSPLNVQ9LTYFODCHBAJKCWVZNBLOJH9ABFGDFOXHDNHZILINMYMVZYWTFJJOLADPTZRPJEMGPFQNYTFDGOKMDTDSKPTHIDWLMRSSACZMTHUCWVZHCYSPJRATABZ9JHWEBGTTQORGFOYDWUIYFYGOGGTYGYYI9RPKPMCTYNYKHHNWQKJTDQDHTRUYQPMCDDLVUUHUBPWGPMNQYPKHDHGIUSXJGNUXIYGZRGVYPTTV9KXJDLGVVXRIWIGKZJVCQ9DUWAYNDRKYCGKZDEOKZQCXELSQXLGLAPBDIWRTKGSIRNAZ9XFEGMWOWLPUA9TSGYRDOU9GKY9JJDKCJKKGJCRARGSNECJ9SEVAGPPJMBTMGNWSLNSFBOEYMIQBKOVSCTDIWCOQTHBVTZOFNNIYKKJLAROKIRFFPCLSOWO9BVNNJSXEYLJASPUEFKCEI9SGWADNGS9MZAKFTCAYNRVKGDIGYDTPGJXWFAEFGG9BX9XCNBZGQULH9IPPIQ9VFVAXGELUMCTE9TOFOGCTFYBYEBFOKKAESIIHEWLYLQKWDHPYNELJKMZHDSDSK9ZWFP99FQFLUXGTSVDMGHIFZFUCYTYPVEFEDM9TOHCQVIBXARYWZEKTWEOVSBYZTJZRUFZJCLRBTOWPTKY99CYQTGPMAKFYALIWPEQLUB9RGANTKDDMSDSJOTNPFZCXKJUGTJWWPK9FAJGPJOEBRHL9ZU9XRBDJBVMFIZIZFGKETH9RJUSDIOWDZIXFOJLT9DSIAWSCEYBNOGOAZQPZKVZTBXGACCBVQGFNGXNQFTVPUGUOHNBKTUERLSTDXGRKZSATIRHDBSXARYATBHOLUHCQGPRMQGSJUAXUCWKDXAUGORHFVVVDZQEYYGSV9IUM9VTMHJCIKBQD9TQLLYTZHAKDHPFGYMRGJOEDJKQTBBNFCKDEPYTPWUJEOPRJWHAILMVW9AXS9HAT9GCGRXZEHWNDOVGKGPWFXFC9IKLVZJCTGZUJFRHGL9FZWZYP9TPOWGOUTQ9INYBVTD9N9OV9AM9GYRJ99MRWRWLOAKJXMDTFNS9NZQAYGVZRJ9WVSIDRRQLGKH9VPUVKFWZMSRVVLKXUGJAZESC9LEYDNNDWS9WTWNFPCR9YKPOMIJAVHCRCJVBDFWSTDN9BPJRDMGZFXWTY9GUX9WEPJQMXSECFPREXAJ9DU9OLMNQFTF99QYZOGDUTMBHMNMCNUQTU9FTNEUNBT9NQO9YADGY9C9LQR9DYVJZE9GMMYAOUSWUIVJ9EAR9EEFCO9SZTQ9JQHPIJGXIOQZHOSUSVMHBOLTYSEONVLRISNAN9KJHHFFISTYIHYVAMXLPNALDELETXVSWGUWOIVKNAKZKNNRVNJKE9WMNQBXFGXSYZQQSIODAKINA9CPBOGAYKJ9V9GS9HERXSVYPEILYXC9GURBREBCXRZJVXHUOPGYFLPIFBCOTMHFTAAUQUZVEKOWYFFGSCXDFDBTSGZRMPQR9EYSZYGQETCWFDRXVOXXCUBOQTBQGVLAONSTSLURFYSDPAVNCXNWVPQOUORMVSLYISQUQKXFYYMJSGHQP9VAAZABEAGJMCPIEBZQSYCPS9CNKFBDRDTDA9C9MVKGUISRX9ODVUJNPDWMZ9ESYXJ99ETDGSTJZMZYJEGRUWTORMCLNHLDQ9YIJWPMDYGGJQHMFPJ9VKINJUESTCBJQXFTCJFNUXPZONVKXJRAYGKIWHXSBZRKBDLRWXSMKW99KPWJOQYPMHB9KWALSVLFNANYSMNWSJLUOCBKAWAJHNWMLPLXHVEPTKBPWLWHMD999999999999999999999999999999999999999999999999999999FDKW9AD99B99999999B99999999RJPQGE9AXNBBLPQ9IFJXFJTXJAIGDDXAWXGAVU9PJQNYFADJDIDBTJKSAEBBX9NWJGZVAVXYWXPCEFFH9XIFVJWCABR9XQKOWCXJAZDZWMWWBVHROBOPISAWDIJTSFPVAUZNJUMNUCOFIBIAAVIOWDTCNIPRVA9999FTXZAEQIKGFJABOGCCQGOMKNASGWCQWMNIMRDTHKPJMTKDGMEQNZOAYARIYEWFZYJALRKFODOITTZ9999999999999999999999999999999LLHDBWNOF999999999K99999999POWSRVIO9VMIJ99UMGMTTTPNNNV",
        };
        List<TransactionViewModel> transactions = persistAndMapTxs(trytes);
        try {
            boolean valid = BundleValidator.validate(tangle, transactions.get(0).getHash(),
                    BundleValidator.MODE_VALIDATE_ALL, new LinkedList<>());
            assertTrue("the bundle should be valid", valid);
        } catch (Exception e) {
            e.printStackTrace();
        }
    }

    /*
        Bundle with invalid semantics used to test partial validation modes.

        [
           {
              "hash": "BRGUEBBTOSEGSBYX9NZUNAEWFTAJAXLBPMRLNRACDSZECBMBRQAPYSPRZKPTVCZQNZDYXPYGHLPGZ9999",
              "signatureMessageFragment": "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999",
              "address": "999999999999999999999999999999999999999999999999999999999999999999999999999999999",
              "value": 100,
              "obsoleteTag": "VUA999999999999999999999999",
              "timestamp": 1564470943,
              "currentIndex": 4,
              "lastIndex": 5,
              "bundle": "OWBTVEDGRYG9FOGBCRLIFTIRZZEPGVJR9ZWQIHECTHWZHY9XJLKDNYSHBLBJFVIVEPLFKUFXJ9GIBFEWX",
              "trunkTransaction": "PTSKRNBAPGBSLEVWRJJLXXZMI9MYERD9VWWIEDKHELYJADWIHOPNLXZEJXHI9AOTGKSFSPYI9UUHZ9999",
              "branchTransaction": "NBAMUX9VSJWUWSFLXEYOYQJKPMUJGJGHQCWN9SNBPPMKAHJGJUZM9ZXEVPQUFAJXRBGPGMTNCAMJA9999",
              "tag": "999999999999999999999999999",
              "attachmentTimestamp": 1564470945152,
              "attachmentTimestampLowerBound": 0,
              "attachmentTimestampUpperBound": 11,
              "nonce": "QJA9999999RSA99999999999999"
           },
           {
              "hash": "PTSKRNBAPGBSLEVWRJJLXXZMI9MYERD9VWWIEDKHELYJADWIHOPNLXZEJXHI9AOTGKSFSPYI9UUHZ9999",
              "signatureMessageFragment": "RXLDYF9YTHVXKLHXBCDBQBVWUBIAIHCYSWLYJWHKXUDULDPKKFISAAKXLCZ9YRRXEHSNQVSXYDCESIHNDJNUKEGNCNLDYQEIMBWTBLPGYEDZVQJIHOVWSM9BGWDEYWFRWBDSYUJALTQZGQLHMBUDEDBAUIPTLBDBICKWVRHAWSVIJCFZZLLUYQXNXYTMDHX9LACUBBL9WFLRIKLMLQEAKPOZSZELTBPWZDEAKDWQPBYKOSOFPYDFMYBDKKTMD9RTGDIUYBTNMLSZFVMMFKHEZJLVPXWUZQZVWJDHNFBWDLUTLYUGOSBY9TDLISTQVITEHASWQTKDJL9YEVKHZJHKJTVAQKEVJEYHBODAQRXOHZNJEGH9LTPSZDQKERMUMTLJUTXCH9I9CJCPKSPHA9JEDXQUPKETALMMENNEXVDCCVENIDCKASPHYCGINJ9GXYGSCIHQFRFMPWHUSFTAQAQHHFJFKVTEETEFURZBMBYKMRGLRHCDGDJDNI9MXVRCCMVEDMUFUENSRV9TEKHQTTCWB9XUSSDTQBMPQVDDNSCFKHDGWTFLAXYQRZWBMEQ9PRBOFSZBXIGDVGHNUK9DWKJ9KNRDBENFYOOGOSEB9R99X9BGMEUQWKOHCMOOVNCRNEFOVNGPWEE9RTKMNXGCKXLNZSHKVRAMMLBEPELHQLEVAYCNRCIMEJYVP9PXDMWIYQZPT9NELUSEOEXYRTQJAALWINHMXXKEOKAOGLYITQEUJ9XUIBABKCYUDTJXTNIEWTFKVTIINUJII9IUOGULW9B9PQIZNIEGXBSMIWO99NTUWXXZCUGMSLSJKD9VQTOFAOQHZCXTYAKQYECAFGKYFMUFPRZZXRSHJFVFXTFRTNGOXNQB9HDGKD9HLUAWXPDXZFIBJOVUFIMYWKEQZPPEFWAADKYCZMAYUNECVMDTJBLLIDDNU9BIOEADRH9CARXERZVDZAKBMWJOIVMWWEGNCAZYV9KVNLGIVYOLORVBLKRMOYWOXYYZZNPMWOCYABGPFQHWIFLNGACIQ9AQPPXEXZUCNWVNTP9GXLPOEDGVOY9QDHBYAKIWBJETKPQCFNEPCSUOPCWBBQGG9A9QZGIUMZHCGIUIVPN9NEQTHAABBNRWHKRSOAJQOKIARTWFREJVCNADOMQMOPIQSNCVVU9QWB9K9TJQTH9XRKMKTOESYZSGOGMMIHTMS9QDTXMPRIRJGEAXIWQBR9JAUCPOPJGQIG9BMXEMIGVD9GLNDGDH9YRESLXUULJPTPTLDBMNKGEG9TR9PWWVQPEFICAPCFLYYKEMUDAVTUZFTXIYZNXVCNCMVXIWWWLFGYFIN9TUQIBUHLDZJEUNMNFNWLCGAHQSJ9DTFNO9NSOQGAXHDGAPQDPWFH9KTEMCWMNMSCPQHWNWJQOXUOHEJDCZWPNGAUONXANYTLRKNUSRCPRFECJJNDQNYZJUSWQPSDYOEBIVSJYHMMNNSYTYXDXAWPRXPYAPLIVCXHKZHNEBPMNBMIVXGGOQQLINCHNOAPUCJDECBPEATZYXVEXZMEUDXXILFZIKJQFOUZAARYNDIPTPEJFVWDSIT9M9LSCEHSDOFAUUPJUYG9PNEWVSELPWVZVLJNIEQYSXQZMNRDQNLBTDKSJCMWRLOUOBGAFFWLSFQPMFLQPTPBV9PJNZOFFPMRXSSCGCIHUKTDMYLQFCRBT9JHAUXTRBA9NWTULJXZVJYRQGJNTXFNGTJUOZL9PQRPQHOEBSGIVSPKJVRHKBQKWROLXUJGNPEUQ9BMVJCPPVHWHBUEDRRBRSLSECZAIVSSJHCSDEAIFNPFOYRYLTLITHYEKGBSWCKFIDVSIYPQAPQHJDNXAUAEDAYBXOPIDB9XPNBEMFYZDCNHMNTBSBZMANXBGHZTJSWWS9KFEMKQJDLNAACGVSBWVCQHAG9DAMCWUBHLFYZILBQYTBBCPVQVFGNFVZPPSZMGKHZFSMJBLROKKCMZSXBPFA9RYWBDJIXYOJWNMLVRNQCIRJGQQPXHAYTKPDHNVDATYJRJGCNXHJOSEY9YSWIXEMJKYULPPDSASZQWFTK9NJNZKWZAYAAPAGTOZEPJXXWRCNWCYFFCWQ99MI99QBFAQZETMKG9EZ9UNLUGHZIBCILSDCGJIGXFAJMXHKXREUTE9LNBEWWWTMUZFOOWD9BHGXVGL9BXXXKQX",
              "address": "IOSKBLGGNONZVLMFNZEUTABNBIQF9ZTMNRDMPFZKOPCPXJVQHFWTNMBPTPYEDPPVEQHWUJGEWCNYKWABC",
              "value": -1000000,
              "obsoleteTag": "999999999999999999999999999",
              "timestamp": 1564470943,
              "currentIndex": 1,
              "lastIndex": 5,
              "bundle": "OWBTVEDGRYG9FOGBCRLIFTIRZZEPGVJR9ZWQIHECTHWZHY9XJLKDNYSHBLBJFVIVEPLFKUFXJ9GIBFEWX",
              "trunkTransaction": "MAAJVBUWQLZGRECIRXVEGVNJXTFQPNW9RKLUBLIGFDSQNMXZO9VMXLZZ9PATMJQFRICKJSXZBDPRZ9999",
              "branchTransaction": "NBAMUX9VSJWUWSFLXEYOYQJKPMUJGJGHQCWN9SNBPPMKAHJGJUZM9ZXEVPQUFAJXRBGPGMTNCAMJA9999",
              "tag": "999999999999999999999999999",
              "attachmentTimestamp": 1564470945010,
              "attachmentTimestampLowerBound": 0,
              "attachmentTimestampUpperBound": 11,
              "nonce": "BKC9999999XMC99999999999999"
           },
           {
              "hash": "MAAJVBUWQLZGRECIRXVEGVNJXTFQPNW9RKLUBLIGFDSQNMXZO9VMXLZZ9PATMJQFRICKJSXZBDPRZ9999",
              "signatureMessageFragment": "OWHZXN9UYGGFEVPDHVWSEIWWIFCVAPQUOLEWHKKIJHOZFYPDCCPHFTF9GARSNSDCNIYFOHVGHOJUMZWJCGSFWQHCRDBCN9KBPJD9ESKVRGSUBCGIGQKZEWPRFTFBJQBFVJLPU9NBTHVAOLHEHICPYOFARYVM9ZXDYWPNLYIC9VWDDQQKJMEYXMNQVUWZGPEEPBHYUBHQZIHKEUTHHKJFTRQWMXWWWQLNSZOVRSCKQOKZHIMYKXCBPBRDYOOLMMLYIQRNI9LQERYZNYIUTPB9IMWONCRUGMESTUMDTWWXEMLWROGXSWFHWMUMSVPHIDSZJJOWXTJNLNEOLFFDL9GVOFYHOAIPJGQDWEMZLEPIPCYZDAGJ9O9LMTGJEORGQYZASQXUPHWQRJEEABPSNC9TWRIV9DNRQUVVYMMZMVDYIOPQGDBKPVQO9VPJLEJIPOWNOAB9ILZFJH9WYHALVMYYLITQDAQJPZBHYDGNTYMWRFHLOXCWZUKVDUBJBXXYEE9QNPEMGARYLRJPGFWSTLOKISSLWTMUJYWBUVGKHZ9KNXTVXQPUMTNWFCCDFLNMEGMBSYAYNZKVZDNNCGYWAJPKCQCCAVULJGOSNNQLCFKITXORKQILXLHBBDBALSVRDZUHRKEJMMLDCNSBXHGJC9AGKZXATTURIKSYOLHDZVLBMYLCUSRTGIPHYIAIAVMZPJHRCFKXNRJVVWLMITOWXPXDNSWFXARUMRMLMZJTSJQYPBHLILPQQWHDCFKOFSOYDKGMSSTFINMQWARKXCDTZ9SASPKPPAYPZHWBTZTTB9JB9C9FP9IF9HCOKACUBKMPPSRRHMXLWJDNEXZKFX9KSAFPMMOEUVPRROROISLSTWAOVKE9OCCKIAUDFZXM9LCDM9VAJUNBVPHXULVUGZWUBWQITZBZIWREZGNNCCDYVUSQNCBTQARSKYGWHAOTRVMDUXHMWOTD9GACJPAAXFYLDISRDLGFIKJT9QWFZ9NXCDOIAIFDQBDUJBFVNUGTKFZIKZKXBKOLDQXODGGUGOQKGTKXUTGVRNWSDJREWTZUVCIFKULO9TZJSVJOYSAGIJCNBKTXRLVUXJGBHAZJFEDSMNFTADYVJ99PP9KBP9WJWHHZYMYATATVYUOMUETMHFRQUWQNNIESGQOFPNDLQZFCZLQWLSWXGJZFLHKAU9FXOPGDQMKDSSKVPOLCFLWOQBMLAOCGVKWZXWUDXLESJBKBIEGHPKOCDPITIYI9CHTMCLYMBXCLEYBNNEDAWSLDCPCOVCXXHXIRCU9EYYYJWNJARFOIJIJKTOVCJIKGDBAVOYEEBNMCMHSHKPEWVDSSRDDN9PUFQXJIMBLPHRYLTEIEJTIJIVAFXMGDIQNUZWBODOVROBSGMAYBSKQUZEISKZ9AGYAQNFNCVEQJPJCUJUJIKINMDHUOGRCORQKWBCCVV9UKYVYYZVLTUZNGBNGLSJGMD9GUTGJJGTLACCNUQTWRCVXAYDW9YMPEQRWGSIPFCUQZMYKKJMTSQ9ZN9YYYFOBTRLWHSBBJWGOTAZVPDGSI9N9MCJ99YEKQYCAUO9MHUCHMEAUTITOYRQBROKKWFZUILHBFBWCEWSVEPUCJSRR9XGVXAP9QXBZOHMPDNOQNNBPKUSWFQAABPTQH99Z9RMBASNZU9VYY9APLMFBGKW9QBRRHHKJQNOHSLWLHUY9NDUJTQSPIUQDBBK9VCAAVEDPHANDWYPAWVRNLQJPOELZPYNBWAK9KLSPAEESADMRPBAPYFGEWTZQLYTVMYBR9VCQJHZCFKBTPQEQHJOXCSFYQNJTFGTAHLLQGSBGTZOLFMFQEOOMBBURXEWWAHTZIYB9MHMUEKXAYALCFO9HSO9POINVKRVB9QHBANHY9YSAMACWFSHA9UGWI9RGTOMLXXTSNEVILPWJBFWBZUASAGTYWGTXHPUCWNCAVKPCKYFBMZMGAIMFHORQZHHKRQEUHOQEDQFRK9KATJAVCUVLLALKZUREIZOGAKUPZKPIBUQS9QCGVZJMNSBGVFURYKCEPKAPMWAVIRPJMTILBS9IGFOXGWTLTZHXGCTHUEGPRHIT9XZK9HEXRWDGTKMQPQFJPGYGFNYWJVRNREWPAEHGCOSNGUJEAMVJQKHDHKHHHZQTVEFNXGJSQSDPQMCK9QBRMOFVYQATOPYSJQMYLPEZ",
              "address": "IOSKBLGGNONZVLMFNZEUTABNBIQF9ZTMNRDMPFZKOPCPXJVQHFWTNMBPTPYEDPPVEQHWUJGEWCNYKWABC",
              "value": 0,
              "obsoleteTag": "999999999999999999999999999",
              "timestamp": 1564470943,
              "currentIndex": 2,
              "lastIndex": 5,
              "bundle": "OWBTVEDGRYG9FOGBCRLIFTIRZZEPGVJR9ZWQIHECTHWZHY9XJLKDNYSHBLBJFVIVEPLFKUFXJ9GIBFEWX",
              "trunkTransaction": "LYOQDNYZRSTLDWWCHQGERSFIGGMXRLHEVAZLPZXNXNHDPAFMQZ9QMFJDOSNEAGLPSTZMNLGS9X9YA9999",
              "branchTransaction": "NBAMUX9VSJWUWSFLXEYOYQJKPMUJGJGHQCWN9SNBPPMKAHJGJUZM9ZXEVPQUFAJXRBGPGMTNCAMJA9999",
              "tag": "999999999999999999999999999",
              "attachmentTimestamp": 1564470944698,
              "attachmentTimestampLowerBound": 0,
              "attachmentTimestampUpperBound": 11,
              "nonce": "AMA9999999LTH99999999999999"
           },
           {
              "hash": "LYOQDNYZRSTLDWWCHQGERSFIGGMXRLHEVAZLPZXNXNHDPAFMQZ9QMFJDOSNEAGLPSTZMNLGS9X9YA9999",
              "signatureMessageFragment": "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999",
              "address": "AIUYNRQFJECFGMU9RUDT9MUFVRJZCMTMA9YZ9NWODBUHFQLHPCODTWLPUEPMALFSANRLBCTFAGDGTFUIW",
              "value": 1000,
              "obsoleteTag": "999999999999999999999999999",
              "timestamp": 1564470943,
              "currentIndex": 0,
              "lastIndex": 5,
              "bundle": "OWBTVEDGRYG9FOGBCRLIFTIRZZEPGVJR9ZWQIHECTHWZHY9XJLKDNYSHBLBJFVIVEPLFKUFXJ9GIBFEWX",
              "trunkTransaction": "NBAMUX9VSJWUWSFLXEYOYQJKPMUJGJGHQCWN9SNBPPMKAHJGJUZM9ZXEVPQUFAJXRBGPGMTNCAMJA9999",
              "branchTransaction": "TTDB9HOE9NZMXNYXEKNZVZSMDJUBDCA9ZZAQQFNLTWS9XIJCCIIZPEN9WMFKDHKOEXTCCPOZIKIQA9999",
              "tag": "999999999999999999999999999",
              "attachmentTimestamp": 1564470944390,
              "attachmentTimestampLowerBound": 0,
              "attachmentTimestampUpperBound": 11,
              "nonce": "TA99999999IBH99999999999999"
           }
        ]
     */

    @Test
    public void validationModeAllWithInvalidBundle() {
        // semantics are wrong
        String[] trytes = {
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999SD9999999999999999999999999VUA999999999999999999999999GRJVAAD99D99999999E99999999OWBTVEDGRYG9FOGBCRLIFTIRZZEPGVJR9ZWQIHECTHWZHY9XJLKDNYSHBLBJFVIVEPLFKUFXJ9GIBFEWXPTSKRNBAPGBSLEVWRJJLXXZMI9MYERD9VWWIEDKHELYJADWIHOPNLXZEJXHI9AOTGKSFSPYI9UUHZ9999NBAMUX9VSJWUWSFLXEYOYQJKPMUJGJGHQCWN9SNBPPMKAHJGJUZM9ZXEVPQUFAJXRBGPGMTNCAMJA9999999999999999999999999999999ZFMBREOOF999999999K99999999QJA9999999RSA99999999999999",
                "RXLDYF9YTHVXKLHXBCDBQBVWUBIAIHCYSWLYJWHKXUDULDPKKFISAAKXLCZ9YRRXEHSNQVSXYDCESIHNDJNUKEGNCNLDYQEIMBWTBLPGYEDZVQJIHOVWSM9BGWDEYWFRWBDSYUJALTQZGQLHMBUDEDBAUIPTLBDBICKWVRHAWSVIJCFZZLLUYQXNXYTMDHX9LACUBBL9WFLRIKLMLQEAKPOZSZELTBPWZDEAKDWQPBYKOSOFPYDFMYBDKKTMD9RTGDIUYBTNMLSZFVMMFKHEZJLVPXWUZQZVWJDHNFBWDLUTLYUGOSBY9TDLISTQVITEHASWQTKDJL9YEVKHZJHKJTVAQKEVJEYHBODAQRXOHZNJEGH9LTPSZDQKERMUMTLJUTXCH9I9CJCPKSPHA9JEDXQUPKETALMMENNEXVDCCVENIDCKASPHYCGINJ9GXYGSCIHQFRFMPWHUSFTAQAQHHFJFKVTEETEFURZBMBYKMRGLRHCDGDJDNI9MXVRCCMVEDMUFUENSRV9TEKHQTTCWB9XUSSDTQBMPQVDDNSCFKHDGWTFLAXYQRZWBMEQ9PRBOFSZBXIGDVGHNUK9DWKJ9KNRDBENFYOOGOSEB9R99X9BGMEUQWKOHCMOOVNCRNEFOVNGPWEE9RTKMNXGCKXLNZSHKVRAMMLBEPELHQLEVAYCNRCIMEJYVP9PXDMWIYQZPT9NELUSEOEXYRTQJAALWINHMXXKEOKAOGLYITQEUJ9XUIBABKCYUDTJXTNIEWTFKVTIINUJII9IUOGULW9B9PQIZNIEGXBSMIWO99NTUWXXZCUGMSLSJKD9VQTOFAOQHZCXTYAKQYECAFGKYFMUFPRZZXRSHJFVFXTFRTNGOXNQB9HDGKD9HLUAWXPDXZFIBJOVUFIMYWKEQZPPEFWAADKYCZMAYUNECVMDTJBLLIDDNU9BIOEADRH9CARXERZVDZAKBMWJOIVMWWEGNCAZYV9KVNLGIVYOLORVBLKRMOYWOXYYZZNPMWOCYABGPFQHWIFLNGACIQ9AQPPXEXZUCNWVNTP9GXLPOEDGVOY9QDHBYAKIWBJETKPQCFNEPCSUOPCWBBQGG9A9QZGIUMZHCGIUIVPN9NEQTHAABBNRWHKRSOAJQOKIARTWFREJVCNADOMQMOPIQSNCVVU9QWB9K9TJQTH9XRKMKTOESYZSGOGMMIHTMS9QDTXMPRIRJGEAXIWQBR9JAUCPOPJGQIG9BMXEMIGVD9GLNDGDH9YRESLXUULJPTPTLDBMNKGEG9TR9PWWVQPEFICAPCFLYYKEMUDAVTUZFTXIYZNXVCNCMVXIWWWLFGYFIN9TUQIBUHLDZJEUNMNFNWLCGAHQSJ9DTFNO9NSOQGAXHDGAPQDPWFH9KTEMCWMNMSCPQHWNWJQOXUOHEJDCZWPNGAUONXANYTLRKNUSRCPRFECJJNDQNYZJUSWQPSDYOEBIVSJYHMMNNSYTYXDXAWPRXPYAPLIVCXHKZHNEBPMNBMIVXGGOQQLINCHNOAPUCJDECBPEATZYXVEXZMEUDXXILFZIKJQFOUZAARYNDIPTPEJFVWDSIT9M9LSCEHSDOFAUUPJUYG9PNEWVSELPWVZVLJNIEQYSXQZMNRDQNLBTDKSJCMWRLOUOBGAFFWLSFQPMFLQPTPBV9PJNZOFFPMRXSSCGCIHUKTDMYLQFCRBT9JHAUXTRBA9NWTULJXZVJYRQGJNTXFNGTJUOZL9PQRPQHOEBSGIVSPKJVRHKBQKWROLXUJGNPEUQ9BMVJCPPVHWHBUEDRRBRSLSECZAIVSSJHCSDEAIFNPFOYRYLTLITHYEKGBSWCKFIDVSIYPQAPQHJDNXAUAEDAYBXOPIDB9XPNBEMFYZDCNHMNTBSBZMANXBGHZTJSWWS9KFEMKQJDLNAACGVSBWVCQHAG9DAMCWUBHLFYZILBQYTBBCPVQVFGNFVZPPSZMGKHZFSMJBLROKKCMZSXBPFA9RYWBDJIXYOJWNMLVRNQCIRJGQQPXHAYTKPDHNVDATYJRJGCNXHJOSEY9YSWIXEMJKYULPPDSASZQWFTK9NJNZKWZAYAAPAGTOZEPJXXWRCNWCYFFCWQ99MI99QBFAQZETMKG9EZ9UNLUGHZIBCILSDCGJIGXFAJMXHKXREUTE9LNBEWWWTMUZFOOWD9BHGXVGL9BXXXKQXIOSKBLGGNONZVLMFNZEUTABNBIQF9ZTMNRDMPFZKOPCPXJVQHFWTNMBPTPYEDPPVEQHWUJGEWCNYKWABCZGECY9999999999999999999999999999999999999999999999999GRJVAAD99A99999999E99999999OWBTVEDGRYG9FOGBCRLIFTIRZZEPGVJR9ZWQIHECTHWZHY9XJLKDNYSHBLBJFVIVEPLFKUFXJ9GIBFEWXMAAJVBUWQLZGRECIRXVEGVNJXTFQPNW9RKLUBLIGFDSQNMXZO9VMXLZZ9PATMJQFRICKJSXZBDPRZ9999NBAMUX9VSJWUWSFLXEYOYQJKPMUJGJGHQCWN9SNBPPMKAHJGJUZM9ZXEVPQUFAJXRBGPGMTNCAMJA9999999999999999999999999999999SAMBREOOF999999999K99999999BKC9999999XMC99999999999999",
                "OWHZXN9UYGGFEVPDHVWSEIWWIFCVAPQUOLEWHKKIJHOZFYPDCCPHFTF9GARSNSDCNIYFOHVGHOJUMZWJCGSFWQHCRDBCN9KBPJD9ESKVRGSUBCGIGQKZEWPRFTFBJQBFVJLPU9NBTHVAOLHEHICPYOFARYVM9ZXDYWPNLYIC9VWDDQQKJMEYXMNQVUWZGPEEPBHYUBHQZIHKEUTHHKJFTRQWMXWWWQLNSZOVRSCKQOKZHIMYKXCBPBRDYOOLMMLYIQRNI9LQERYZNYIUTPB9IMWONCRUGMESTUMDTWWXEMLWROGXSWFHWMUMSVPHIDSZJJOWXTJNLNEOLFFDL9GVOFYHOAIPJGQDWEMZLEPIPCYZDAGJ9O9LMTGJEORGQYZASQXUPHWQRJEEABPSNC9TWRIV9DNRQUVVYMMZMVDYIOPQGDBKPVQO9VPJLEJIPOWNOAB9ILZFJH9WYHALVMYYLITQDAQJPZBHYDGNTYMWRFHLOXCWZUKVDUBJBXXYEE9QNPEMGARYLRJPGFWSTLOKISSLWTMUJYWBUVGKHZ9KNXTVXQPUMTNWFCCDFLNMEGMBSYAYNZKVZDNNCGYWAJPKCQCCAVULJGOSNNQLCFKITXORKQILXLHBBDBALSVRDZUHRKEJMMLDCNSBXHGJC9AGKZXATTURIKSYOLHDZVLBMYLCUSRTGIPHYIAIAVMZPJHRCFKXNRJVVWLMITOWXPXDNSWFXARUMRMLMZJTSJQYPBHLILPQQWHDCFKOFSOYDKGMSSTFINMQWARKXCDTZ9SASPKPPAYPZHWBTZTTB9JB9C9FP9IF9HCOKACUBKMPPSRRHMXLWJDNEXZKFX9KSAFPMMOEUVPRROROISLSTWAOVKE9OCCKIAUDFZXM9LCDM9VAJUNBVPHXULVUGZWUBWQITZBZIWREZGNNCCDYVUSQNCBTQARSKYGWHAOTRVMDUXHMWOTD9GACJPAAXFYLDISRDLGFIKJT9QWFZ9NXCDOIAIFDQBDUJBFVNUGTKFZIKZKXBKOLDQXODGGUGOQKGTKXUTGVRNWSDJREWTZUVCIFKULO9TZJSVJOYSAGIJCNBKTXRLVUXJGBHAZJFEDSMNFTADYVJ99PP9KBP9WJWHHZYMYATATVYUOMUETMHFRQUWQNNIESGQOFPNDLQZFCZLQWLSWXGJZFLHKAU9FXOPGDQMKDSSKVPOLCFLWOQBMLAOCGVKWZXWUDXLESJBKBIEGHPKOCDPITIYI9CHTMCLYMBXCLEYBNNEDAWSLDCPCOVCXXHXIRCU9EYYYJWNJARFOIJIJKTOVCJIKGDBAVOYEEBNMCMHSHKPEWVDSSRDDN9PUFQXJIMBLPHRYLTEIEJTIJIVAFXMGDIQNUZWBODOVROBSGMAYBSKQUZEISKZ9AGYAQNFNCVEQJPJCUJUJIKINMDHUOGRCORQKWBCCVV9UKYVYYZVLTUZNGBNGLSJGMD9GUTGJJGTLACCNUQTWRCVXAYDW9YMPEQRWGSIPFCUQZMYKKJMTSQ9ZN9YYYFOBTRLWHSBBJWGOTAZVPDGSI9N9MCJ99YEKQYCAUO9MHUCHMEAUTITOYRQBROKKWFZUILHBFBWCEWSVEPUCJSRR9XGVXAP9QXBZOHMPDNOQNNBPKUSWFQAABPTQH99Z9RMBASNZU9VYY9APLMFBGKW9QBRRHHKJQNOHSLWLHUY9NDUJTQSPIUQDBBK9VCAAVEDPHANDWYPAWVRNLQJPOELZPYNBWAK9KLSPAEESADMRPBAPYFGEWTZQLYTVMYBR9VCQJHZCFKBTPQEQHJOXCSFYQNJTFGTAHLLQGSBGTZOLFMFQEOOMBBURXEWWAHTZIYB9MHMUEKXAYALCFO9HSO9POINVKRVB9QHBANHY9YSAMACWFSHA9UGWI9RGTOMLXXTSNEVILPWJBFWBZUASAGTYWGTXHPUCWNCAVKPCKYFBMZMGAIMFHORQZHHKRQEUHOQEDQFRK9KATJAVCUVLLALKZUREIZOGAKUPZKPIBUQS9QCGVZJMNSBGVFURYKCEPKAPMWAVIRPJMTILBS9IGFOXGWTLTZHXGCTHUEGPRHIT9XZK9HEXRWDGTKMQPQFJPGYGFNYWJVRNREWPAEHGCOSNGUJEAMVJQKHDHKHHHZQTVEFNXGJSQSDPQMCK9QBRMOFVYQATOPYSJQMYLPEZIOSKBLGGNONZVLMFNZEUTABNBIQF9ZTMNRDMPFZKOPCPXJVQHFWTNMBPTPYEDPPVEQHWUJGEWCNYKWABC999999999999999999999999999999999999999999999999999999GRJVAAD99B99999999E99999999OWBTVEDGRYG9FOGBCRLIFTIRZZEPGVJR9ZWQIHECTHWZHY9XJLKDNYSHBLBJFVIVEPLFKUFXJ9GIBFEWXLYOQDNYZRSTLDWWCHQGERSFIGGMXRLHEVAZLPZXNXNHDPAFMQZ9QMFJDOSNEAGLPSTZMNLGS9X9YA9999NBAMUX9VSJWUWSFLXEYOYQJKPMUJGJGHQCWN9SNBPPMKAHJGJUZM9ZXEVPQUFAJXRBGPGMTNCAMJA9999999999999999999999999999999DPMBREOOF999999999K99999999AMA9999999LTH99999999999999",
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999AIUYNRQFJECFGMU9RUDT9MUFVRJZCMTMA9YZ9NWODBUHFQLHPCODTWLPUEPMALFSANRLBCTFAGDGTFUIWAJA999999999999999999999999999999999999999999999999999GRJVAAD99999999999E99999999OWBTVEDGRYG9FOGBCRLIFTIRZZEPGVJR9ZWQIHECTHWZHY9XJLKDNYSHBLBJFVIVEPLFKUFXJ9GIBFEWXNBAMUX9VSJWUWSFLXEYOYQJKPMUJGJGHQCWN9SNBPPMKAHJGJUZM9ZXEVPQUFAJXRBGPGMTNCAMJA9999TTDB9HOE9NZMXNYXEKNZVZSMDJUBDCA9ZZAQQFNLTWS9XIJCCIIZPEN9WMFKDHKOEXTCCPOZIKIQA9999999999999999999999999999999TELBREOOF999999999K99999999TA99999999IBH99999999999999",
        };
        List<TransactionViewModel> transactions = persistAndMapTxs(trytes);
        try {
            boolean valid = BundleValidator.validate(tangle, transactions.get(0).getHash(),
                    BundleValidator.MODE_VALIDATE_ALL, new LinkedList<>());
            assertFalse("the bundle should be invalid", valid);
        } catch (Exception e) {
            e.printStackTrace();
        }
    }

    @Test
    public void validationModeBundleHash() {
        // semantics are wrong (indices) but bundle hash is valid
        String[] trytes = {
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999SD9999999999999999999999999VUA999999999999999999999999GRJVAAD99D99999999E99999999OWBTVEDGRYG9FOGBCRLIFTIRZZEPGVJR9ZWQIHECTHWZHY9XJLKDNYSHBLBJFVIVEPLFKUFXJ9GIBFEWXPTSKRNBAPGBSLEVWRJJLXXZMI9MYERD9VWWIEDKHELYJADWIHOPNLXZEJXHI9AOTGKSFSPYI9UUHZ9999NBAMUX9VSJWUWSFLXEYOYQJKPMUJGJGHQCWN9SNBPPMKAHJGJUZM9ZXEVPQUFAJXRBGPGMTNCAMJA9999999999999999999999999999999ZFMBREOOF999999999K99999999QJA9999999RSA99999999999999",
                "RXLDYF9YTHVXKLHXBCDBQBVWUBIAIHCYSWLYJWHKXUDULDPKKFISAAKXLCZ9YRRXEHSNQVSXYDCESIHNDJNUKEGNCNLDYQEIMBWTBLPGYEDZVQJIHOVWSM9BGWDEYWFRWBDSYUJALTQZGQLHMBUDEDBAUIPTLBDBICKWVRHAWSVIJCFZZLLUYQXNXYTMDHX9LACUBBL9WFLRIKLMLQEAKPOZSZELTBPWZDEAKDWQPBYKOSOFPYDFMYBDKKTMD9RTGDIUYBTNMLSZFVMMFKHEZJLVPXWUZQZVWJDHNFBWDLUTLYUGOSBY9TDLISTQVITEHASWQTKDJL9YEVKHZJHKJTVAQKEVJEYHBODAQRXOHZNJEGH9LTPSZDQKERMUMTLJUTXCH9I9CJCPKSPHA9JEDXQUPKETALMMENNEXVDCCVENIDCKASPHYCGINJ9GXYGSCIHQFRFMPWHUSFTAQAQHHFJFKVTEETEFURZBMBYKMRGLRHCDGDJDNI9MXVRCCMVEDMUFUENSRV9TEKHQTTCWB9XUSSDTQBMPQVDDNSCFKHDGWTFLAXYQRZWBMEQ9PRBOFSZBXIGDVGHNUK9DWKJ9KNRDBENFYOOGOSEB9R99X9BGMEUQWKOHCMOOVNCRNEFOVNGPWEE9RTKMNXGCKXLNZSHKVRAMMLBEPELHQLEVAYCNRCIMEJYVP9PXDMWIYQZPT9NELUSEOEXYRTQJAALWINHMXXKEOKAOGLYITQEUJ9XUIBABKCYUDTJXTNIEWTFKVTIINUJII9IUOGULW9B9PQIZNIEGXBSMIWO99NTUWXXZCUGMSLSJKD9VQTOFAOQHZCXTYAKQYECAFGKYFMUFPRZZXRSHJFVFXTFRTNGOXNQB9HDGKD9HLUAWXPDXZFIBJOVUFIMYWKEQZPPEFWAADKYCZMAYUNECVMDTJBLLIDDNU9BIOEADRH9CARXERZVDZAKBMWJOIVMWWEGNCAZYV9KVNLGIVYOLORVBLKRMOYWOXYYZZNPMWOCYABGPFQHWIFLNGACIQ9AQPPXEXZUCNWVNTP9GXLPOEDGVOY9QDHBYAKIWBJETKPQCFNEPCSUOPCWBBQGG9A9QZGIUMZHCGIUIVPN9NEQTHAABBNRWHKRSOAJQOKIARTWFREJVCNADOMQMOPIQSNCVVU9QWB9K9TJQTH9XRKMKTOESYZSGOGMMIHTMS9QDTXMPRIRJGEAXIWQBR9JAUCPOPJGQIG9BMXEMIGVD9GLNDGDH9YRESLXUULJPTPTLDBMNKGEG9TR9PWWVQPEFICAPCFLYYKEMUDAVTUZFTXIYZNXVCNCMVXIWWWLFGYFIN9TUQIBUHLDZJEUNMNFNWLCGAHQSJ9DTFNO9NSOQGAXHDGAPQDPWFH9KTEMCWMNMSCPQHWNWJQOXUOHEJDCZWPNGAUONXANYTLRKNUSRCPRFECJJNDQNYZJUSWQPSDYOEBIVSJYHMMNNSYTYXDXAWPRXPYAPLIVCXHKZHNEBPMNBMIVXGGOQQLINCHNOAPUCJDECBPEATZYXVEXZMEUDXXILFZIKJQFOUZAARYNDIPTPEJFVWDSIT9M9LSCEHSDOFAUUPJUYG9PNEWVSELPWVZVLJNIEQYSXQZMNRDQNLBTDKSJCMWRLOUOBGAFFWLSFQPMFLQPTPBV9PJNZOFFPMRXSSCGCIHUKTDMYLQFCRBT9JHAUXTRBA9NWTULJXZVJYRQGJNTXFNGTJUOZL9PQRPQHOEBSGIVSPKJVRHKBQKWROLXUJGNPEUQ9BMVJCPPVHWHBUEDRRBRSLSECZAIVSSJHCSDEAIFNPFOYRYLTLITHYEKGBSWCKFIDVSIYPQAPQHJDNXAUAEDAYBXOPIDB9XPNBEMFYZDCNHMNTBSBZMANXBGHZTJSWWS9KFEMKQJDLNAACGVSBWVCQHAG9DAMCWUBHLFYZILBQYTBBCPVQVFGNFVZPPSZMGKHZFSMJBLROKKCMZSXBPFA9RYWBDJIXYOJWNMLVRNQCIRJGQQPXHAYTKPDHNVDATYJRJGCNXHJOSEY9YSWIXEMJKYULPPDSASZQWFTK9NJNZKWZAYAAPAGTOZEPJXXWRCNWCYFFCWQ99MI99QBFAQZETMKG9EZ9UNLUGHZIBCILSDCGJIGXFAJMXHKXREUTE9LNBEWWWTMUZFOOWD9BHGXVGL9BXXXKQXIOSKBLGGNONZVLMFNZEUTABNBIQF9ZTMNRDMPFZKOPCPXJVQHFWTNMBPTPYEDPPVEQHWUJGEWCNYKWABCZGECY9999999999999999999999999999999999999999999999999GRJVAAD99A99999999E99999999OWBTVEDGRYG9FOGBCRLIFTIRZZEPGVJR9ZWQIHECTHWZHY9XJLKDNYSHBLBJFVIVEPLFKUFXJ9GIBFEWXMAAJVBUWQLZGRECIRXVEGVNJXTFQPNW9RKLUBLIGFDSQNMXZO9VMXLZZ9PATMJQFRICKJSXZBDPRZ9999NBAMUX9VSJWUWSFLXEYOYQJKPMUJGJGHQCWN9SNBPPMKAHJGJUZM9ZXEVPQUFAJXRBGPGMTNCAMJA9999999999999999999999999999999SAMBREOOF999999999K99999999BKC9999999XMC99999999999999",
                "OWHZXN9UYGGFEVPDHVWSEIWWIFCVAPQUOLEWHKKIJHOZFYPDCCPHFTF9GARSNSDCNIYFOHVGHOJUMZWJCGSFWQHCRDBCN9KBPJD9ESKVRGSUBCGIGQKZEWPRFTFBJQBFVJLPU9NBTHVAOLHEHICPYOFARYVM9ZXDYWPNLYIC9VWDDQQKJMEYXMNQVUWZGPEEPBHYUBHQZIHKEUTHHKJFTRQWMXWWWQLNSZOVRSCKQOKZHIMYKXCBPBRDYOOLMMLYIQRNI9LQERYZNYIUTPB9IMWONCRUGMESTUMDTWWXEMLWROGXSWFHWMUMSVPHIDSZJJOWXTJNLNEOLFFDL9GVOFYHOAIPJGQDWEMZLEPIPCYZDAGJ9O9LMTGJEORGQYZASQXUPHWQRJEEABPSNC9TWRIV9DNRQUVVYMMZMVDYIOPQGDBKPVQO9VPJLEJIPOWNOAB9ILZFJH9WYHALVMYYLITQDAQJPZBHYDGNTYMWRFHLOXCWZUKVDUBJBXXYEE9QNPEMGARYLRJPGFWSTLOKISSLWTMUJYWBUVGKHZ9KNXTVXQPUMTNWFCCDFLNMEGMBSYAYNZKVZDNNCGYWAJPKCQCCAVULJGOSNNQLCFKITXORKQILXLHBBDBALSVRDZUHRKEJMMLDCNSBXHGJC9AGKZXATTURIKSYOLHDZVLBMYLCUSRTGIPHYIAIAVMZPJHRCFKXNRJVVWLMITOWXPXDNSWFXARUMRMLMZJTSJQYPBHLILPQQWHDCFKOFSOYDKGMSSTFINMQWARKXCDTZ9SASPKPPAYPZHWBTZTTB9JB9C9FP9IF9HCOKACUBKMPPSRRHMXLWJDNEXZKFX9KSAFPMMOEUVPRROROISLSTWAOVKE9OCCKIAUDFZXM9LCDM9VAJUNBVPHXULVUGZWUBWQITZBZIWREZGNNCCDYVUSQNCBTQARSKYGWHAOTRVMDUXHMWOTD9GACJPAAXFYLDISRDLGFIKJT9QWFZ9NXCDOIAIFDQBDUJBFVNUGTKFZIKZKXBKOLDQXODGGUGOQKGTKXUTGVRNWSDJREWTZUVCIFKULO9TZJSVJOYSAGIJCNBKTXRLVUXJGBHAZJFEDSMNFTADYVJ99PP9KBP9WJWHHZYMYATATVYUOMUETMHFRQUWQNNIESGQOFPNDLQZFCZLQWLSWXGJZFLHKAU9FXOPGDQMKDSSKVPOLCFLWOQBMLAOCGVKWZXWUDXLESJBKBIEGHPKOCDPITIYI9CHTMCLYMBXCLEYBNNEDAWSLDCPCOVCXXHXIRCU9EYYYJWNJARFOIJIJKTOVCJIKGDBAVOYEEBNMCMHSHKPEWVDSSRDDN9PUFQXJIMBLPHRYLTEIEJTIJIVAFXMGDIQNUZWBODOVROBSGMAYBSKQUZEISKZ9AGYAQNFNCVEQJPJCUJUJIKINMDHUOGRCORQKWBCCVV9UKYVYYZVLTUZNGBNGLSJGMD9GUTGJJGTLACCNUQTWRCVXAYDW9YMPEQRWGSIPFCUQZMYKKJMTSQ9ZN9YYYFOBTRLWHSBBJWGOTAZVPDGSI9N9MCJ99YEKQYCAUO9MHUCHMEAUTITOYRQBROKKWFZUILHBFBWCEWSVEPUCJSRR9XGVXAP9QXBZOHMPDNOQNNBPKUSWFQAABPTQH99Z9RMBASNZU9VYY9APLMFBGKW9QBRRHHKJQNOHSLWLHUY9NDUJTQSPIUQDBBK9VCAAVEDPHANDWYPAWVRNLQJPOELZPYNBWAK9KLSPAEESADMRPBAPYFGEWTZQLYTVMYBR9VCQJHZCFKBTPQEQHJOXCSFYQNJTFGTAHLLQGSBGTZOLFMFQEOOMBBURXEWWAHTZIYB9MHMUEKXAYALCFO9HSO9POINVKRVB9QHBANHY9YSAMACWFSHA9UGWI9RGTOMLXXTSNEVILPWJBFWBZUASAGTYWGTXHPUCWNCAVKPCKYFBMZMGAIMFHORQZHHKRQEUHOQEDQFRK9KATJAVCUVLLALKZUREIZOGAKUPZKPIBUQS9QCGVZJMNSBGVFURYKCEPKAPMWAVIRPJMTILBS9IGFOXGWTLTZHXGCTHUEGPRHIT9XZK9HEXRWDGTKMQPQFJPGYGFNYWJVRNREWPAEHGCOSNGUJEAMVJQKHDHKHHHZQTVEFNXGJSQSDPQMCK9QBRMOFVYQATOPYSJQMYLPEZIOSKBLGGNONZVLMFNZEUTABNBIQF9ZTMNRDMPFZKOPCPXJVQHFWTNMBPTPYEDPPVEQHWUJGEWCNYKWABC999999999999999999999999999999999999999999999999999999GRJVAAD99B99999999E99999999OWBTVEDGRYG9FOGBCRLIFTIRZZEPGVJR9ZWQIHECTHWZHY9XJLKDNYSHBLBJFVIVEPLFKUFXJ9GIBFEWXLYOQDNYZRSTLDWWCHQGERSFIGGMXRLHEVAZLPZXNXNHDPAFMQZ9QMFJDOSNEAGLPSTZMNLGS9X9YA9999NBAMUX9VSJWUWSFLXEYOYQJKPMUJGJGHQCWN9SNBPPMKAHJGJUZM9ZXEVPQUFAJXRBGPGMTNCAMJA9999999999999999999999999999999DPMBREOOF999999999K99999999AMA9999999LTH99999999999999",
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999AIUYNRQFJECFGMU9RUDT9MUFVRJZCMTMA9YZ9NWODBUHFQLHPCODTWLPUEPMALFSANRLBCTFAGDGTFUIWAJA999999999999999999999999999999999999999999999999999GRJVAAD99999999999E99999999OWBTVEDGRYG9FOGBCRLIFTIRZZEPGVJR9ZWQIHECTHWZHY9XJLKDNYSHBLBJFVIVEPLFKUFXJ9GIBFEWXNBAMUX9VSJWUWSFLXEYOYQJKPMUJGJGHQCWN9SNBPPMKAHJGJUZM9ZXEVPQUFAJXRBGPGMTNCAMJA9999TTDB9HOE9NZMXNYXEKNZVZSMDJUBDCA9ZZAQQFNLTWS9XIJCCIIZPEN9WMFKDHKOEXTCCPOZIKIQA9999999999999999999999999999999TELBREOOF999999999K99999999TA99999999IBH99999999999999",
        };
        List<TransactionViewModel> transactions = persistAndMapTxs(trytes);
        try {
            boolean valid = BundleValidator.validate(tangle, transactions.get(0).getHash(),
                    BundleValidator.MODE_VALIDATE_BUNDLE_HASH |
                            BundleValidator.MODE_SKIP_TAIL_TX_EXISTENCE |
                            BundleValidator.MODE_SKIP_CACHED_VALIDITY, new LinkedList<>());
            assertTrue("the bundle should be valid", valid);
        } catch (Exception e) {
            e.printStackTrace();
        }
    }

    @Test
    public void validationModeSignaturessOnBundleWithInvalidSemantics() {
        // semantics are wrong (indices) but the signatures are valid
        String[] trytes = {
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999SD9999999999999999999999999VUA999999999999999999999999GRJVAAD99D99999999E99999999OWBTVEDGRYG9FOGBCRLIFTIRZZEPGVJR9ZWQIHECTHWZHY9XJLKDNYSHBLBJFVIVEPLFKUFXJ9GIBFEWXPTSKRNBAPGBSLEVWRJJLXXZMI9MYERD9VWWIEDKHELYJADWIHOPNLXZEJXHI9AOTGKSFSPYI9UUHZ9999NBAMUX9VSJWUWSFLXEYOYQJKPMUJGJGHQCWN9SNBPPMKAHJGJUZM9ZXEVPQUFAJXRBGPGMTNCAMJA9999999999999999999999999999999ZFMBREOOF999999999K99999999QJA9999999RSA99999999999999",
                "RXLDYF9YTHVXKLHXBCDBQBVWUBIAIHCYSWLYJWHKXUDULDPKKFISAAKXLCZ9YRRXEHSNQVSXYDCESIHNDJNUKEGNCNLDYQEIMBWTBLPGYEDZVQJIHOVWSM9BGWDEYWFRWBDSYUJALTQZGQLHMBUDEDBAUIPTLBDBICKWVRHAWSVIJCFZZLLUYQXNXYTMDHX9LACUBBL9WFLRIKLMLQEAKPOZSZELTBPWZDEAKDWQPBYKOSOFPYDFMYBDKKTMD9RTGDIUYBTNMLSZFVMMFKHEZJLVPXWUZQZVWJDHNFBWDLUTLYUGOSBY9TDLISTQVITEHASWQTKDJL9YEVKHZJHKJTVAQKEVJEYHBODAQRXOHZNJEGH9LTPSZDQKERMUMTLJUTXCH9I9CJCPKSPHA9JEDXQUPKETALMMENNEXVDCCVENIDCKASPHYCGINJ9GXYGSCIHQFRFMPWHUSFTAQAQHHFJFKVTEETEFURZBMBYKMRGLRHCDGDJDNI9MXVRCCMVEDMUFUENSRV9TEKHQTTCWB9XUSSDTQBMPQVDDNSCFKHDGWTFLAXYQRZWBMEQ9PRBOFSZBXIGDVGHNUK9DWKJ9KNRDBENFYOOGOSEB9R99X9BGMEUQWKOHCMOOVNCRNEFOVNGPWEE9RTKMNXGCKXLNZSHKVRAMMLBEPELHQLEVAYCNRCIMEJYVP9PXDMWIYQZPT9NELUSEOEXYRTQJAALWINHMXXKEOKAOGLYITQEUJ9XUIBABKCYUDTJXTNIEWTFKVTIINUJII9IUOGULW9B9PQIZNIEGXBSMIWO99NTUWXXZCUGMSLSJKD9VQTOFAOQHZCXTYAKQYECAFGKYFMUFPRZZXRSHJFVFXTFRTNGOXNQB9HDGKD9HLUAWXPDXZFIBJOVUFIMYWKEQZPPEFWAADKYCZMAYUNECVMDTJBLLIDDNU9BIOEADRH9CARXERZVDZAKBMWJOIVMWWEGNCAZYV9KVNLGIVYOLORVBLKRMOYWOXYYZZNPMWOCYABGPFQHWIFLNGACIQ9AQPPXEXZUCNWVNTP9GXLPOEDGVOY9QDHBYAKIWBJETKPQCFNEPCSUOPCWBBQGG9A9QZGIUMZHCGIUIVPN9NEQTHAABBNRWHKRSOAJQOKIARTWFREJVCNADOMQMOPIQSNCVVU9QWB9K9TJQTH9XRKMKTOESYZSGOGMMIHTMS9QDTXMPRIRJGEAXIWQBR9JAUCPOPJGQIG9BMXEMIGVD9GLNDGDH9YRESLXUULJPTPTLDBMNKGEG9TR9PWWVQPEFICAPCFLYYKEMUDAVTUZFTXIYZNXVCNCMVXIWWWLFGYFIN9TUQIBUHLDZJEUNMNFNWLCGAHQSJ9DTFNO9NSOQGAXHDGAPQDPWFH9KTEMCWMNMSCPQHWNWJQOXUOHEJDCZWPNGAUONXANYTLRKNUSRCPRFECJJNDQNYZJUSWQPSDYOEBIVSJYHMMNNSYTYXDXAWPRXPYAPLIVCXHKZHNEBPMNBMIVXGGOQQLINCHNOAPUCJDECBPEATZYXVEXZMEUDXXILFZIKJQFOUZAARYNDIPTPEJFVWDSIT9M9LSCEHSDOFAUUPJUYG9PNEWVSELPWVZVLJNIEQYSXQZMNRDQNLBTDKSJCMWRLOUOBGAFFWLSFQPMFLQPTPBV9PJNZOFFPMRXSSCGCIHUKTDMYLQFCRBT9JHAUXTRBA9NWTULJXZVJYRQGJNTXFNGTJUOZL9PQRPQHOEBSGIVSPKJVRHKBQKWROLXUJGNPEUQ9BMVJCPPVHWHBUEDRRBRSLSECZAIVSSJHCSDEAIFNPFOYRYLTLITHYEKGBSWCKFIDVSIYPQAPQHJDNXAUAEDAYBXOPIDB9XPNBEMFYZDCNHMNTBSBZMANXBGHZTJSWWS9KFEMKQJDLNAACGVSBWVCQHAG9DAMCWUBHLFYZILBQYTBBCPVQVFGNFVZPPSZMGKHZFSMJBLROKKCMZSXBPFA9RYWBDJIXYOJWNMLVRNQCIRJGQQPXHAYTKPDHNVDATYJRJGCNXHJOSEY9YSWIXEMJKYULPPDSASZQWFTK9NJNZKWZAYAAPAGTOZEPJXXWRCNWCYFFCWQ99MI99QBFAQZETMKG9EZ9UNLUGHZIBCILSDCGJIGXFAJMXHKXREUTE9LNBEWWWTMUZFOOWD9BHGXVGL9BXXXKQXIOSKBLGGNONZVLMFNZEUTABNBIQF9ZTMNRDMPFZKOPCPXJVQHFWTNMBPTPYEDPPVEQHWUJGEWCNYKWABCZGECY9999999999999999999999999999999999999999999999999GRJVAAD99A99999999E99999999OWBTVEDGRYG9FOGBCRLIFTIRZZEPGVJR9ZWQIHECTHWZHY9XJLKDNYSHBLBJFVIVEPLFKUFXJ9GIBFEWXMAAJVBUWQLZGRECIRXVEGVNJXTFQPNW9RKLUBLIGFDSQNMXZO9VMXLZZ9PATMJQFRICKJSXZBDPRZ9999NBAMUX9VSJWUWSFLXEYOYQJKPMUJGJGHQCWN9SNBPPMKAHJGJUZM9ZXEVPQUFAJXRBGPGMTNCAMJA9999999999999999999999999999999SAMBREOOF999999999K99999999BKC9999999XMC99999999999999",
                "OWHZXN9UYGGFEVPDHVWSEIWWIFCVAPQUOLEWHKKIJHOZFYPDCCPHFTF9GARSNSDCNIYFOHVGHOJUMZWJCGSFWQHCRDBCN9KBPJD9ESKVRGSUBCGIGQKZEWPRFTFBJQBFVJLPU9NBTHVAOLHEHICPYOFARYVM9ZXDYWPNLYIC9VWDDQQKJMEYXMNQVUWZGPEEPBHYUBHQZIHKEUTHHKJFTRQWMXWWWQLNSZOVRSCKQOKZHIMYKXCBPBRDYOOLMMLYIQRNI9LQERYZNYIUTPB9IMWONCRUGMESTUMDTWWXEMLWROGXSWFHWMUMSVPHIDSZJJOWXTJNLNEOLFFDL9GVOFYHOAIPJGQDWEMZLEPIPCYZDAGJ9O9LMTGJEORGQYZASQXUPHWQRJEEABPSNC9TWRIV9DNRQUVVYMMZMVDYIOPQGDBKPVQO9VPJLEJIPOWNOAB9ILZFJH9WYHALVMYYLITQDAQJPZBHYDGNTYMWRFHLOXCWZUKVDUBJBXXYEE9QNPEMGARYLRJPGFWSTLOKISSLWTMUJYWBUVGKHZ9KNXTVXQPUMTNWFCCDFLNMEGMBSYAYNZKVZDNNCGYWAJPKCQCCAVULJGOSNNQLCFKITXORKQILXLHBBDBALSVRDZUHRKEJMMLDCNSBXHGJC9AGKZXATTURIKSYOLHDZVLBMYLCUSRTGIPHYIAIAVMZPJHRCFKXNRJVVWLMITOWXPXDNSWFXARUMRMLMZJTSJQYPBHLILPQQWHDCFKOFSOYDKGMSSTFINMQWARKXCDTZ9SASPKPPAYPZHWBTZTTB9JB9C9FP9IF9HCOKACUBKMPPSRRHMXLWJDNEXZKFX9KSAFPMMOEUVPRROROISLSTWAOVKE9OCCKIAUDFZXM9LCDM9VAJUNBVPHXULVUGZWUBWQITZBZIWREZGNNCCDYVUSQNCBTQARSKYGWHAOTRVMDUXHMWOTD9GACJPAAXFYLDISRDLGFIKJT9QWFZ9NXCDOIAIFDQBDUJBFVNUGTKFZIKZKXBKOLDQXODGGUGOQKGTKXUTGVRNWSDJREWTZUVCIFKULO9TZJSVJOYSAGIJCNBKTXRLVUXJGBHAZJFEDSMNFTADYVJ99PP9KBP9WJWHHZYMYATATVYUOMUETMHFRQUWQNNIESGQOFPNDLQZFCZLQWLSWXGJZFLHKAU9FXOPGDQMKDSSKVPOLCFLWOQBMLAOCGVKWZXWUDXLESJBKBIEGHPKOCDPITIYI9CHTMCLYMBXCLEYBNNEDAWSLDCPCOVCXXHXIRCU9EYYYJWNJARFOIJIJKTOVCJIKGDBAVOYEEBNMCMHSHKPEWVDSSRDDN9PUFQXJIMBLPHRYLTEIEJTIJIVAFXMGDIQNUZWBODOVROBSGMAYBSKQUZEISKZ9AGYAQNFNCVEQJPJCUJUJIKINMDHUOGRCORQKWBCCVV9UKYVYYZVLTUZNGBNGLSJGMD9GUTGJJGTLACCNUQTWRCVXAYDW9YMPEQRWGSIPFCUQZMYKKJMTSQ9ZN9YYYFOBTRLWHSBBJWGOTAZVPDGSI9N9MCJ99YEKQYCAUO9MHUCHMEAUTITOYRQBROKKWFZUILHBFBWCEWSVEPUCJSRR9XGVXAP9QXBZOHMPDNOQNNBPKUSWFQAABPTQH99Z9RMBASNZU9VYY9APLMFBGKW9QBRRHHKJQNOHSLWLHUY9NDUJTQSPIUQDBBK9VCAAVEDPHANDWYPAWVRNLQJPOELZPYNBWAK9KLSPAEESADMRPBAPYFGEWTZQLYTVMYBR9VCQJHZCFKBTPQEQHJOXCSFYQNJTFGTAHLLQGSBGTZOLFMFQEOOMBBURXEWWAHTZIYB9MHMUEKXAYALCFO9HSO9POINVKRVB9QHBANHY9YSAMACWFSHA9UGWI9RGTOMLXXTSNEVILPWJBFWBZUASAGTYWGTXHPUCWNCAVKPCKYFBMZMGAIMFHORQZHHKRQEUHOQEDQFRK9KATJAVCUVLLALKZUREIZOGAKUPZKPIBUQS9QCGVZJMNSBGVFURYKCEPKAPMWAVIRPJMTILBS9IGFOXGWTLTZHXGCTHUEGPRHIT9XZK9HEXRWDGTKMQPQFJPGYGFNYWJVRNREWPAEHGCOSNGUJEAMVJQKHDHKHHHZQTVEFNXGJSQSDPQMCK9QBRMOFVYQATOPYSJQMYLPEZIOSKBLGGNONZVLMFNZEUTABNBIQF9ZTMNRDMPFZKOPCPXJVQHFWTNMBPTPYEDPPVEQHWUJGEWCNYKWABC999999999999999999999999999999999999999999999999999999GRJVAAD99B99999999E99999999OWBTVEDGRYG9FOGBCRLIFTIRZZEPGVJR9ZWQIHECTHWZHY9XJLKDNYSHBLBJFVIVEPLFKUFXJ9GIBFEWXLYOQDNYZRSTLDWWCHQGERSFIGGMXRLHEVAZLPZXNXNHDPAFMQZ9QMFJDOSNEAGLPSTZMNLGS9X9YA9999NBAMUX9VSJWUWSFLXEYOYQJKPMUJGJGHQCWN9SNBPPMKAHJGJUZM9ZXEVPQUFAJXRBGPGMTNCAMJA9999999999999999999999999999999DPMBREOOF999999999K99999999AMA9999999LTH99999999999999",
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999AIUYNRQFJECFGMU9RUDT9MUFVRJZCMTMA9YZ9NWODBUHFQLHPCODTWLPUEPMALFSANRLBCTFAGDGTFUIWAJA999999999999999999999999999999999999999999999999999GRJVAAD99999999999E99999999OWBTVEDGRYG9FOGBCRLIFTIRZZEPGVJR9ZWQIHECTHWZHY9XJLKDNYSHBLBJFVIVEPLFKUFXJ9GIBFEWXNBAMUX9VSJWUWSFLXEYOYQJKPMUJGJGHQCWN9SNBPPMKAHJGJUZM9ZXEVPQUFAJXRBGPGMTNCAMJA9999TTDB9HOE9NZMXNYXEKNZVZSMDJUBDCA9ZZAQQFNLTWS9XIJCCIIZPEN9WMFKDHKOEXTCCPOZIKIQA9999999999999999999999999999999TELBREOOF999999999K99999999TA99999999IBH99999999999999",
        };
        List<TransactionViewModel> transactions = persistAndMapTxs(trytes);
        try {
            boolean valid = BundleValidator.validate(tangle, transactions.get(0).getHash(),
                    BundleValidator.MODE_VALIDATE_SIGNATURES |
                            BundleValidator.MODE_SKIP_TAIL_TX_EXISTENCE |
                            BundleValidator.MODE_SKIP_CACHED_VALIDITY, new LinkedList<>());
            assertTrue("the bundle should be valid", valid);
        } catch (Exception e) {
            e.printStackTrace();
        }
    }

    @Test
    public void validationModeSignaturesOnBundleWithEmptyBundleHash() {
        // semantics (indices) and bundle hash (reset to 9s) are wrong but the signatures are valid
        // however, since this would lead to an infinite loading of the genesis transaction this bundle
        // will be deemed invalid
        String[] trytes = {
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999SD9999999999999999999999999LD9999999999999999999999999S9MVAAD99D99999999E99999999999999999999999999999999999999999999999999999999999999999999999999999999999999999YTFFCTLLBBZ999AFTRHVH9EHCVHMBKQJCBITTJEPQCIINKMGAIUXZME9SXDDTXAYRCGNJVSGWFFAZ9999UTZFHYUVCRYFXFXNQ9E9ER9ARTNMXTZXWVVBBUNQXELPEFQODXSNSQZSBGVGMSOBFSNTNOIHDHAV99999999999999999999999999999999CGIQWEOOF999999999K99999999NMA9999999LL999999999999999",
                "A9BQQJMUET9OYFSPUIRCENECVZVKGAKMLEPDI9IRTTDOKEKDNEEMYRVRXVUHFOTLGUHRWYOOMQKDIZQZ9XDAUTOPAMALZGRWPZMACAMHINQNCRYZQZ9GJFYZXOJNDGNNBYVZPNMIWZEYXWADJWIZJGP9LWQSQAHLX9XUFRJPFLAMYJFOHYCRLKQIAALMSAMRDFRGNIDUODDPXRZAYIKFQUVY9VQVCMPSZ9Z9NYDRUXCASSUPCQ9M9BYDJSATGKTAMOQIRGYEKSUYQMJYAALZOPULJECVOXULAPXI9PJZZXQOQWNESKRGWJQKXAWHDIHTFHZXYORPPIMO9GMJJBZH9SLEYLMWUVOGT9WPVABCFYLGSWYQILJVJUGEVSGUTUEQLEQKQSNPURQSZYEFVR9OWMYJJXOBPYVFOKMDJJYAQZNMXZTTEMCFDTXHJUKXLN9ITY9XBRLWDZSXOPLKSGXVVRPYDR9PAYNVEYJNNAPAFYYJZWILAGZIJWMIKZNILNZRFNVJWQVPETVVSTQTJUGQRAW9UZKURMDQSMUO9WAUTM9ZBNXG9ELJYCDJIQKLDP9FUYUACZZSPUVZVTVZIPPTNLBGQ9DTQNYGCTWHHRYZUAQBX9XRRVHXFHN9TRILFSTRQMRFCIVZAEMIRJUJAPTUOWMEZNYYNWINIZKVZOTQSJTZCCBMXFOTHSBEQWGD9KXVKSIDMNCUACBDLE9WKYPJJ9G9CSNDWNKRGQPBTZXGKLKCRRMSIIYURLFSUMSW9AVHTQ99HDOURXJPGIVUWVMIUMZYUEOFAEOOPXPWUZCAYDCKOSWLWY9AUWEYHLKYSGMA9NINNOGYV9CYEKXJF9CDXMYZDNGLLBMMRROT9VOUHJRZKAVJKHWWMHMGCJCXNLQYWUOETLBYJLUVOYGPYYVZHRBRANGICKVWPWKGHVYLWSJODQYRYGKJWNFRQXFFLBWDEZODOHCGNFDYQZVTOFRUWYOKCNRNIAOXOHUAQXHOCFVFWGPWGFTQVPYN9OFZQMRBLWPSGALDUFEQDP9V9QKUAFLPKFZNCVPPGEDBUCGZGRYPLROTCIHEUH9YMDHLTK9CNT9BHPMZHTERQZGDZMNOSHSKHTZNP9S9EQRYDLUOHIEDACETA99FRHAJPMRIQGXEGLLMMYHQFTHBVAOWLTGKTDIHYKKFKLFD9FQAGTNEFEHGRWBTVSCYTGGZONQCRCXDBXSXFQGCEXZACN9XYPVAYTNSYFBOQYFNIQ9FABR9ZZIZWWJY9GGTWYZEUYGZTFDZQVBAJQCXHLA9OQODYLCBFGTNGXXDYMTIZTOLZELUJTOYFWMQYPGTTQNKUICCODOXXTFEVQSLZYGOKHESQYFGGJUPISMETQFLAEKK9CFYHLCVADXKEQULXQWUAVZ9ZTKNQIBUIT9ELER9SSEBKVEPIHRQKAPRVHAKFBMCFHYDJZKZTNOAVWVKQH9HI9IMHOTDYBDUNVKHSBVIXOFQRNTIJTPOQNUDRJFSYTWCKIBLROGDTREBLETFYEBGVACGJDBT9WWKASXNCGRUAVK9ZDUIMAG9UCSHLIBQIYIITNNIYEXHSYSKFESZTKPDOMITDJJJISDZPZKLXLHWW9HNWOEWNCOKBOHTDCUZ9ZTALACJBOBPNJDZLYNPYHUGTBEEWXILVPGJOVUIYIYAOH9YR9WWKPOFBEGLJDULWYYIZPIXX9MHZRGNCVSXLLKZAOUPDE9APQF9ZYQPEKOCMYTKNJ9VAFBUIOVEHSVPQTSXAYQCOLPVFIGPULKHRYKLZWUUPVJQTWFWZEUGYRVFMHUNNAVHEBHYPSQLOIWFOZDMXDOJV99ZJWDQHQMSPTNA9OQDOJMNVLAULQBYX9XHVAJUDAJWMRDLXFQFWXXXMGOXQHKWK9QWFUFSMS9PSBRI9FGXYJHPICWQWLTEFTFUJDAGVC9SBCUA9GMHSCJRSBDWXSUIY9JTXJCIPTORLP9ZUHEZYLEAGAICYHGE9LPJO9TKJASVBSPARLUPNLAADWYMVBQEDRDFVYXYNAWLLNBGSKQGNNACTZMAWCZEOVRFNEBTBQYNMBNJNFFHZNSRCWVKAMLLDJSVAPDCZSPWLNJDXCRL9FFIPJLLGWOCFAYJMNIULBLNSSSMABCXEHVXKODVDCMXDUI9U9ULTJGRQNICHTJUIHWMFGEOFEFMTIXCMXCPDYALUMYNQBGHWTIUNURNDOXPJKVXSRYKA9XJIJHMTHECRDTDESYOTABNEZLUWNLWGQQCLTJHBB9CZGECY9999999999999999999999999999999999999999999999999S9MVAAD99A99999999E99999999999999999999999999999999999999999999999999999999999999999999999999999999999999999VWVUMNWQAIUBQIMDURVVBPEHFXKCABGQ9VPNNUQPJBLLIGSTJTMANXTSPOTAKOQPINAIRGFBLGSZ99999UTZFHYUVCRYFXFXNQ9E9ER9ARTNMXTZXWVVBBUNQXELPEFQODXSNSQZSBGVGMSOBFSNTNOIHDHAV99999999999999999999999999999999LQHQWEOOF999999999K99999999IVB9999999LRBA9999999999999",
                "SCNZVSIQU9ICDHHHLPPLCQFJQUZLSBYMIYMLSMUQNWLFALLNLNWSSCBAEWP9KEZUHTVWE9JIBBDBELSFXDMFNTIBMPBDJXFJMRZQTDDLPOZHMUZCJFMQGZWOPJCRCBXAGAERFYYI9XTR9RUGQVZMU9F9LLLLQEMMQYGYEZUMLCDLZFGOGJYJCMLFRAPCKGCBQBMPE9QVOBVYFB9NYKZPYNJBRPYHJPKRCVTVEZZLFFIMNTWXNIACGNVUYSKZCELFNJTZJLZVBBMALYGSTZJALTDJAKWCCJLEJKQEGFIIKFKBCPUXUB9ETBQSBAUZ9BEZLZHDNAEGSIECRAQHITSQOEKBTOTHUTRYSPGMIFCEDTBHHYKBXRNGCNONYSISCGIHYRPKNKMARNBWSTWABKAYCBYWURIRTSYOAPBQGZWKJQKKBZGXTYOZPNNSDBJBEQVTCBK9ZPQEXUYFKKD9NQVKIIQYXFIJJGYDKUFNC9GMIZTNVPGCNPNUD9SWJKCLENGBCMEVR9GAZNHLQ9INCPCLULDWSQFFCTJHKWWALPLFYF9VSSOHILTJYXZBPACXMZLV9GL9CRHBDIONQZBVRMWXFXKMVNBJVQDERTAMCRTLDRDESVVOURNZ9YOQNUHSCDLVSDWAPHYYMATPMUFZEDBYEWAXESZTCZT9AHXWNAJFOXNMGRCGKOXROBLVFRFATFOMMKQYQWBPIAJJLDNVORZXDPHOZCUBDQAWHEPCCURUJGXXAHUYYGJVTEFYEEHIGJ9URSIVGULKUIZSUML9NKAQOFBTOWAZBNPPXNYUFQF9JC9A9DOUWFRYVKOZZZSB9HTUTCQRLXLZHLYMLAHLMHLVLAFXRXSCYEEFWTQE9FVNJRM9QDBYJYCHVOGYIGWKBLZCXN9FORL9UN9JVNZCXFQXJYBGXXYWJ9VFPZUCRIXXUCWHMSJJBQHHRIXPYZXYXMPQFQ9HHPSSTSBD9CRWUHT9JBISIOQUPYNWIKKFDBGWVNDGJ9VVGNMPJLWLJGGYIJZQYRGELJLHBWMFNHNTSRNTXFAJKJRU9AJMXPHOAZGJJLHIAJMK9KUHPUSAEGXENREWNZINSBDCQWXPBACPWLPDRUNACTLSXTXLMOSONZEKALTT9CUVSUZNBYPNYRKKLHMZQENXIN9FGYIAXJAFEPSTOAEUBRWDTHVWTUIZTHZDQCUUSLFKKUSUVKRDYHDYRLD99UMKGHJYOBMQAFCIEJVRGFVAFSTVFOHZGHUCRBSIXHHHYOQTFSBHFRMZVAWTTX9GFJTWOWM9AVJRYQOXSIZRKIVAHSJCMK9HA9BOBGLGPWAVQXAVEBOTLAOJKXCPFENYPXHO9ANXGBT9RXJBSYBNPLTQUIOI9QWRCBEDLLDYYIUTHIDTLOUTQYERNM9TBSJIVXZNIWQKWINLSDCUXWXIFZUIEUKAIARKQEPQHYMHXJXMQIVGQYC99DU9KSCBAPNWGJCVXUIADAOXRBUEZBU9AWSDSMLQYMKZOGVBKGIIFHEUIJIMRXNBHKVHTISJTGSBQAYI9LBIRPNCSTNBEPMBPMBIPRFJYCSKVRCOIJCASFQZHCBANQOYEQKQ9ICS9RJKEBFVQRNWWVIVXAPQSNGXFHOOUOAQGSWWE9QGWTAGEXGEWNAHHJAYFXVAWG9JQDRDRAODYVTGDBTJSRAJACIR9MOPVNQULGKJFOQZDAWGFBXHIQTP9JKLTNQJD9CTYQOQPBQTVPZGJCA9LWECGUCZUIIWQYUUOHQGGESQVITQJWKZEJBICUQWAXPOKZEZVUHRAIBLPADDBPOVILY9CHPQKZBEMDNEEZGSUWRZRQPJKIPBXQIZZBNTLPCGD9ZLIYVLQYQUJS9ILQN99SQZZDMEWYLJH9ZGUMVHYJPAQLZUJBSLHWTAPFLOIOTZTATSXPDTK9QKBXSZDADONUZIATXEPSCAUSSYDMKYUEGB9RYUY9AXPKGSQKFGIBBKURKFHRGGP9JJCLNEAVNMGFMSXONGCOCMFUJTHKBMIKACHBLTDVTTKFYVOPQLEJQYZNISL9GYU9PKPLNYR9WUNFYIGKFAZNFODCJURDDSNHAMUJYFNNJNPDFLQVGFLPMJZDSDIUQTTUUWGKWTDGZEGMPJCMDHMTSXNMLPEHDHTHCUAYGBOP9WEENAPPSZNGWWSBANDNFOHRQXJJIQJZWCMXCPDYALUMYNQBGHWTIUNURNDOXPJKVXSRYKA9XJIJHMTHECRDTDESYOTABNEZLUWNLWGQQCLTJHBB9C999999999999999999999999999999999999999999999999999999S9MVAAD99B99999999E99999999999999999999999999999999999999999999999999999999999999999999999999999999999999999SYBDDSJJHSBSYUCVDXIYMWVZWLQNXGREFLIYJUOKNBIPGAQOIRQNBXKSXTYTVFRYLELPOXH9YT9S99999UTZFHYUVCRYFXFXNQ9E9ER9ARTNMXTZXWVVBBUNQXELPEFQODXSNSQZSBGVGMSOBFSNTNOIHDHAV99999999999999999999999999999999RIFQWEOOF999999999K99999999FLA9999999RGXA9999999999999",
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999BNABIW9ZIDVLSREOBEHPNDAXVHDMONVQIOUCXZPLQJEAQ9NGLKSNMQMCBCLLFVJECJXKKOJVFIXTEXSICAJA999999999999999999999999999999999999999999999999999S9MVAAD99999999999E99999999999999999999999999999999999999999999999999999999999999999999999999999999999999999UTZFHYUVCRYFXFXNQ9E9ER9ARTNMXTZXWVVBBUNQXELPEFQODXSNSQZSBGVGMSOBFSNTNOIHDHAV99999II9GJDQDYDHVTGHUPJJP9REYOGBFIVTBSYKDECSXSNFZYGRPURFOVTHCNZCCZXOWDHHCKYWVUNGCZ9999999999999999999999999999999VLCQWEOOF999999999K99999999NB99999999UDZB9999999999999",
        };
        List<TransactionViewModel> transactions = persistAndMapTxs(trytes);
        try {
            boolean valid = BundleValidator.validate(tangle, transactions.get(0).getHash(),
                    BundleValidator.MODE_VALIDATE_SIGNATURES |
                            BundleValidator.MODE_SKIP_TAIL_TX_EXISTENCE |
                            BundleValidator.MODE_SKIP_CACHED_VALIDITY, new LinkedList<>());
            assertFalse("the bundle should be invalid", valid);
        } catch (Exception e) {
            e.printStackTrace();
        }
    }

    @Test
    public void validationModeSignaturesOnBundleWithInvalidBundleHashAndSemantics() {
        // semantics (indices) and bundle hash (reset to As) are wrong but the signatures are valid
        String[] trytes = {
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999SD9999999999999999999999999IH99999999999999999999999999KPWAAD99D99999999E99999999AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHSXBIPEQEIDCLJWXMZVDTRVLMMQ9JCTYLZXAYXDGGHLKXMPMOHVEUSXJEEYOTHLTPIBNRNBVVVBEA9999UZBMW9VKUHJFZKOJAGLEUBKHO9JHUXTHPVVINMHJQOXESCBJYJETNLXEJNUSMVEISIOJVHLFSGRHA9999999999999999999999999999999CHVI9EOOF999999999K99999999JBB9999999UAK99999999999999",
                "FFVAYKZCSBYKZLLQ9VEHIIPXQULZSNSCBDQQTAYEYTPIT9MKXIMIYDKIHKJLAGSJIRKTSTAMZEXANRWBASOWZIPLIZJHOKKREXLYGGHQEK9KSGPBIBHQAYAHQIMGETNCMUJJ9MPVICFOHNXAGQQXUNAGUMBIGTDL9WAQNLYHHFVVADTQXNUNVKMDGLPPFB9HVAERYHDAJE9DSTYLDXZGEQZWGLTLKCZ9LASOELREPANSMXAPSKW9NGXTFZQXXOEWIMBJHPYJMKZMDHWVSSBBGKKSYXSDUPCVGRMXCIHXWDIUHPIFOWWOLKZJDQJQ9HLVHTGCOGIBBNEYMSBXDTQZTKEALLTLCNRVPZJUCPCTSOUJQDLNBOZODPGQHBZSLBAXIMCRFIM9MHZJWJWCEMRGDZHTR9FRCGTNTEYJUANDNDVIMTUZIUUVDQFGYIHKCBERRGEEHP9ARTZH9FRTRVPKKXKZNTLAENPQBFSIXDYKVWPEPF9ZBQGTNTEKQCQUVHBQTLORRFLPDRYLNYURHZQXMGM9MTVOEZVYBVMZGNNAHV9CLGUCNWRMIB9KKOMLKHY9KRALPXJRCUI9ZMCZVGURDARY9NEZCHWSWFWG9MWUVGCWHVGRYXGKQMND9BVYRHIMQRHPZVNWJUAXKXLHXUEJJPWDUICSF9UKQBKTQSEMDORDZODEFI9ROIVNJEDWPZQBGGVKFNSCQTLNDGULTUMVJMIVCNFNC9FVLWSQJNRRLFDPVWIQJQDWQAEGFGWSBKVITTWFMOJRCRIMVMJVUQEUHJRZSFZYIPRZJWXOSHJQTXDTXRTDOYC9TEGAQJLJ9UCXNZSTKFSLUNSNUKBVYLB9JFOPBV9KWDZWVSN9CQDVSBXZYKTKBPITZHMNKYCPVHGZMBWDNHDZMQRHYUSAKZSELHOMGBBMGCQII9HIROJIH9ZM9UQYLOMSUUQ9NRFSSYGEMPACEUQLDJZBPUWZQUAVXWSXQJLUQJKFOSSYOBJILXNLNCZDZXSXISEHJVOTHCWJQQJQOUJCNILHDRSXQXLRO9RFACXC9AFCYDUSJFXJKENPDTAZMMPLRKATFCLAUFPFRXZQX9TRIURKQNIOSCLGTRR9WJDXVMQEPRLGRBAUNQJWI9SURZEEBAPUYANWJAUAUJBSBXILVBOISJDSZJYWUAYDS9AAGXHOEOQOCHYRKVQYQEDZGNSIAGXIPCULYSXZJRROOXRXNNDLQ9VBWBQQEHLLCDSVJENQUTMBHJC9RUKELCHVGKZSWMJSNWDEJIUBQADLTJCAPOAVRRYZZBWODW9YHNJYXEUJLVYRJELVMCGLQDOBDKKUIGJYHXUINADBPWVYJOXZNKSTWCC9URQWOLTNBZRWP9LPDCGXTAQWXPRTNWFPJSBHAYTDHBSMKHVKCCGJFUWMKGB9PMLBDNNYUEHJXIEHPBQQEDBJJQEAXHWJZSFCSAWSNBNACEXPBOTE9USXPLCGUEUVAQ9MJRONFDN9LQFXLLYRTWFPTDRRIVSDZEJSYND9ZZEPZZ9PSRIVOHWO9FJPHIIQWGIC9DMSOCAJBHBQRFPZXJAKYDNKERA9UQDJHIHZMUCYFCKWTOLGV9UKNGRGSPNVVXJJUGCDQFRZLFDHFYECNCCSBYJBUQGSXF9UYOWAAUICX9ZPRXDMTBWWRXSEJIVPMMKFPIWOMLLQLD9KU9M9STWPDD9EX9ROZBVAMQHKB9UKBBPXSUZWRTLJUM9MPEFQKZFOBFYZMEKCY9R9ETOULKDGVICZOQZQBPTZMLE9PACNMWWFPWCVKXSIOXRUDSIWKQUORRVUOKOPQTGZNYEH9LHRGMKCZBBVLAYCBXTLCGEXRKUTKTAIIMTO9FCERELQQTXMTDLQCCEMTFQRNSACAXETSYKROSEPFHWIDXYCBHJWNDBCBGLCDORIDTCAYXGSFPNIMRPL9CS9T9RRBYGVFQP9RBEIAFJCOVXPYMNXKVXKBV9QSJMUUXPUXCAGHZEIPLVFMIJAJU9RMKIEAXOUMKXWFXOFXJS9CMOSCYYADDQTAIAEAROXSDNZECQWUWGGPOMGRAJLRWQTXMTORYTOXAVGPFUFZQYVMOLKJZPIDCCGODYGSQ9VPLJMBBGQQXOYHQJNAXZIBWM9PDEOOLCEUJKKWPMBCAYPXPNELACIIZKPHH9UKPV9LIKOFRFIT9WNKD9GFKYGINTHGVLJFGBAXXHMANDNPML9SSREVDAQYHCJONIOHSXACXIICKLVUGLYJAICGETRJJNDBAHAZGECY99999999999999999999999999999999999999999999999999KPWAAD99A99999999E99999999AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKERFOUCALHHG99FQCDTMVKAZWABDCTFGGLZLKQQZHDWEXVLHDAEURIBNMCECUFUGNCSVGQCXJEAUZ9999UZBMW9VKUHJFZKOJAGLEUBKHO9JHUXTHPVVINMHJQOXESCBJYJETNLXEJNUSMVEISIOJVHLFSGRHA9999999999999999999999999999999RBVI9EOOF999999999K99999999WOA9999999CMD99999999999999",
                "SCCWBEUZHSISRJJCII9GPSFWV9SMKEWHZAIRL9CPZRPGNAQRMGVWCQD9SBNHISPTXDJ9CVERVVQCCRRMXKECHQHYEDJXGKFWZYXXNSKWPNHDFOCOCSHQPWMJTTUQVOYSMRNLBPJ9ZCSZMX9XDB9GYTLGDUGWKRQEXWFHBWPVIEYMSVCZWSINVLRJJLIJGLQDCCUNOKAHZYAYVUPSANBKHHMSPJLW9SF9JEZFHXFDXWF9XZ9RVBXGUZWKKG9LFY9PYYHHYAKOYI9G9IBLQ9JYTGHKTCRDJCOWTTWBZATCEMWCXWJCVXMK9IKWNOJTFFFAFFXXDQLSQSAMTXMMCVRWOTYRITZNMTOAUMONHIWXH9KXSTKGUMOOAMZVLMTSGDHTHJ9DRZNZUJSRPRHTAMVQASAMALXEDSILBILQMWTUYNTFCPIDVNAZGIJF9HMQFEY9ISBIMFDT9AV9OCVJREMHWDJYVZ9HPMGAWEGSYCDVPTVEXNRTEIPHEINFNLZRJVHTLHRDCQRURYLIUQ9MGYCOZDKPXULMPSDDIHAZFYHH9KLTAFTQIIWRCQWFPWOZOPJDKXOTPKNGPZ99NUVJOSGJFXBHPBIKZAOBOOZYJPIGSFNPIQTXSVWNBATPRPJF9DLXQVLCBLSWXNBUXVRPPBYXFEURQLZASAPM9GZFEAGVVUVWYKDNMQWKYXPMEOHIQ9AHQKDYNXFIMTUVXCTPGVZKCXNQBZASSNHSOYOWNYD9DVBOIIOUXBCP9WEEHAIULBTMLYQMVZHLTFPUDMT9G9IHMUDNYTGFQWRJCB9IBXIFGCEYUS9ZDXPFQFIAXZIJITZISN9NPNAIE9RXQEUSUEOQCZEQPQMWSXHNY9KOQTCGPYWEAOMOXWBN9IPZVEYQTWOCXPNTOZSPWYLKKDIXSMZJHDFCFNY9PVOLEXDNDRSCMGVEXWRAONWAYUINUPCEDNKSYPCHNZEISLGAQRCORHIEQRGMSQKZKRKU9DMXI9WRHYHENYBZLSKLDALMI9ECYKFEGCUYTJMBHYXKWLZNUJNAHENBL9HFBB9OYLDVYAHUCPBCQPXNSIJCS9QRHAVDZNQHLGXNUDKOUNETUALUVODFSVXOESPAHDSRO9OWKMQOLBXR9XBJBUSGWEZIYYGPFOVKDHFHDEBUZGEIGRWMPANQSANQVCFMNWZYD9SIADOFBTXISAUN9UNSXEFGDQTREQCGSM9VMSQINPNWMQHUABRZZVQHRHOB9LVLPWDFBMVPEVS9EHRPPYFYTWGOMIGMVAGYO9YR9VADKKSKYYVWHVBOYOVXVLEVWPXPVXQSLUHRXHRFREWTONWV9JUEWMHJJKAQCYCGHHEIJMMYIUYNEJQCQOCYDJWDETYKDQZBJLSODNSYRLQS9ZIAVDFIHAEOEIPQKOSDFHUUVLOVHOCBXQTMVQYVQOWFXYGDRPAIHGVZVPDGKTLVBXVKJWFGHLAEVSYKVNROEDSEXKJGOWACELHGDDUVAIQHRPP9WWEOE9SIKHGTRVFYEJBFOLFHYQDPMVPLG9XUQJERGEYZBWEGSZRQAESMHLFNPOJNPYEEHDAYMWVDHM9SHGIQ99QGNEAKWQQYWGUZPZRMTBEHTOGYUSXXDRAHFLCBXFFBQJRF9HBSCVSGRCWRCKHZJQKQVOB9ALHRBPTJMYRLXQNJVGCEJACIQNCEVISMUFYGT9FGZODMXQXAMQEKDTOJCG9KP9OXETW9FWWJDVBMPJLRZUXLIJMXCJBTELZWBMDUNECMGLIRIHGHFBHKEEIKFBNUVNUHUSHEVPNEMCVYSKKAOHGKKGMERXWOAPWRUHAOJETQFVZSLFTEKNLTTNOYS9EBPBSRITUYLISBNNZWYENUNSABVRTCE9TXRVAIIFIELJIXNGBLDHCPKAQEFWFRVPJYDNUICISVHEAEOSEHSHWURCKBLQ9TSIUXJCMSZERHWRAAYZQTISVEGATTXPPVSLUBRZYSVMYMDCIBJEYNNGNOYUOTSYQNHRDEQSPDVCEWGOWSLKEAZBV9UREBIOVZHYPJZBZWV9QRUZ9UNKDAVCEZOVUZBYNPYITGZKJ9WPEKBRKWLFJMSDYWORSAZVBGRIIZZZMCR9YWAWMW9NTZXUTDFLYXNEFWVCZLRVK9YLDPO9KSDKWAR9NRHHHVTOYKWFVHNKUAUNWXLOLZICECVXZNKD9GFKYGINTHGVLJFGBAXXHMANDNPML9SSREVDAQYHCJONIOHSXACXIICKLVUGLYJAICGETRJJNDBAHA9999999999999999999999999999999999999999999999999999999KPWAAD99B99999999E99999999AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABGGXCLUAOGRYLHJZBQVSAKWDKQHKRVNHZHQFKMQ99VJIRZNMVCUFPK9AHUVMVGOSIWSWIWRWPNVXZ9999UZBMW9VKUHJFZKOJAGLEUBKHO9JHUXTHPVVINMHJQOXESCBJYJETNLXEJNUSMVEISIOJVHLFSGRHA9999999999999999999999999999999OOVI9EOOF999999999K99999999RY99999999XEJ99999999999999",
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999DYNCIYFOWIXWR9R99JSWSOEQBAXZPUOWUBVBWMA9BIZRJDWGYLOPCNUSOMQTWEYLFDFSRNCKXF9RNZFNCAJA9999999999999999999999999999999999999999999999999999KPWAAD99999999999E99999999AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUZBMW9VKUHJFZKOJAGLEUBKHO9JHUXTHPVVINMHJQOXESCBJYJETNLXEJNUSMVEISIOJVHLFSGRHA9999RGJUFWSOBWHLAOZKOTWBJJSIFSKHPAEHURVCNGQODASYJHDCTBWYTNCFHRMIL9M9SKQCUNOG9LKV99999999999999999999999999999999PDTI9EOOF999999999K99999999FY99999999XIWA9999999999999",
        };
        List<TransactionViewModel> transactions = persistAndMapTxs(trytes);
        try {
            boolean valid = BundleValidator.validate(tangle, transactions.get(0).getHash(),
                    BundleValidator.MODE_VALIDATE_SIGNATURES |
                            BundleValidator.MODE_SKIP_TAIL_TX_EXISTENCE |
                            BundleValidator.MODE_SKIP_CACHED_VALIDITY, new LinkedList<>());
            assertTrue("the bundle should be valid", valid);
        } catch (Exception e) {
            e.printStackTrace();
        }
    }

    @Test
    public void validationModeSignaturesWithInvalidSignatures() {
        // semantics are wrong (indices) and the signature of the first input transaction is empty (2nd in list)
        String[] trytes = {
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999SD99999999999999999999999999B9999999999999999999999999MPMVAAD99D99999999E99999999LGBWXNJENUHBKLSFZIJVPHSKTIZBDYJCJBWBRWCB9EKZJFTQ9YDHSFSVJJZGJHRLLHEGBKQAXFIDEQOHAAAFFHDLDEYEETSCXIVUFPKFJOPT9PPLOPINUXVTLSBBMOPIALLIMCIN9LMBUYPUZSTYANNWMUUKQZ9999FWTQPWNXKSUOIJOYNGHKQBSKVCPKZCBLPWRRZBVFAAOHJBCQOLSQIFHDNONESCGWMSAQYLNDAJCDA9999999999999999999999999999999WNECVEOOF999999999K99999999BFB9999999RRF99999999999999",
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999NLBKWQUWPCURAVNHPQQTGSSQEAZCQNDCTP9DFOPWKQ9MYHBVDRVSCOJQQKUFPYOSA9DLDCZMNEKBXUAAAZGECY9999999999999999999999999999999999999999999999999MPMVAAD99A99999999E99999999LGBWXNJENUHBKLSFZIJVPHSKTIZBDYJCJBWBRWCB9EKZJFTQ9YDHSFSVJJZGJHRLLHEGBKQAXFIDEQOHATRVUFKZTPCZZNRQFGGXOKIMIIRSMMOMWD9GLJNEAKBXAPFAJKSXESFCFSDVVUIZSRGVXDVFNATVSA9999FWTQPWNXKSUOIJOYNGHKQBSKVCPKZCBLPWRRZBVFAAOHJBCQOLSQIFHDNONESCGWMSAQYLNDAJCDA9999999999999999999999999999999KWDCVEOOF999999999K99999999HB99999999IUM99999999999999",
                "LHIWJUOVFJUGZVYLTCPXJKBSUOJROOGGMCDFKUFFGAKFMSPDBY9MJD9RKJOLDBECTGFARUFGZHUTIBILWZA9XHK9REMDHQQROSQMHPBIECMAAZKNAGRLDSWYCPVHKYRUIXUYLTJYRHJWR9CEMSIBPIPBOIJTGZEKYAXMKRVYWMLVHVITZKFJAHMSYZKCPUFPQOOULABXOLVCHOZUUMIBVP99UGPAYEJPOBKH9BSVBKZMO9DHZRCTOUJFBWEKJBUSIRQFLAVCVJWULFQJD9BIVRHBTCKYPATWQECFZGWJCHDNZDTUQV9BTAUSWG9OX9QYTVAZSD9XMSZDBUOHQYFAVFIHMYDHKBTAADOLZXHPU9A9EMKLGHJEOOPLXRHFTEE9PICXDUPIHPUZUJAHGAXWWBE9ANSVPPOAMSORQXXKERD9TKRHGANIFGOZXMYBSGHJWLBXQSBAQCKNBAPIDKSRCCWMNSCYOQBEKKZUZCWDPGDGAPWTLUOSDVUXDXJROSYDKEGGNKBMZ9KCGQPMEH9TUFGLSGOFZTA9NTEMHHRJCAKTUJELQMCTZIAM9QEZVDQNQWNCUJGG9ZBQXEVACXMVLUQKRPNIXGMHDPTCVOPYMXGF9TKREFWLEAEOERUUVSFRSODFRYPWFXXHWGRNHCS9FNREUERCKWLPYWUHZECNCXPCUFACBWKREAQYHPSMHQEINTVKBFCJ9RXLIERAXDZNVDJW9EMMVKPYYOFLKSANNMEB9KDBT9XYTWNEQJSXGMFTRGSHZVWHODHFHY9UJSEAAIGVDQORTQFHKQMMUKBZNYWU9UCKLDTTGIKCVC9BRUJNPMYWSGUCFIOTGXCFJFQCYUXHNDOFNWMAOS9RGVSMWHCMNLPQLKYGHTYDUPX9JMNYNKKDXAWYL9U9ZLKBZQ9UTD9XZWOWNLRCTAMRMHZIBOWPZPYXRMOPESEFSIMZBTGGT9THAOAGGBAXBPACVEFNK9RXCOPXKSXIGLYSCQGIPYEATHJIWUFGCEQGNGRWYWVXBBSSJRWCI99UKUMNNLRWUM9EGX9SYGHJSCAULFAWZJPVLCMRXNUXAUTLNIUJEIPXYZTFNGDRMBXGIHPQWNFL9KTGCKEOT9MDJHMQUOLSQNGULDDVS9OMGFEBDTROBXSXVHLFCEFPIMCAJAEJATDJJMKBIJLWGAQGDWFGQCN9MCGBGKAGDZLDIILLRQVHJLABQMSWBOFJIUQEDXCLIIGBNBHFSUQBAHEKQNBJCJDEZOBANUYHUJT9SJSVNFQIRAITRCLOLRUP9BCRHDKYMNWGMKVRMHAWWDEZVBHSTVLWDLTGCTCLKLJ9APIFGYTCHK9KSVHAYT9ZNVPSULJZKHOA9FJEDKKPDW9JYQ9XHSHKDEJREQLHMVLPGGPAZJKQNCPWVPAIIJKYGILRUBCPQKLRMXOGXHRTFXXHOTHCTVVAJYWGUBZZKXMDEMOJZTHZFNMCXZBVEBFMOTHMVPWMETPFNXYBZLCNHVH99QMAICKRFJQXPHRCVQIIFYIU9HVBCINDTXWBKDWTWMRC9DCHYVFLHBKMDEFXFZSZNIEY99HIAXLEX9CHSZWBRTLBXJSGOQICJR9WWJQTVARZL9SD9TMDOEOS9BCRKVDWWNLUYQSZAVMSBF9YBRXTVFDKFBWNEKIZBHBAHLQZFSLBFSRVOVTVXZVTEEIKVEK9FUUSWNBDHXQTHCWTIBJWPABPRCKRKLLKRHOGMQWV9YZDTMUXBZSSMZDAZ9ZCHJPLXAMELFOFFROPRS9PSK9DVBD9HJJFFBADYU9RHAODMEBLS9LHKYBGORHZJLFOJNVFAGABNLAOQYVRDJKJCXYYUSPJKSQNTXIBKV9DGBWAD9YTTRPDMDSDOHLEBVEXIWKYKQCLMJTCOBVPNVIK9NKKQAPPKOPVCZYHWIOUQGN9HIXOHCZCAIRSYKDBNLKPFEZTQLQRXLCVCCDJDKRPYCL9CGGUZKITJDHZJJKMOIOOFSODMQHAUZPKCVJZKHWQYRUSBXAV9LAQ9NAOWQQLBAVUBJH9OJYODENPOHAZ9C9RTQZHVJLVUMJQFCKGWLKEMBBIJQSBKVGZYBFQPGGAULBTCLLZTXSZJZGSM9NKWRWBQAFKB9BJZ9AHKBNWJAOPOWDQFQZACZZFLJGXARXUOQPRUCNWYPWCHVKUBGDTTXUEBE9NLBKWQUWPCURAVNHPQQTGSSQEAZCQNDCTP9DFOPWKQ9MYHBVDRVSCOJQQKUFPYOSA9DLDCZMNEKBXUAAA999999999999999999999999999999999999999999999999999999MPMVAAD99B99999999E99999999LGBWXNJENUHBKLSFZIJVPHSKTIZBDYJCJBWBRWCB9EKZJFTQ9YDHSFSVJJZGJHRLLHEGBKQAXFIDEQOHAKDQIVTYRRHJBZVNLZTVDAVAZHJXQZNQJFFURMVTVROWXGPVFFZJBORUCEVDIULTVNBDFWQ9KGNENZ9999FWTQPWNXKSUOIJOYNGHKQBSKVCPKZCBLPWRRZBVFAAOHJBCQOLSQIFHDNONESCGWMSAQYLNDAJCDA9999999999999999999999999999999TUDCVEOOF999999999K99999999GLA9999999CUB99999999999999",
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999CFGBOBZKGLIINF9VYQNDOCLIFFXYRZVY9RFFYQTOJNCZTANHAWCCCDDATWUUNXSBEIEIVUHLYIRGFNIMCAJA999999999999999999999999999999999999999999999999999MPMVAAD99999999999E99999999LGBWXNJENUHBKLSFZIJVPHSKTIZBDYJCJBWBRWCB9EKZJFTQ9YDHSFSVJJZGJHRLLHEGBKQAXFIDEQOHAFWTQPWNXKSUOIJOYNGHKQBSKVCPKZCBLPWRRZBVFAAOHJBCQOLSQIFHDNONESCGWMSAQYLNDAJCDA9999UPFHBXMOACPLIUIQOTGEOQVAKIPGCBHDBPZTACDDCIIPBJWTRKEEKVXI9DKKHZQJOFLQEWMFTQRQZ9999999999999999999999999999999E9CCVEOOF999999999K99999999CAB9999999LMM99999999999999",
        };
        List<TransactionViewModel> transactions = persistAndMapTxs(trytes);
        try {
            boolean valid = BundleValidator.validate(tangle, transactions.get(0).getHash(),
                    BundleValidator.MODE_VALIDATE_SIGNATURES |
                            BundleValidator.MODE_SKIP_TAIL_TX_EXISTENCE |
                            BundleValidator.MODE_SKIP_CACHED_VALIDITY, new LinkedList<>());
            assertFalse("the bundle should be invalid", valid);
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}
